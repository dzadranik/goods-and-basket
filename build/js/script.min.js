"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),t}var Goods=function(){function t(){_classCallCheck(this,t),this._goodsInPage=[],this._avaliable=!1,this._sortingValue="name"}return _createClass(t,[{key:"_sortingAvaliable",value:function(t){return t.filter((function(t){return t.avaliable}))}},{key:"_sortingByCost",value:function(t){return t.sort((function(t,n){return t.price-n.price}))}},{key:"_sortingByName",value:function(t){return t.sort((function(t,n){var e=t.title.toLowerCase(),o=n.title.toLowerCase();return e<o?-1:e<o?1:void 0}))}},{key:"_sorting",value:function(t){return this._avaliable&&(t=this._sortingAvaliable(t)),"cost"==this._sortingValue?t=this._sortingByCost(t):"name"==this._sortingValue&&(t=this._sortingByName(t)),t}},{key:"_truncate",value:function(t,n){if(t.length>n){var e=t.lastIndexOf(" ",n);return"".concat(t.slice(0,e)," ...")}return t}},{key:"_getGoodContent",value:function(t){var n=t.id,e=t.image,o=t.title,a=t.price,s=t.descr;return'<div class="good__item js-good-item" data-good-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(e,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(o,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(a,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(this._truncate(s,65),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button js-add-to-basket">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}},{key:"_addGoodsToContainer",value:function(t){var n=this;this._goodsInPage=t,addContentToContainer(".js-good",t.map((function(t){return n._getGoodContent(t)})).join(""))}},{key:"loadGoods",value:function(){var t=this;fetch("https://dzadranik.github.io/goods-and-basket/src/json/goods.json").then((function(t){return t.json()})).then((function(n){t._addGoodsToContainer(goodsPaging.addPagingGetItemsInPage(t._sorting(n)))}))}},{key:"setAvaliable",value:function(t){this._avaliable=t,goodsPaging.setActivePage(0),this.loadGoods()}},{key:"setSorting",value:function(t){this._sortingValue!=t&&(this._sortingValue=t,this.loadGoods())}},{key:"getGoodInformation",value:function(t){return this._goodsInPage.find((function(n){return n.id==t}))}}]),t}(),Basket=function(){function t(){_classCallCheck(this,t),this._goodsInBasket=[]}return _createClass(t,[{key:"_getGoodContent",value:function(t){var n=t.id,e=t.image,o=t.title,a=t.count;return'<div class="basket__good-item" data-b-good-id="'.concat(n,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(e,'"/></div>\n\t\t\t<div class="basket__good-name">').concat(o,'</div>\n\t\t\t<div class="basket__good-amout">').concat(a,"</div>\n\t\t</div>")}},{key:"_addGoodToContainer",value:function(){var t=this;addContentToContainer(".js-basket-good",this._goodsInBasket.map((function(n){return t._getGoodContent(n)})).join(""))}},{key:"_findGoodAndRemove",value:function(t){var n=this._goodsInBasket.findIndex((function(n){return n.id===+t}));this._goodsInBasket.splice(n,1)}},{key:"_findGoodAndAdd",value:function(t){var n=this._goodsInBasket.find((function(n){return n.id===t.id}));n?n.count++:(t.count=1,this._goodsInBasket=[].concat(_toConsumableArray(this._goodsInBasket),[t]))}},{key:"_countTotalCost",value:function(){addContentToContainer(".js-count-result",this._goodsInBasket.reduce((function(t,n){return t+n.count*n.price}),0))}},{key:"_saveToLocalStorage",value:function(){localStorage.goodsInBasket=JSON.stringify(this._goodsInBasket)}},{key:"_countGoodsInBasket",value:function(){return this._goodsInBasket.reduce((function(t,n){return t+n.count}),0)}},{key:"_reloadBasket",value:function(){this._saveToLocalStorage(),this._addGoodToContainer(),this._countTotalCost()}},{key:"getLocalSorage",value:function(){null!=localStorage.getItem("goodsInBasket")&&(this._goodsInBasket=JSON.parse(localStorage.getItem("goodsInBasket"))),this._addGoodToContainer(),this._countTotalCost()}},{key:"getCountGoodsInBasket",value:function(){addContentToContainer(".js-good-in-basket",this._countGoodsInBasket())}},{key:"addGoodToBasket",value:function(t){this._findGoodAndAdd(t),this._reloadBasket()}},{key:"removeGoodFromBasket",value:function(t){this._findGoodAndRemove(t),this._reloadBasket()}}]),t}(),Paging=function(){function t(n,e){_classCallCheck(this,t),this._container=e,this._amountPageItems=n,this._activePage=0}return _createClass(t,[{key:"_getPButtonContent",value:function(t){return'<button \n\t\t\t\t\tclass="pagination__button js-pagination-button \n\t\t\t\t\t'.concat(t===this._activePage?"active":"",'" \n\t\t\t\t\tdata-p-button-number="').concat(t+1,'">\n\t\t\t\t\t\t').concat(t+1,"\n\t\t\t\t</button>")}},{key:"_getPDotsContent",value:function(){return"<span class='pagination__dots'>...</span>"}},{key:"_getPButtonsNumberContent",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t<n?(e+=this._getPButtonContent(t),this._getPButtonsNumberContent(t+1,n,e)):e}},{key:"_getPButtonsContent",value:function(t){var n=Math.ceil(t.length/this._amountPageItems),e="";return n>6?this._activePage<2||this._activePage>n-3?(e+=this._getPButtonsNumberContent(0,3),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-3,n)):2==this._activePage?(e+=this._getPButtonsNumberContent(0,4),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-1,n)):this._activePage==n-3?(e+=this._getPButtonsNumberContent(0,1),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-4,n)):this._activePage>2&&this._activePage<n-3&&(e+=this._getPButtonsNumberContent(0,1),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(this._activePage-1,this._activePage+2),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-1,n)):e+=this._getPButtonsNumberContent(0,n),e}},{key:"_getItemsInActivePage",value:function(t){var n=this._activePage*this._amountPageItems,e=n+this._amountPageItems;return t.slice(n,e)}},{key:"setActivePage",value:function(t){this._activePage=t}},{key:"addPagingGetItemsInPage",value:function(t){return addContentToContainer(this._container,this._getPButtonsContent(t)),this._getItemsInActivePage(t)}}]),t}();function addContentToContainer(t,n){var e=document.querySelector(t);e&&(e.innerHTML=n)}function findContainersAndRemoveClass(t,n){!function t(n,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(o<n.length)return n[o].classList.remove(e),t(n,e,o+1)}(document.querySelectorAll(t),n)}document.addEventListener("DOMContentLoaded",(function(){var t=function(t,n,e){document.querySelector(t).addEventListener(n,(function(t){return e(t)}))};t(".js-pagination","click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&(goodsPaging.setActivePage(n.dataset.pButtonNumber-1),goods.loadGoods())})),t(".js-sorting-buttons","click",(function(t){var n=t.target;if(n.classList.contains("js-sorting")&&!n.classList.contains("active")){var e=n.dataset.sorting;findContainersAndRemoveClass(".js-sorting","active"),goods.setSorting(e),n.classList.add("active")}})),t(".js-avaliable","change",(function(t){goods.setAvaliable(t.target.checked)})),t(".js-good","click",(function(t){if(t.target.classList.contains("js-add-to-basket")){var n=t.target.closest(".js-good-item").dataset.goodId;basket.addGoodToBasket(goods.getGoodInformation(n))}})),t(".js-basket-good","click",(function(t){t.target.classList.contains("js-remove-good")&&basket.removeGoodFromBasket(t.target.parentElement.dataset.bGoodId)}))}));var basket=new Basket,goods=new Goods,goodsPaging=new Paging(5,".js-pagination");goods.loadGoods(),basket.getLocalSorage();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIl9kZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJfY3JlYXRlQ2xhc3MiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJHb29kcyIsInRoaXMiLCJfZ29vZHNJblBhZ2UiLCJfYXZhbGlhYmxlIiwiX3NvcnRpbmdWYWx1ZSIsInZhbHVlIiwiZ29vZHMiLCJmaWx0ZXIiLCJlbGVtIiwiYXZhbGlhYmxlIiwic29ydCIsInByZXYiLCJuZXh0IiwicHJpY2UiLCJ4IiwidGl0bGUiLCJ0b0xvd2VyQ2FzZSIsInkiLCJfc29ydGluZ0F2YWxpYWJsZSIsIl9zb3J0aW5nQnlDb3N0IiwiX3NvcnRpbmdCeU5hbWUiLCJkZXNjciIsIm1heExlbmd0aCIsImdhcCIsImxhc3RJbmRleE9mIiwiY29uY2F0Iiwic2xpY2UiLCJnb29kIiwiaWQiLCJpbWFnZSIsIl90cnVuY2F0ZSIsIl90aGlzIiwiYWRkQ29udGVudFRvQ29udGFpbmVyIiwibWFwIiwiX2dldEdvb2RDb250ZW50Iiwiam9pbiIsIl90aGlzMiIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsIl9hZGRHb29kc1RvQ29udGFpbmVyIiwiZ29vZHNQYWdpbmciLCJhZGRQYWdpbmdHZXRJdGVtc0luUGFnZSIsIl9zb3J0aW5nIiwic2V0QWN0aXZlUGFnZSIsImxvYWRHb29kcyIsImZpbmQiLCJpdGVtIiwiQmFza2V0IiwiX2dvb2RzSW5CYXNrZXQiLCJjb3VudCIsIl90aGlzMyIsImdvb2RJbmRleCIsImZpbmRJbmRleCIsInNwbGljZSIsImdvb2RJbkJhc2tldCIsInJlZHVjZSIsInN1bSIsImxvY2FsU3RvcmFnZSIsImdvb2RzSW5CYXNrZXQiLCJKU09OIiwic3RyaW5naWZ5IiwiX3NhdmVUb0xvY2FsU3RvcmFnZSIsIl9hZGRHb29kVG9Db250YWluZXIiLCJfY291bnRUb3RhbENvc3QiLCJnZXRJdGVtIiwicGFyc2UiLCJfY291bnRHb29kc0luQmFza2V0IiwiX2ZpbmRHb29kQW5kQWRkIiwiX3JlbG9hZEJhc2tldCIsIl9maW5kR29vZEFuZFJlbW92ZSIsIlBhZ2luZyIsImFtb3VudFBhZ2VJdGVtcyIsImNvbnRhaW5lciIsIl9jb250YWluZXIiLCJfYW1vdW50UGFnZUl0ZW1zIiwiX2FjdGl2ZVBhZ2UiLCJudW1iZXIiLCJmaXJzdCIsImxhc3QiLCJwQnV0dG9uc0NvbnRlbnQiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJfZ2V0UEJ1dHRvbkNvbnRlbnQiLCJfZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50IiwiaXRlbXMiLCJhbW91bnRCdXR0b25zIiwiTWF0aCIsImNlaWwiLCJfZ2V0UERvdHNDb250ZW50IiwiZmlyc3RJdGVtIiwibGFzdEl0ZW0iLCJfZ2V0UEJ1dHRvbnNDb250ZW50IiwiX2dldEl0ZW1zSW5BY3RpdmVQYWdlIiwiY29udGFpbmVyQ2xhc3MiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcyIsImNsYXNzTmFtZSIsInJlbW92ZUNsYXNzSW5Db250YWluZXIiLCJhbGxDb250YWluZXJzIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwicXVlcnlTZWxlY3RvckFsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVyIiwiZXZlbnROYW1lIiwiZm4iLCJldmVudCIsInRhcmdldEVsZW1lbnQiLCJjb250YWlucyIsImRhdGFzZXQiLCJwQnV0dG9uTnVtYmVyIiwic29ydGluZ1NldHRpbmciLCJzb3J0aW5nIiwic2V0U29ydGluZyIsImFkZCIsInNldEF2YWxpYWJsZSIsImNoZWNrZWQiLCJnb29kSWQiLCJjbG9zZXN0IiwiYmFza2V0IiwiYWRkR29vZFRvQmFza2V0IiwiZ2V0R29vZEluZm9ybWF0aW9uIiwicmVtb3ZlR29vZEZyb21CYXNrZXQiLCJwYXJlbnRFbGVtZW50IiwiYkdvb2RJZCIsImdldExvY2FsU29yYWdlIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLFNBQVNBLG1CQUFtQkMsR0FBTyxPQUFPQyxtQkFBbUJELElBQVFFLGlCQUFpQkYsSUFBUUcscUJBRTlGLFNBQVNBLHFCQUF1QixNQUFNLElBQUlDLFVBQVUsbURBRXBELFNBQVNGLGlCQUFpQkcsR0FBUSxHQUFJQyxPQUFPQyxZQUFZQyxPQUFPSCxJQUFrRCx1QkFBekNHLE9BQU9DLFVBQVVDLFNBQVNDLEtBQUtOLEdBQWdDLE9BQU9PLE1BQU1DLEtBQUtSLEdBRTFKLFNBQVNKLG1CQUFtQkQsR0FBTyxHQUFJWSxNQUFNRSxRQUFRZCxHQUFNLENBQUUsSUFBSyxJQUFJZSxFQUFJLEVBQUdDLEVBQU8sSUFBSUosTUFBTVosRUFBSWlCLFFBQVNGLEVBQUlmLEVBQUlpQixPQUFRRixJQUFPQyxFQUFLRCxHQUFLZixFQUFJZSxHQUFNLE9BQU9DLEdBRTdKLFNBQVNFLGdCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxhQUFvQkMsR0FBZ0IsTUFBTSxJQUFJaEIsVUFBVSxxQ0FFaEgsU0FBU2lCLGtCQUFrQkMsRUFBUUMsR0FBUyxJQUFLLElBQUlSLEVBQUksRUFBR0EsRUFBSVEsRUFBTU4sT0FBUUYsSUFBSyxDQUFFLElBQUlTLEVBQWFELEVBQU1SLEdBQUlTLEVBQVdDLFdBQWFELEVBQVdDLGFBQWMs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QUNsQjNDLE1BQVEsSUFBSU4sTUFDWjBDLFlBQWMsSUFBSThCLE9BQU8sRUFBRyxrQkFFN0JsRSxNQUFNd0MsWUFDTjhFLE9BQU9NIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vINGC0L7QstCw0YDRi1xyXG5jbGFzcyBHb29kcyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHR0aGlzLl9nb29kc0luUGFnZSA9IFtdO1xyXG5cdFx0dGhpcy5fYXZhbGlhYmxlID0gZmFsc2U7XHJcblx0XHR0aGlzLl9zb3J0aW5nVmFsdWUgPSAnbmFtZSc7XHJcblx0fVxyXG5cclxuXHRfc29ydGluZ0F2YWxpYWJsZShnb29kcykge1xyXG5cdFx0cmV0dXJuIGdvb2RzLmZpbHRlcihlbGVtID0+IGVsZW0uYXZhbGlhYmxlKTtcclxuXHR9XHJcblxyXG5cdF9zb3J0aW5nQnlDb3N0KGdvb2RzKSB7XHJcblx0XHRyZXR1cm4gZ29vZHMuc29ydCgocHJldiwgbmV4dCkgPT4gcHJldi5wcmljZSAtIG5leHQucHJpY2UpO1xyXG5cdH1cclxuXHJcblx0X3NvcnRpbmdCeU5hbWUoZ29vZHMpIHtcclxuXHRcdHJldHVybiBnb29kcy5zb3J0KChwcmV2LCBuZXh0KSA9PiB7XHJcblx0XHRcdGNvbnN0IHggPSBwcmV2LnRpdGxlLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdGNvbnN0IHkgPSBuZXh0LnRpdGxlLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdGlmICh4IDwgeSkgcmV0dXJuIC0xO1xyXG5cdFx0XHRpZiAoeCA8IHkpIHJldHVybiAxO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRfc29ydGluZyhnb29kcykge1xyXG5cdFx0aWYgKHRoaXMuX2F2YWxpYWJsZSkgZ29vZHMgPSB0aGlzLl9zb3J0aW5nQXZhbGlhYmxlKGdvb2RzKTtcclxuXHJcblx0XHRpZiAodGhpcy5fc29ydGluZ1ZhbHVlID09ICdjb3N0JykgZ29vZHMgPSB0aGlzLl9zb3J0aW5nQnlDb3N0KGdvb2RzKTtcclxuXHRcdGVsc2UgaWYgKHRoaXMuX3NvcnRpbmdWYWx1ZSA9PSAnbmFtZScpIGdvb2RzID0gdGhpcy5fc29ydGluZ0J5TmFtZShnb29kcyk7XHJcblx0XHRyZXR1cm4gZ29vZHM7XHJcblx0fVxyXG5cclxuXHRfdHJ1bmNhdGUoZGVzY3IsIG1heExlbmd0aCkge1xyXG5cdFx0aWYgKGRlc2NyLmxlbmd0aCA+IG1heExlbmd0aCkge1xyXG5cdFx0XHRsZXQgZ2FwID0gZGVzY3IubGFzdEluZGV4T2YoJyAnLCBtYXhMZW5ndGgpO1xyXG5cdFx0XHRyZXR1cm4gYCR7ZGVzY3Iuc2xpY2UoMCwgZ2FwKX0gLi4uYDtcclxuXHRcdH1cclxuXHRcdHJldHVybiBkZXNjcjtcclxuXHR9XHJcblxyXG5cdF9nZXRHb29kQ29udGVudChnb29kKSB7XHJcblx0XHRsZXQgeyBpZCwgaW1hZ2UsIHRpdGxlLCBwcmljZSwgZGVzY3IgfSA9IGdvb2Q7XHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJnb29kX19pdGVtIGpzLWdvb2QtaXRlbVwiIGRhdGEtZ29vZC1pZD0ke2lkfT5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIi8+PC9kaXY+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9faW5mb3JtYXRpb25cIj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3RpdGxlXCI+JHt0aXRsZX08L2Rpdj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3ByaWNlXCI+JHtwcmljZX0g0YDRg9CxPC9kaXY+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19kZXNjcmlwdGlvblwiPiR7dGhpcy5fdHJ1bmNhdGUoZGVzY3IsIDY1KX08L2Rpdj5cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3RyYW5zYWN0aW9uXCI+XHJcblx0XHRcdFx0XHRcdDxidXR0b24gY2xhc3M9XCJnb29kX19idXR0b24ganMtYWRkLXRvLWJhc2tldFwiPtCU0L7QsdCw0LLQuNGC0Ywg0LIg0LrQvtGA0LfQuNC90YM8L2J1dHRvbj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2Jhc2tldC1mZWVkYmFjayBqcy1nb29kLWluLWJhc2tldFwiPjwvZGl2PlxyXG5cdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0PC9kaXY+YDtcclxuXHR9XHJcblxyXG5cdF9hZGRHb29kc1RvQ29udGFpbmVyKGdvb2RzKSB7XHJcblx0XHR0aGlzLl9nb29kc0luUGFnZSA9IGdvb2RzO1xyXG5cdFx0Y29uc3QgZ29vZHNDb250ZW50ID0gZ29vZHMubWFwKGdvb2QgPT4gdGhpcy5fZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtZ29vZCcsIGdvb2RzQ29udGVudCk7XHJcblx0fVxyXG5cclxuXHRsb2FkR29vZHMoKSB7XHJcblx0XHRmZXRjaCgnaHR0cHM6Ly9kemFkcmFuaWsuZ2l0aHViLmlvL2dvb2RzLWFuZC1iYXNrZXQvc3JjL2pzb24vZ29vZHMuanNvbicpXHJcblx0XHRcdC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuXHRcdFx0LnRoZW4oZ29vZHMgPT4ge1xyXG5cdFx0XHRcdHRoaXMuX2FkZEdvb2RzVG9Db250YWluZXIoZ29vZHNQYWdpbmcuYWRkUGFnaW5nR2V0SXRlbXNJblBhZ2UodGhpcy5fc29ydGluZyhnb29kcykpKTtcclxuXHRcdFx0fSk7XHJcblx0fVxyXG5cclxuXHRzZXRBdmFsaWFibGUodmFsdWUpIHtcclxuXHRcdHRoaXMuX2F2YWxpYWJsZSA9IHZhbHVlO1xyXG5cdFx0Z29vZHNQYWdpbmcuc2V0QWN0aXZlUGFnZSgwKTtcclxuXHRcdHRoaXMubG9hZEdvb2RzKCk7XHJcblx0fVxyXG5cclxuXHRzZXRTb3J0aW5nKHZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy5fc29ydGluZ1ZhbHVlICE9IHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3NvcnRpbmdWYWx1ZSA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLmxvYWRHb29kcygpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0R29vZEluZm9ybWF0aW9uKGlkKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fZ29vZHNJblBhZ2UuZmluZChpdGVtID0+IGl0ZW0uaWQgPT0gaWQpO1xyXG5cdH1cclxufVxyXG5cclxuLy/QutC+0YDQt9C40L3QsFxyXG5jbGFzcyBCYXNrZXQge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5fZ29vZHNJbkJhc2tldCA9IFtdO1xyXG5cdH1cclxuXHJcblx0X2dldEdvb2RDb250ZW50KGdvb2QpIHtcclxuXHRcdGxldCB7IGlkLCBpbWFnZSwgdGl0bGUsIGNvdW50IH0gPSBnb29kO1xyXG5cdFx0cmV0dXJuIGA8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWl0ZW1cIiBkYXRhLWItZ29vZC1pZD1cIiR7aWR9XCI+XHJcblx0XHRcdDxidXR0b24gY2xhc3M9XCJiYXNrZXRfX2dvb2QtcmVtb3ZlIGpzLXJlbW92ZS1nb29kXCI+JiMxMjg5Mzg7PC9idXR0b24+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtaW1hZ2VcIj48aW1nIHNyYz1cIiR7aW1hZ2V9XCIvPjwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLW5hbWVcIj4ke3RpdGxlfTwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWFtb3V0XCI+JHtjb3VudH08L2Rpdj5cclxuXHRcdDwvZGl2PmA7XHJcblx0fVxyXG5cclxuXHRfYWRkR29vZFRvQ29udGFpbmVyKCkge1xyXG5cdFx0bGV0IGdvb2RzQ29udGVudCA9IHRoaXMuX2dvb2RzSW5CYXNrZXQubWFwKGdvb2QgPT4gdGhpcy5fZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtYmFza2V0LWdvb2QnLCBnb29kc0NvbnRlbnQpO1xyXG5cdH1cclxuXHJcblx0X2ZpbmRHb29kQW5kUmVtb3ZlKGlkKSB7XHJcblx0XHRsZXQgZ29vZEluZGV4ID0gdGhpcy5fZ29vZHNJbkJhc2tldC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSAraWQpO1xyXG5cdFx0dGhpcy5fZ29vZHNJbkJhc2tldC5zcGxpY2UoZ29vZEluZGV4LCAxKTtcclxuXHR9XHJcblxyXG5cdF9maW5kR29vZEFuZEFkZChnb29kKSB7XHJcblx0XHRsZXQgZ29vZEluQmFza2V0ID0gdGhpcy5fZ29vZHNJbkJhc2tldC5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PT0gZ29vZC5pZCk7XHJcblx0XHRpZiAoZ29vZEluQmFza2V0KSB7XHJcblx0XHRcdGdvb2RJbkJhc2tldC5jb3VudCsrO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Z29vZC5jb3VudCA9IDE7XHJcblx0XHRcdHRoaXMuX2dvb2RzSW5CYXNrZXQgPSBbLi4udGhpcy5fZ29vZHNJbkJhc2tldCwgZ29vZF07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRfY291bnRUb3RhbENvc3QoKSB7XHJcblx0XHRsZXQgdG90YWxDb3N0ID0gdGhpcy5fZ29vZHNJbkJhc2tldC5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5jb3VudCAqIGl0ZW0ucHJpY2UsIDApO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtY291bnQtcmVzdWx0JywgdG90YWxDb3N0KTtcclxuXHR9XHJcblxyXG5cdF9zYXZlVG9Mb2NhbFN0b3JhZ2UoKSB7XHJcblx0XHRsb2NhbFN0b3JhZ2UuZ29vZHNJbkJhc2tldCA9IEpTT04uc3RyaW5naWZ5KHRoaXMuX2dvb2RzSW5CYXNrZXQpO1xyXG5cdH1cclxuXHJcblx0X2NvdW50R29vZHNJbkJhc2tldCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9nb29kc0luQmFza2V0LnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBpdGVtLmNvdW50LCAwKTtcclxuXHR9XHJcblxyXG5cdF9yZWxvYWRCYXNrZXQoKSB7XHJcblx0XHR0aGlzLl9zYXZlVG9Mb2NhbFN0b3JhZ2UoKTtcclxuXHRcdHRoaXMuX2FkZEdvb2RUb0NvbnRhaW5lcigpO1xyXG5cdFx0dGhpcy5fY291bnRUb3RhbENvc3QoKTtcclxuXHR9XHJcblxyXG5cdGdldExvY2FsU29yYWdlKCkge1xyXG5cdFx0aWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29kc0luQmFza2V0JykgIT0gbnVsbClcclxuXHRcdFx0dGhpcy5fZ29vZHNJbkJhc2tldCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2RzSW5CYXNrZXQnKSk7XHJcblx0XHR0aGlzLl9hZGRHb29kVG9Db250YWluZXIoKTtcclxuXHRcdHRoaXMuX2NvdW50VG90YWxDb3N0KCk7XHJcblx0fVxyXG5cclxuXHRnZXRDb3VudEdvb2RzSW5CYXNrZXQoKSB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1nb29kLWluLWJhc2tldCcsIHRoaXMuX2NvdW50R29vZHNJbkJhc2tldCgpKTtcclxuXHR9XHJcblxyXG5cdGFkZEdvb2RUb0Jhc2tldChnb29kKSB7XHJcblx0XHR0aGlzLl9maW5kR29vZEFuZEFkZChnb29kKTtcclxuXHRcdHRoaXMuX3JlbG9hZEJhc2tldCgpO1xyXG5cdH1cclxuXHJcblx0cmVtb3ZlR29vZEZyb21CYXNrZXQoaWQpIHtcclxuXHRcdHRoaXMuX2ZpbmRHb29kQW5kUmVtb3ZlKGlkKTtcclxuXHRcdHRoaXMuX3JlbG9hZEJhc2tldCgpO1xyXG5cdH1cclxufVxyXG5cclxuLy/Qv9Cw0LPQuNC90LDRhtC40Y9cclxuY2xhc3MgUGFnaW5nIHtcclxuXHRjb25zdHJ1Y3RvcihhbW91bnRQYWdlSXRlbXMsIGNvbnRhaW5lcikge1xyXG5cdFx0dGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xyXG5cdFx0dGhpcy5fYW1vdW50UGFnZUl0ZW1zID0gYW1vdW50UGFnZUl0ZW1zO1xyXG5cdFx0dGhpcy5fYWN0aXZlUGFnZSA9IDA7XHJcblx0fVxyXG5cclxuXHRfZ2V0UEJ1dHRvbkNvbnRlbnQobnVtYmVyKSB7XHJcblx0XHRyZXR1cm4gYDxidXR0b24gXHJcblx0XHRcdFx0XHRjbGFzcz1cInBhZ2luYXRpb25fX2J1dHRvbiBqcy1wYWdpbmF0aW9uLWJ1dHRvbiBcclxuXHRcdFx0XHRcdCR7bnVtYmVyID09PSB0aGlzLl9hY3RpdmVQYWdlID8gJ2FjdGl2ZScgOiAnJ31cIiBcclxuXHRcdFx0XHRcdGRhdGEtcC1idXR0b24tbnVtYmVyPVwiJHtudW1iZXIgKyAxfVwiPlxyXG5cdFx0XHRcdFx0XHQke251bWJlciArIDF9XHJcblx0XHRcdFx0PC9idXR0b24+YDtcclxuXHR9XHJcblxyXG5cdF9nZXRQRG90c0NvbnRlbnQoKSB7XHJcblx0XHRyZXR1cm4gYDxzcGFuIGNsYXNzPSdwYWdpbmF0aW9uX19kb3RzJz4uLi48L3NwYW4+YDtcclxuXHR9XHJcblxyXG5cdF9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoZmlyc3QsIGxhc3QsIHBCdXR0b25zQ29udGVudCA9ICcnKSB7XHJcblx0XHRpZiAoZmlyc3QgPCBsYXN0KSB7XHJcblx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uQ29udGVudChmaXJzdCk7XHJcblx0XHRcdHJldHVybiB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoZmlyc3QgKyAxLCBsYXN0LCBwQnV0dG9uc0NvbnRlbnQpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHBCdXR0b25zQ29udGVudDtcclxuXHR9XHJcblxyXG5cdF9nZXRQQnV0dG9uc0NvbnRlbnQoaXRlbXMpIHtcclxuXHRcdGxldCBhbW91bnRCdXR0b25zID0gTWF0aC5jZWlsKGl0ZW1zLmxlbmd0aCAvIHRoaXMuX2Ftb3VudFBhZ2VJdGVtcyksIC8vINC60L7Qu9C40YfQtdGB0YLQstC+INGB0YLRgNCw0L3QuNGGXHJcblx0XHRcdHBCdXR0b25zQ29udGVudCA9ICcnOyAvLyDRgNCw0LfQvNC10YLQutCwINC60L3QvtC/0L7QuiDQv9Cw0LPQuNC90LDRhtC40LhcclxuXHJcblx0XHRpZiAoYW1vdW50QnV0dG9ucyA+IDYpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPCAyIHx8IHRoaXMuX2FjdGl2ZVBhZ2UgPiBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMyk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDMsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPT0gMikge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgNCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDEsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPT0gYW1vdW50QnV0dG9ucyAtIDMpIHtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIDEpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQRG90c0NvbnRlbnQoKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KGFtb3VudEJ1dHRvbnMgLSA0LCBhbW91bnRCdXR0b25zKTtcclxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLl9hY3RpdmVQYWdlID4gMiAmJiB0aGlzLl9hY3RpdmVQYWdlIDwgYW1vdW50QnV0dG9ucyAtIDMpIHtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIDEpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQRG90c0NvbnRlbnQoKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KHRoaXMuX2FjdGl2ZVBhZ2UgLSAxLCB0aGlzLl9hY3RpdmVQYWdlICsgMik7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDEsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHBCdXR0b25zQ29udGVudDtcclxuXHR9XHJcblxyXG5cdF9nZXRJdGVtc0luQWN0aXZlUGFnZShpdGVtcykge1xyXG5cdFx0Y29uc3QgZmlyc3RJdGVtID0gdGhpcy5fYWN0aXZlUGFnZSAqIHRoaXMuX2Ftb3VudFBhZ2VJdGVtcyxcclxuXHRcdFx0bGFzdEl0ZW0gPSBmaXJzdEl0ZW0gKyB0aGlzLl9hbW91bnRQYWdlSXRlbXM7XHJcblx0XHRyZXR1cm4gaXRlbXMuc2xpY2UoZmlyc3RJdGVtLCBsYXN0SXRlbSk7XHJcblx0fVxyXG5cclxuXHRzZXRBY3RpdmVQYWdlKG51bWJlcikge1xyXG5cdFx0dGhpcy5fYWN0aXZlUGFnZSA9IG51bWJlcjtcclxuXHR9XHJcblxyXG5cdGFkZFBhZ2luZ0dldEl0ZW1zSW5QYWdlKGl0ZW1zKSB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIodGhpcy5fY29udGFpbmVyLCB0aGlzLl9nZXRQQnV0dG9uc0NvbnRlbnQoaXRlbXMpKTtcclxuXHRcdHJldHVybiB0aGlzLl9nZXRJdGVtc0luQWN0aXZlUGFnZShpdGVtcyk7XHJcblx0fVxyXG59XHJcblxyXG4vL9CU0L7QsdCw0LLQu9C10L3QuNC1INGN0LvQtdC80LXQvdGC0L7QsiDQsiDQutC+0L3RgtC10LnQvdC10YBcclxuZnVuY3Rpb24gYWRkQ29udGVudFRvQ29udGFpbmVyKGNvbnRhaW5lckNsYXNzLCBlbGVtZW50KSB7XHJcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJDbGFzcyk7XHJcblx0aWYgKGNvbnRhaW5lcikgY29udGFpbmVyLmlubmVySFRNTCA9IGVsZW1lbnQ7XHJcbn1cclxuXHJcbi8v0YPQtNCw0LvQuNGC0Ywg0LrQu9Cw0YHRgSDRgyDQs9GA0YPQv9C/0Ysg0LrQvtC90YLQtdC50L3QtdGA0L7QslxyXG5mdW5jdGlvbiBmaW5kQ29udGFpbmVyc0FuZFJlbW92ZUNsYXNzKGNvbnRhaW5lckNsYXNzLCBjbGFzc05hbWUpIHtcclxuXHRjb25zdCByZW1vdmVDbGFzc0luQ29udGFpbmVyID0gKGFsbENvbnRhaW5lcnMsIGNsYXNzTmFtZSwgaSA9IDApID0+IHtcclxuXHRcdGlmIChpIDwgYWxsQ29udGFpbmVycy5sZW5ndGgpIHtcclxuXHRcdFx0YWxsQ29udGFpbmVyc1tpXS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XHJcblx0XHRcdHJldHVybiByZW1vdmVDbGFzc0luQ29udGFpbmVyKGFsbENvbnRhaW5lcnMsIGNsYXNzTmFtZSwgaSArIDEpO1xyXG5cdFx0fVxyXG5cdH07XHJcblx0bGV0IGFsbENvbnRhaW5lcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbnRhaW5lckNsYXNzKTtcclxuXHRyZW1vdmVDbGFzc0luQ29udGFpbmVyKGFsbENvbnRhaW5lcnMsIGNsYXNzTmFtZSk7XHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHtcclxuXHRjb25zdCBoYW5kbGVyID0gKGVsZW1lbnQsIGV2ZW50TmFtZSwgZm4pID0+IHtcclxuXHRcdGNvbnN0IGVsZW1lbnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpO1xyXG5cdFx0ZWxlbWVudENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZXZlbnQgPT4gZm4oZXZlbnQpKTtcclxuXHR9O1xyXG5cclxuXHQvL9GB0LvRg9GI0LDQu9C60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGC0L7RgNCwXHJcblx0aGFuZGxlcignLmpzLXBhZ2luYXRpb24nLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1wYWdpbmF0aW9uLWJ1dHRvbicpICYmICF0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuXHRcdFx0Z29vZHNQYWdpbmcuc2V0QWN0aXZlUGFnZSh0YXJnZXRFbGVtZW50LmRhdGFzZXQucEJ1dHRvbk51bWJlciAtIDEpO1xyXG5cdFx0XHRnb29kcy5sb2FkR29vZHMoKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0YHQu9GD0YjQsNC70LrQsCDRgdC+0YDRgtC40YDQvtCy0L7QulxyXG5cdGhhbmRsZXIoJy5qcy1zb3J0aW5nLWJ1dHRvbnMnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1zb3J0aW5nJykgJiYgIXRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xyXG5cdFx0XHRjb25zdCBzb3J0aW5nU2V0dGluZyA9IHRhcmdldEVsZW1lbnQuZGF0YXNldC5zb3J0aW5nO1xyXG5cdFx0XHRmaW5kQ29udGFpbmVyc0FuZFJlbW92ZUNsYXNzKCcuanMtc29ydGluZycsICdhY3RpdmUnKTtcclxuXHRcdFx0Z29vZHMuc2V0U29ydGluZyhzb3J0aW5nU2V0dGluZyk7XHJcblx0XHRcdHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vINGB0LvRg9GI0LDQu9C60LAg0YHQvtGA0YLQuNGA0L7QstC60Lgg0L/QviDQvdCw0LvQuNGH0LjRjlxyXG5cdGhhbmRsZXIoJy5qcy1hdmFsaWFibGUnLCAnY2hhbmdlJywgZXZlbnQgPT4ge1xyXG5cdFx0Z29vZHMuc2V0QXZhbGlhYmxlKGV2ZW50LnRhcmdldC5jaGVja2VkKTtcclxuXHR9KTtcclxuXHJcblx0Ly8g0LrQvdC+0L/QutCwINC00L7QsdCw0LLQuNGC0Ywg0LIg0LrQvtGA0LfQuNC90YNcclxuXHRoYW5kbGVyKCcuanMtZ29vZCcsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1hZGQtdG8tYmFza2V0JykpIHtcclxuXHRcdFx0bGV0IGdvb2RJZCA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuanMtZ29vZC1pdGVtJykuZGF0YXNldC5nb29kSWQ7XHJcblx0XHRcdGJhc2tldC5hZGRHb29kVG9CYXNrZXQoZ29vZHMuZ2V0R29vZEluZm9ybWF0aW9uKGdvb2RJZCkpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyDQutC90L7Qv9C60LAg0YPQtNCw0LvQuNGC0Ywg0LjQtyDQutC+0YDQt9C40L3Ri1xyXG5cdGhhbmRsZXIoJy5qcy1iYXNrZXQtZ29vZCcsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1yZW1vdmUtZ29vZCcpKSB7XHJcblx0XHRcdGJhc2tldC5yZW1vdmVHb29kRnJvbUJhc2tldChldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5kYXRhc2V0LmJHb29kSWQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59KTtcclxuXHJcbmNvbnN0IGJhc2tldCA9IG5ldyBCYXNrZXQoKSxcclxuXHRnb29kcyA9IG5ldyBHb29kcygpLFxyXG5cdGdvb2RzUGFnaW5nID0gbmV3IFBhZ2luZyg1LCAnLmpzLXBhZ2luYXRpb24nKTtcclxuXHJcbmdvb2RzLmxvYWRHb29kcygpO1xyXG5iYXNrZXQuZ2V0TG9jYWxTb3JhZ2UoKTtcclxuIl19
