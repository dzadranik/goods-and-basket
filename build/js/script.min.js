"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),t}function GoodSetting(){var t=[],n=!1,e="name";this.loadGoods=function(){fetch("https://dzadranik.github.io/goods-and-basket/src/json/goods.json").then((function(t){return t.json()})).then((function(o){!function(n){t=n,addContentToContainer(".js-good",n.map((function(t){return function(t){var n=t.id,e=t.image,o=t.title,a=t.price,i=t.descr;return'<div class="good__item js-good-item" data-good-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(e,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(o,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(a,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(function(t,n){if(t.length>n){var e=t.lastIndexOf(" ",n);return"".concat(t.slice(0,e)," ...")}return t}(i,65),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button js-add-to-basket">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}(t)})).join(""))}(goodsPaging.addPagingGetItemsInPage(function(t){return n&&(t=function(t){return t.filter((function(t){return t.avaliable}))}(t)),"cost"==e?t=function(t){return t.sort((function(t,n){return t.price-n.price}))}(t):"name"==e&&(t=function(t){return t.sort((function(t,n){var e=t.title.toLowerCase(),o=n.title.toLowerCase();return e<o?-1:e<o?1:void 0}))}(t)),t}(o)))}))},this.setAvaliable=function(t){n=t,goodsPaging.setActivePage(0),this.loadGoods()},this.setSorting=function(t){e!=t&&(e=t,this.loadGoods())},this.getGoodInformation=function(n){return t.find((function(t){return t.id==n}))}}var Paging=function(){function t(n,e){_classCallCheck(this,t),this._container=e,this._amountPageItems=n,this._activePage=0}return _createClass(t,[{key:"_getPButtonContent",value:function(t){return'<button \n\t\t\t\t\tclass="pagination__button js-pagination-button \n\t\t\t\t\t'.concat(t===this._activePage?"active":"",'" \n\t\t\t\t\tdata-p-button-number="').concat(t+1,'">\n\t\t\t\t\t\t').concat(t+1,"\n\t\t\t\t</button>")}},{key:"_getPDotsContent",value:function(){return"<span class='pagination__dots'>...</span>"}},{key:"_getPButtonsNumberContent",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t<n?(e+=this._getPButtonContent(t),this._getPButtonsNumberContent(t+1,n,e)):e}},{key:"_getPButtonsContent",value:function(t){var n=Math.ceil(t.length/this._amountPageItems),e="";return n>6?this._activePage<2||this._activePage>n-3?(e+=this._getPButtonsNumberContent(0,3),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-3,n)):2==this._activePage?(e+=this._getPButtonsNumberContent(0,4),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-1,n)):this._activePage==n-3?(e+=this._getPButtonsNumberContent(0,1),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-4,n)):this._activePage>2&&this._activePage<n-3&&(e+=this._getPButtonsNumberContent(0,1),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(this._activePage-1,this._activePage+2),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-1,n)):e+=this._getPButtonsNumberContent(0,n),e}},{key:"_getItemsInActivePage",value:function(t){var n=this._activePage*this._amountPageItems,e=n+this._amountPageItems;return t.slice(n,e)}},{key:"setActivePage",value:function(t){this._activePage=t}},{key:"addPagingGetItemsInPage",value:function(t){return addContentToContainer(this._container,this._getPButtonsContent(t)),this._getItemsInActivePage(t)}}]),t}();function BasketSetting(){var t=[],n=function(){addContentToContainer(".js-basket-good",t.map((function(t){return function(t){var n=t.id,e=t.image,o=t.title,a=t.count;return'<div class="basket__good-item" data-b-good-id="'.concat(n,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(e,'"/></div>\n\t\t\t<div class="basket__good-name">').concat(o,'</div>\n\t\t\t<div class="basket__good-amout">').concat(a,"</div>\n\t\t</div>")}(t)})).join(""))},e=function(){addContentToContainer(".js-count-result",t.reduce((function(t,n){return t+n.count*n.price}),0))},o=function(){localStorage.goodsInBasket=JSON.stringify(t),n(),e()};this.getLocalSorage=function(){null!=localStorage.getItem("goodsInBasket")&&(t=JSON.parse(localStorage.getItem("goodsInBasket"))),n(),e()},this.getCountGoodsInBasket=function(){addContentToContainer(".js-good-in-basket",t.reduce((function(t,n){return t+n.count}),0))},this.addGoodToBasket=function(n){!function(n){var e=t.find((function(t){return t.id===n.id}));e?e.count++:(n.count=1,t=[].concat(_toConsumableArray(t),[n]))}(n),o()},this.removeGoodFromBasket=function(n){!function(n){var e=t.findIndex((function(t){return t.id===+n}));t.splice(e,1)}(n),o()}}function addContentToContainer(t,n){var e=document.querySelector(t);e&&(e.innerHTML=n)}function findContainersAndRemoveClass(t,n){!function t(n,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(o<n.length)return n[o].classList.remove(e),t(n,e,o+1)}(document.querySelectorAll(t),n)}document.addEventListener("DOMContentLoaded",(function(){var t=function(t,n,e){document.querySelector(t).addEventListener(n,(function(t){return e(t)}))};t(".js-pagination","click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&(goodsPaging.setActivePage(n.dataset.pButtonNumber-1),goods.loadGoods())})),t(".js-sorting-buttons","click",(function(t){var n=t.target;if(n.classList.contains("js-sorting")&&!n.classList.contains("active")){var e=n.dataset.sorting;findContainersAndRemoveClass(".js-sorting","active"),goods.setSorting(e),n.classList.add("active")}})),t(".js-avaliable","change",(function(t){goods.setAvaliable(t.target.checked)})),t(".js-good","click",(function(t){if(t.target.classList.contains("js-add-to-basket")){var n=t.target.closest(".js-good-item").dataset.goodId;basket.addGoodToBasket(goods.getGoodInformation(n))}})),t(".js-basket-good","click",(function(t){t.target.classList.contains("js-remove-good")&&basket.removeGoodFromBasket(t.target.parentElement.dataset.bGoodId)}))}));var basket=new BasketSetting,goods=new GoodSetting,goodsPaging=new Paging(5,".js-pagination");goods.loadGoods(),basket.getLocalSorage();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIl9kZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJfY3JlYXRlQ2xhc3MiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJHb29kU2V0dGluZyIsImdvb2RzSW5QYWdlIiwiYXZhbGlhYmxlIiwic29ydGluZ1ZhbHVlIiwidGhpcyIsImxvYWRHb29kcyIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsImdvb2RzIiwiYWRkQ29udGVudFRvQ29udGFpbmVyIiwibWFwIiwiZ29vZCIsImlkIiwiaW1hZ2UiLCJ0aXRsZSIsInByaWNlIiwiZGVzY3IiLCJjb25jYXQiLCJtYXhMZW5ndGgiLCJnYXAiLCJsYXN0SW5kZXhPZiIsInNsaWNlIiwidHJ1bmNhdGUiLCJnZXRHb29kQ29udGVudCIsImpvaW4iLCJhZGRHb29kc1RvQ29udGFpbmVyIiwiZ29vZHNQYWdpbmciLCJhZGRQYWdpbmdHZXRJdGVtc0luUGFnZSIsImZpbHRlciIsImVsZW0iLCJzb3J0aW5nQXZhbGlhYmxlIiwic29ydCIsInByZXYiLCJuZXh0Iiwic29ydGluZ0J5Q29zdCIsIngiLCJ0b0xvd2VyQ2FzZSIsInkiLCJzb3J0aW5nQnlOYW1lIiwic29ydGluZyIsInNldEF2YWxpYWJsZSIsInZhbHVlIiwic2V0QWN0aXZlUGFnZSIsInNldFNvcnRpbmciLCJnZXRHb29kSW5mb3JtYXRpb24iLCJmaW5kIiwiaXRlbSIsIlBhZ2luZyIsImFtb3VudFBhZ2VJdGVtcyIsImNvbnRhaW5lciIsIl9jb250YWluZXIiLCJfYW1vdW50UGFnZUl0ZW1zIiwiX2FjdGl2ZVBhZ2UiLCJudW1iZXIiLCJmaXJzdCIsImxhc3QiLCJwQnV0dG9uc0NvbnRlbnQiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJfZ2V0UEJ1dHRvbkNvbnRlbnQiLCJfZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50IiwiaXRlbXMiLCJhbW91bnRCdXR0b25zIiwiTWF0aCIsImNlaWwiLCJfZ2V0UERvdHNDb250ZW50IiwiZmlyc3RJdGVtIiwibGFzdEl0ZW0iLCJfZ2V0UEJ1dHRvbnNDb250ZW50IiwiX2dldEl0ZW1zSW5BY3RpdmVQYWdlIiwiQmFza2V0U2V0dGluZyIsImdvb2RzSW5CYXNrZXQiLCJhZGRHb29kVG9Db250YWluZXIiLCJjb3VudCIsImNvdW50VG90YWxDb3N0IiwicmVkdWNlIiwic3VtIiwicmVsb2FkQmFza2V0IiwibG9jYWxTdG9yYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldExvY2FsU29yYWdlIiwiZ2V0SXRlbSIsInBhcnNlIiwiZ2V0Q291bnRHb29kc0luQmFza2V0IiwiYWRkR29vZFRvQmFza2V0IiwiZ29vZEluQmFza2V0IiwiZmluZEdvb2RBbmRBZGQiLCJyZW1vdmVHb29kRnJvbUJhc2tldCIsImdvb2RJbmRleCIsImZpbmRJbmRleCIsInNwbGljZSIsImZpbmRHb29kQW5kUmVtb3ZlIiwiY29udGFpbmVyQ2xhc3MiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaW5uZXJIVE1MIiwiZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcyIsImNsYXNzTmFtZSIsInJlbW92ZUNsYXNzSW5Db250YWluZXIiLCJhbGxDb250YWluZXJzIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwicXVlcnlTZWxlY3RvckFsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVyIiwiZXZlbnROYW1lIiwiZm4iLCJldmVudCIsInRhcmdldEVsZW1lbnQiLCJjb250YWlucyIsImRhdGFzZXQiLCJwQnV0dG9uTnVtYmVyIiwic29ydGluZ1NldHRpbmciLCJhZGQiLCJjaGVja2VkIiwiZ29vZElkIiwiY2xvc2VzdCIsImJhc2tldCIsInBhcmVudEVsZW1lbnQiLCJiR29vZElkIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLFNBQVNBLG1CQUFtQkMsR0FBTyxPQUFPQyxtQkFBbUJELElBQVFFLGlCQUFpQkYsSUFBUUcscUJBRTlGLFNBQVNBLHFCQUF1QixNQUFNLElBQUlDLFVBQVUsbURBRXBELFNBQVNGLGlCQUFpQkcsR0FBUSxHQUFJQyxPQUFPQyxZQUFZQyxPQUFPSCxJQUFrRCx1QkFBekNHLE9BQU9DLFVBQVVDLFNBQVNDLEtBQUtOLEdBQWdDLE9BQU9PLE1BQU1DLEtBQUtSLEdBRTFKLFNBQVNKLG1CQUFtQkQsR0FBTyxHQUFJWSxNQUFNRSxRQUFRZCxHQUFNLENBQUUsSUFBSyxJQUFJZSxFQUFJLEVBQUdDLEVBQU8sSUFBSUosTUFBTVosRUFBSWlCLFFBQVNGLEVBQUlmLEVBQUlpQixPQUFRRixJQUFPQyxFQUFLRCxHQUFLZixFQUFJZSxHQUFNLE9BQU9DLEdBRTdKLFNBQVNFLGdCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxhQUFvQkMsR0FBZ0IsTUFBTSxJQUFJaEIsVUFBVSxxQ0FFaEgsU0FBU2lCLGtCQUFrQkMsRUFBUUMsR0FBUyxJQUFLLElBQUlSLEVBQUksRUFBR0EsRUFBSVEsRUFBTU4sT0FBUUYsSUFBSyxDQUFFLElBQUlTLEVBQWFELEVBQU1SLEdBQUlTLEVBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFVBQVdGLElBQVlBLEVBQVdHLFVBQVcsR0FBTW5CLE9BQU9vQixlQUFlTixFQUFRRSxFQUFXSyxJQUFLTCxJQUU3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OlsiLy8g0YLQvtCy0LDRgNGLXHJcbmZ1bmN0aW9uIEdvb2RTZXR0aW5nKCkge1xyXG5cdGxldCBnb29kc0luUGFnZSA9IFtdLFxyXG5cdFx0YXZhbGlhYmxlID0gZmFsc2UsXHJcblx0XHRzb3J0aW5nVmFsdWUgPSAnbmFtZSc7XHJcblxyXG5cdGNvbnN0IHNvcnRpbmdBdmFsaWFibGUgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuZmlsdGVyKGVsZW0gPT4gZWxlbS5hdmFsaWFibGUpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNvcnRpbmdCeUNvc3QgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuc29ydCgocHJldiwgbmV4dCkgPT4gcHJldi5wcmljZSAtIG5leHQucHJpY2UpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNvcnRpbmdCeU5hbWUgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuc29ydCgocHJldiwgbmV4dCkgPT4ge1xyXG5cdFx0XHRjb25zdCB4ID0gcHJldi50aXRsZS50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0XHRjb25zdCB5ID0gbmV4dC50aXRsZS50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0XHRpZiAoeCA8IHkpIHJldHVybiAtMTtcclxuXHRcdFx0aWYgKHggPCB5KSByZXR1cm4gMTtcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNvcnRpbmcgPSBnb29kcyA9PiB7XHJcblx0XHRpZiAoYXZhbGlhYmxlKSBnb29kcyA9IHNvcnRpbmdBdmFsaWFibGUoZ29vZHMpO1xyXG5cclxuXHRcdGlmIChzb3J0aW5nVmFsdWUgPT0gJ2Nvc3QnKSBnb29kcyA9IHNvcnRpbmdCeUNvc3QoZ29vZHMpO1xyXG5cdFx0ZWxzZSBpZiAoc29ydGluZ1ZhbHVlID09ICduYW1lJykgZ29vZHMgPSBzb3J0aW5nQnlOYW1lKGdvb2RzKTtcclxuXHRcdHJldHVybiBnb29kcztcclxuXHR9O1xyXG5cclxuXHRjb25zdCB0cnVuY2F0ZSA9IGZ1bmN0aW9uKGRlc2NyLCBtYXhMZW5ndGgpIHtcclxuXHRcdGlmIChkZXNjci5sZW5ndGggPiBtYXhMZW5ndGgpIHtcclxuXHRcdFx0bGV0IGdhcCA9IGRlc2NyLmxhc3RJbmRleE9mKCcgJywgbWF4TGVuZ3RoKTtcclxuXHRcdFx0cmV0dXJuIGAke2Rlc2NyLnNsaWNlKDAsIGdhcCl9IC4uLmA7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZGVzY3I7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0R29vZENvbnRlbnQgPSBnb29kID0+IHtcclxuXHRcdGxldCB7IGlkLCBpbWFnZSwgdGl0bGUsIHByaWNlLCBkZXNjciB9ID0gZ29vZDtcclxuXHRcdHJldHVybiBgPGRpdiBjbGFzcz1cImdvb2RfX2l0ZW0ganMtZ29vZC1pdGVtXCIgZGF0YS1nb29kLWlkPSR7aWR9PlxyXG5cdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2ltYWdlXCI+PGltZyBzcmM9XCIke2ltYWdlfVwiLz48L2Rpdj5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19pbmZvcm1hdGlvblwiPlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fdGl0bGVcIj4ke3RpdGxlfTwvZGl2PlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fcHJpY2VcIj4ke3ByaWNlfSDRgNGD0LE8L2Rpdj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2Rlc2NyaXB0aW9uXCI+JHt0cnVuY2F0ZShkZXNjciwgNjUpfTwvZGl2PlxyXG5cdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fdHJhbnNhY3Rpb25cIj5cclxuXHRcdFx0XHRcdFx0PGJ1dHRvbiBjbGFzcz1cImdvb2RfX2J1dHRvbiBqcy1hZGQtdG8tYmFza2V0XCI+0JTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3RgzwvYnV0dG9uPlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fYmFza2V0LWZlZWRiYWNrIGpzLWdvb2QtaW4tYmFza2V0XCI+PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHQ8L2Rpdj5gO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGFkZEdvb2RzVG9Db250YWluZXIgPSBnb29kcyA9PiB7XHJcblx0XHRnb29kc0luUGFnZSA9IGdvb2RzO1xyXG5cdFx0Y29uc3QgZ29vZHNDb250ZW50ID0gZ29vZHMubWFwKGdvb2QgPT4gZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtZ29vZCcsIGdvb2RzQ29udGVudCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5sb2FkR29vZHMgPSBmdW5jdGlvbigpIHtcclxuXHRcdGZldGNoKCdodHRwczovL2R6YWRyYW5pay5naXRodWIuaW8vZ29vZHMtYW5kLWJhc2tldC9zcmMvanNvbi9nb29kcy5qc29uJylcclxuXHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG5cdFx0XHQudGhlbihnb29kcyA9PiB7XHJcblx0XHRcdFx0YWRkR29vZHNUb0NvbnRhaW5lcihnb29kc1BhZ2luZy5hZGRQYWdpbmdHZXRJdGVtc0luUGFnZShzb3J0aW5nKGdvb2RzKSkpO1xyXG5cdFx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLnNldEF2YWxpYWJsZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRhdmFsaWFibGUgPSB2YWx1ZTtcclxuXHRcdGdvb2RzUGFnaW5nLnNldEFjdGl2ZVBhZ2UoMCk7XHJcblx0XHR0aGlzLmxvYWRHb29kcygpO1xyXG5cdH07XHJcblxyXG5cdHRoaXMuc2V0U29ydGluZyA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRpZiAoc29ydGluZ1ZhbHVlICE9IHZhbHVlKSB7XHJcblx0XHRcdHNvcnRpbmdWYWx1ZSA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLmxvYWRHb29kcygpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdHRoaXMuZ2V0R29vZEluZm9ybWF0aW9uID0gZnVuY3Rpb24oaWQpIHtcclxuXHRcdHJldHVybiBnb29kc0luUGFnZS5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PSBpZCk7XHJcblx0fTtcclxufVxyXG5cclxuLy/Qv9Cw0LPQuNC90LDRhtC40Y9cclxuY2xhc3MgUGFnaW5nIHtcclxuXHRjb25zdHJ1Y3RvcihhbW91bnRQYWdlSXRlbXMsIGNvbnRhaW5lcikge1xyXG5cdFx0dGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xyXG5cdFx0dGhpcy5fYW1vdW50UGFnZUl0ZW1zID0gYW1vdW50UGFnZUl0ZW1zO1xyXG5cdFx0dGhpcy5fYWN0aXZlUGFnZSA9IDA7XHJcblx0fVxyXG5cclxuXHRfZ2V0UEJ1dHRvbkNvbnRlbnQobnVtYmVyKSB7XHJcblx0XHRyZXR1cm4gYDxidXR0b24gXHJcblx0XHRcdFx0XHRjbGFzcz1cInBhZ2luYXRpb25fX2J1dHRvbiBqcy1wYWdpbmF0aW9uLWJ1dHRvbiBcclxuXHRcdFx0XHRcdCR7bnVtYmVyID09PSB0aGlzLl9hY3RpdmVQYWdlID8gJ2FjdGl2ZScgOiAnJ31cIiBcclxuXHRcdFx0XHRcdGRhdGEtcC1idXR0b24tbnVtYmVyPVwiJHtudW1iZXIgKyAxfVwiPlxyXG5cdFx0XHRcdFx0XHQke251bWJlciArIDF9XHJcblx0XHRcdFx0PC9idXR0b24+YDtcclxuXHR9XHJcblxyXG5cdF9nZXRQRG90c0NvbnRlbnQoKSB7XHJcblx0XHRyZXR1cm4gYDxzcGFuIGNsYXNzPSdwYWdpbmF0aW9uX19kb3RzJz4uLi48L3NwYW4+YDtcclxuXHR9XHJcblxyXG5cdF9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoZmlyc3QsIGxhc3QsIHBCdXR0b25zQ29udGVudCA9ICcnKSB7XHJcblx0XHRpZiAoZmlyc3QgPCBsYXN0KSB7XHJcblx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uQ29udGVudChmaXJzdCk7XHJcblx0XHRcdHJldHVybiB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoZmlyc3QgKyAxLCBsYXN0LCBwQnV0dG9uc0NvbnRlbnQpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHBCdXR0b25zQ29udGVudDtcclxuXHR9XHJcblxyXG5cdF9nZXRQQnV0dG9uc0NvbnRlbnQoaXRlbXMpIHtcclxuXHRcdGxldCBhbW91bnRCdXR0b25zID0gTWF0aC5jZWlsKGl0ZW1zLmxlbmd0aCAvIHRoaXMuX2Ftb3VudFBhZ2VJdGVtcyksIC8vINC60L7Qu9C40YfQtdGB0YLQstC+INGB0YLRgNCw0L3QuNGGXHJcblx0XHRcdHBCdXR0b25zQ29udGVudCA9ICcnOyAvLyDRgNCw0LfQvNC10YLQutCwINC60L3QvtC/0L7QuiDQv9Cw0LPQuNC90LDRhtC40LhcclxuXHJcblx0XHRpZiAoYW1vdW50QnV0dG9ucyA+IDYpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPCAyIHx8IHRoaXMuX2FjdGl2ZVBhZ2UgPiBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMyk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDMsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPT0gMikge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgNCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDEsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPT0gYW1vdW50QnV0dG9ucyAtIDMpIHtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIDEpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQRG90c0NvbnRlbnQoKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KGFtb3VudEJ1dHRvbnMgLSA0LCBhbW91bnRCdXR0b25zKTtcclxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLl9hY3RpdmVQYWdlID4gMiAmJiB0aGlzLl9hY3RpdmVQYWdlIDwgYW1vdW50QnV0dG9ucyAtIDMpIHtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIDEpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQRG90c0NvbnRlbnQoKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KHRoaXMuX2FjdGl2ZVBhZ2UgLSAxLCB0aGlzLl9hY3RpdmVQYWdlICsgMik7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDEsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHBCdXR0b25zQ29udGVudDtcclxuXHR9XHJcblxyXG5cdF9nZXRJdGVtc0luQWN0aXZlUGFnZShpdGVtcykge1xyXG5cdFx0Y29uc3QgZmlyc3RJdGVtID0gdGhpcy5fYWN0aXZlUGFnZSAqIHRoaXMuX2Ftb3VudFBhZ2VJdGVtcyxcclxuXHRcdFx0bGFzdEl0ZW0gPSBmaXJzdEl0ZW0gKyB0aGlzLl9hbW91bnRQYWdlSXRlbXM7XHJcblx0XHRyZXR1cm4gaXRlbXMuc2xpY2UoZmlyc3RJdGVtLCBsYXN0SXRlbSk7XHJcblx0fVxyXG5cclxuXHRzZXRBY3RpdmVQYWdlKG51bWJlcikge1xyXG5cdFx0dGhpcy5fYWN0aXZlUGFnZSA9IG51bWJlcjtcclxuXHR9XHJcblxyXG5cdGFkZFBhZ2luZ0dldEl0ZW1zSW5QYWdlKGl0ZW1zKSB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIodGhpcy5fY29udGFpbmVyLCB0aGlzLl9nZXRQQnV0dG9uc0NvbnRlbnQoaXRlbXMpKTtcclxuXHRcdHJldHVybiB0aGlzLl9nZXRJdGVtc0luQWN0aXZlUGFnZShpdGVtcyk7XHJcblx0fVxyXG59XHJcblxyXG4vL9C60L7RgNC30LjQvdCwXHJcbmZ1bmN0aW9uIEJhc2tldFNldHRpbmcoKSB7XHJcblx0bGV0IGdvb2RzSW5CYXNrZXQgPSBbXTtcclxuXHJcblx0Y29uc3QgZ2V0R29vZENvbnRlbnQgPSBnb29kID0+IHtcclxuXHRcdGxldCB7IGlkLCBpbWFnZSwgdGl0bGUsIGNvdW50IH0gPSBnb29kO1xyXG5cdFx0cmV0dXJuIGA8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWl0ZW1cIiBkYXRhLWItZ29vZC1pZD1cIiR7aWR9XCI+XHJcblx0XHRcdDxidXR0b24gY2xhc3M9XCJiYXNrZXRfX2dvb2QtcmVtb3ZlIGpzLXJlbW92ZS1nb29kXCI+JiMxMjg5Mzg7PC9idXR0b24+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtaW1hZ2VcIj48aW1nIHNyYz1cIiR7aW1hZ2V9XCIvPjwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLW5hbWVcIj4ke3RpdGxlfTwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWFtb3V0XCI+JHtjb3VudH08L2Rpdj5cclxuXHRcdDwvZGl2PmA7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgYWRkR29vZFRvQ29udGFpbmVyID0gKCkgPT4ge1xyXG5cdFx0bGV0IGdvb2RzQ29udGVudCA9IGdvb2RzSW5CYXNrZXQubWFwKGdvb2QgPT4gZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtYmFza2V0LWdvb2QnLCBnb29kc0NvbnRlbnQpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGZpbmRHb29kQW5kUmVtb3ZlID0gaWQgPT4ge1xyXG5cdFx0bGV0IGdvb2RJbmRleCA9IGdvb2RzSW5CYXNrZXQuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gK2lkKTtcclxuXHRcdGdvb2RzSW5CYXNrZXQuc3BsaWNlKGdvb2RJbmRleCwgMSk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZmluZEdvb2RBbmRBZGQgPSBnb29kID0+IHtcclxuXHRcdGxldCBnb29kSW5CYXNrZXQgPSBnb29kc0luQmFza2V0LmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSBnb29kLmlkKTtcclxuXHRcdGlmIChnb29kSW5CYXNrZXQpIHtcclxuXHRcdFx0Z29vZEluQmFza2V0LmNvdW50Kys7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRnb29kLmNvdW50ID0gMTtcclxuXHRcdFx0Z29vZHNJbkJhc2tldCA9IFsuLi5nb29kc0luQmFza2V0LCBnb29kXTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRjb25zdCBjb3VudFRvdGFsQ29zdCA9ICgpID0+IHtcclxuXHRcdGxldCB0b3RhbENvc3QgPSBnb29kc0luQmFza2V0LnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBpdGVtLmNvdW50ICogaXRlbS5wcmljZSwgMCk7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1jb3VudC1yZXN1bHQnLCB0b3RhbENvc3QpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNhdmVUb0xvY2FsU3RvcmFnZSA9ICgpID0+IHtcclxuXHRcdGxvY2FsU3RvcmFnZS5nb29kc0luQmFza2V0ID0gSlNPTi5zdHJpbmdpZnkoZ29vZHNJbkJhc2tldCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgY291bnRHb29kc0luQmFza2V0ID0gKCkgPT4ge1xyXG5cdFx0cmV0dXJuIGdvb2RzSW5CYXNrZXQucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0uY291bnQsIDApO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHJlbG9hZEJhc2tldCA9ICgpID0+IHtcclxuXHRcdHNhdmVUb0xvY2FsU3RvcmFnZSgpO1xyXG5cdFx0YWRkR29vZFRvQ29udGFpbmVyKCk7XHJcblx0XHRjb3VudFRvdGFsQ29zdCgpO1xyXG5cdH07XHJcblxyXG5cdHRoaXMuZ2V0TG9jYWxTb3JhZ2UgPSBmdW5jdGlvbigpIHtcclxuXHRcdGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ29vZHNJbkJhc2tldCcpICE9IG51bGwpXHJcblx0XHRcdGdvb2RzSW5CYXNrZXQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29kc0luQmFza2V0JykpO1xyXG5cdFx0YWRkR29vZFRvQ29udGFpbmVyKCk7XHJcblx0XHRjb3VudFRvdGFsQ29zdCgpO1xyXG5cdH07XHJcblxyXG5cdHRoaXMuZ2V0Q291bnRHb29kc0luQmFza2V0ID0gKCkgPT4ge1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtZ29vZC1pbi1iYXNrZXQnLCBjb3VudEdvb2RzSW5CYXNrZXQoKSk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5hZGRHb29kVG9CYXNrZXQgPSBnb29kID0+IHtcclxuXHRcdGZpbmRHb29kQW5kQWRkKGdvb2QpO1xyXG5cdFx0cmVsb2FkQmFza2V0KCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5yZW1vdmVHb29kRnJvbUJhc2tldCA9IGlkID0+IHtcclxuXHRcdGZpbmRHb29kQW5kUmVtb3ZlKGlkKTtcclxuXHRcdHJlbG9hZEJhc2tldCgpO1xyXG5cdH07XHJcbn1cclxuXHJcbi8v0JTQvtCx0LDQstC70LXQvdC40LUg0Y3Qu9C10LzQtdC90YLQvtCyINCyINC60L7QvdGC0LXQudC90LXRgFxyXG5mdW5jdGlvbiBhZGRDb250ZW50VG9Db250YWluZXIoY29udGFpbmVyQ2xhc3MsIGVsZW1lbnQpIHtcclxuXHRjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckNsYXNzKTtcclxuXHRpZiAoY29udGFpbmVyKSBjb250YWluZXIuaW5uZXJIVE1MID0gZWxlbWVudDtcclxufVxyXG5cclxuLy/Rg9C00LDQu9C40YLRjCDQutC70LDRgdGBINGDINCz0YDRg9C/0L/RiyDQutC+0L3RgtC10LnQvdC10YDQvtCyXHJcbmZ1bmN0aW9uIGZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MoY29udGFpbmVyQ2xhc3MsIGNsYXNzTmFtZSkge1xyXG5cdGNvbnN0IHJlbW92ZUNsYXNzSW5Db250YWluZXIgPSAoYWxsQ29udGFpbmVycywgY2xhc3NOYW1lLCBpID0gMCkgPT4ge1xyXG5cdFx0aWYgKGkgPCBhbGxDb250YWluZXJzLmxlbmd0aCkge1xyXG5cdFx0XHRhbGxDb250YWluZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcclxuXHRcdFx0cmV0dXJuIHJlbW92ZUNsYXNzSW5Db250YWluZXIoYWxsQ29udGFpbmVycywgY2xhc3NOYW1lLCBpICsgMSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHRsZXQgYWxsQ29udGFpbmVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29udGFpbmVyQ2xhc3MpO1xyXG5cdHJlbW92ZUNsYXNzSW5Db250YWluZXIoYWxsQ29udGFpbmVycywgY2xhc3NOYW1lKTtcclxufVxyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG5cdGNvbnN0IGhhbmRsZXIgPSAoZWxlbWVudCwgZXZlbnROYW1lLCBmbikgPT4ge1xyXG5cdFx0Y29uc3QgZWxlbWVudENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudCk7XHJcblx0XHRlbGVtZW50Q29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBldmVudCA9PiBmbihldmVudCkpO1xyXG5cdH07XHJcblxyXG5cdC8v0YHQu9GD0YjQsNC70LrQsCDQutC90L7Qv9C+0Log0L/QsNCz0LjQvdCw0YLQvtGA0LBcclxuXHRoYW5kbGVyKCcuanMtcGFnaW5hdGlvbicsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXQ7XHJcblx0XHRpZiAodGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLXBhZ2luYXRpb24tYnV0dG9uJykgJiYgIXRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xyXG5cdFx0XHRnb29kc1BhZ2luZy5zZXRBY3RpdmVQYWdlKHRhcmdldEVsZW1lbnQuZGF0YXNldC5wQnV0dG9uTnVtYmVyIC0gMSk7XHJcblx0XHRcdGdvb2RzLmxvYWRHb29kcygpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyDRgdC70YPRiNCw0LvQutCwINGB0L7RgNGC0LjRgNC+0LLQvtC6XHJcblx0aGFuZGxlcignLmpzLXNvcnRpbmctYnV0dG9ucycsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXQ7XHJcblx0XHRpZiAodGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLXNvcnRpbmcnKSAmJiAhdGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XHJcblx0XHRcdGNvbnN0IHNvcnRpbmdTZXR0aW5nID0gdGFyZ2V0RWxlbWVudC5kYXRhc2V0LnNvcnRpbmc7XHJcblx0XHRcdGZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MoJy5qcy1zb3J0aW5nJywgJ2FjdGl2ZScpO1xyXG5cdFx0XHRnb29kcy5zZXRTb3J0aW5nKHNvcnRpbmdTZXR0aW5nKTtcclxuXHRcdFx0dGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0YHQu9GD0YjQsNC70LrQsCDRgdC+0YDRgtC40YDQvtCy0LrQuCDQv9C+INC90LDQu9C40YfQuNGOXHJcblx0aGFuZGxlcignLmpzLWF2YWxpYWJsZScsICdjaGFuZ2UnLCBldmVudCA9PiB7XHJcblx0XHRnb29kcy5zZXRBdmFsaWFibGUoZXZlbnQudGFyZ2V0LmNoZWNrZWQpO1xyXG5cdH0pO1xyXG5cclxuXHQvLyDQutC90L7Qv9C60LAg0LTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3Rg1xyXG5cdGhhbmRsZXIoJy5qcy1nb29kJywgJ2NsaWNrJywgZXZlbnQgPT4ge1xyXG5cdFx0aWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWFkZC10by1iYXNrZXQnKSkge1xyXG5cdFx0XHRsZXQgZ29vZElkID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5qcy1nb29kLWl0ZW0nKS5kYXRhc2V0Lmdvb2RJZDtcclxuXHRcdFx0YmFza2V0LmFkZEdvb2RUb0Jhc2tldChnb29kcy5nZXRHb29kSW5mb3JtYXRpb24oZ29vZElkKSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vINC60L3QvtC/0LrQsCDRg9C00LDQu9C40YLRjCDQuNC3INC60L7RgNC30LjQvdGLXHJcblx0aGFuZGxlcignLmpzLWJhc2tldC1nb29kJywgJ2NsaWNrJywgZXZlbnQgPT4ge1xyXG5cdFx0aWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLXJlbW92ZS1nb29kJykpIHtcclxuXHRcdFx0YmFza2V0LnJlbW92ZUdvb2RGcm9tQmFza2V0KGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LmRhdGFzZXQuYkdvb2RJZCk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pO1xyXG5cclxuY29uc3QgYmFza2V0ID0gbmV3IEJhc2tldFNldHRpbmcoKSxcclxuXHRnb29kcyA9IG5ldyBHb29kU2V0dGluZygpLFxyXG5cdGdvb2RzUGFnaW5nID0gbmV3IFBhZ2luZyg1LCAnLmpzLXBhZ2luYXRpb24nKTtcclxuXHJcbmdvb2RzLmxvYWRHb29kcygpO1xyXG5iYXNrZXQuZ2V0TG9jYWxTb3JhZ2UoKTtcclxuIl19
