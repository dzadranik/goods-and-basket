"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}var basket=new BasketSetting,goods=new GoodSetting,goodsPaging=new Paging;function addContentToContainer(t,n){var o=document.querySelector(t);o&&(o.innerHTML=n)}function findContainersAndRemoveClass(t,n){!function t(n,o){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(a<n.length)return n[a].classList.remove(o),t(n,o,a+1)}(document.querySelectorAll(t),n)}function GoodSetting(){var t=[],n=!1,o="name";this.loadGoods=function(){fetch("https://dzadranik.github.io/goods-and-basket/src/json/goods.json").then((function(t){return t.json()})).then((function(a){!function(n){t=n,addContentToContainer(".js-good",n.map((function(t){return function(t){var n=t.id,o=t.image,a=t.title,e=t.price,i=t.descr;return'<div class="good__item js-good-item" data-good-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(o,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(a,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(e,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(function(t,n){if(t.length>n){var o=t.lastIndexOf(" ",n);return"".concat(t.slice(0,o)," ...")}return t}(i,65),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button js-add-to-basket">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}(t)})).join(""))}(goodsPaging.addPagingGetItemsInPage(function(t){return n&&(t=function(t){return t.filter((function(t){return t.avaliable}))}(t)),"cost"==o?t=function(t){return t.sort((function(t,n){return t.price-n.price}))}(t):"name"==o&&(t=function(t){return t.sort((function(t,n){var o=t.title.toLowerCase(),a=n.title.toLowerCase();return o<a?-1:o<a?1:void 0}))}(t)),t}(a)))}))},this.setAvaliable=function(t){n=t,goodsPaging.setActivePage(0),this.loadGoods()},this.setSorting=function(t){o!=t&&(o=t,this.loadGoods())},this.getGoodInformation=function(n){return t.find((function(t){return t.id==n}))}}function Paging(){var t=0,n=function(n){return'<button \n\t\t\tclass="pagination__button js-pagination-button '.concat(n===t?"active":"",'" \n\t\t\tdata-p-button-number="').concat(n+1,'">\n\t\t\t\t').concat(n+1,"\n\t\t\t</button>")},o=function t(o,a){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o<a?t(o+1,a,e+=n(o)):e};this.setActivePage=function(n){t=n,goods.loadGoods()},this.addPagingGetItemsInPage=function(n){return addContentToContainer(".js-pagination",function(n){var a=Math.ceil(n.length/5),e="";return a>6?t<2||t>a-3?(e+=o(0,3),e+="<span class='pagination__dots'>...</span>",e+=o(a-3,a)):2==t?(e+=o(0,4),e+="<span class='pagination__dots'>...</span>",e+=o(a-1,a)):t==a-3?(e+=o(0,1),e+="<span class='pagination__dots'>...</span>",e+=o(a-4,a)):t>2&&t<a-3&&(e+=o(0,1),e+="<span class='pagination__dots'>...</span>",e+=o(t-1,t+2),e+="<span class='pagination__dots'>...</span>",e+=o(a-1,a)):e+=o(0,a),e}(n)),function(n){var o=5*t,a=o+5;return n.slice(o,a)}(n)}}function BasketSetting(){var t=[],n=function(){addContentToContainer(".js-basket-good",t.map((function(t){return function(t){var n=t.id,o=t.image,a=t.title,e=t.count;return'<div class="basket__good-item" data-b-good-id="'.concat(n,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(o,'"/></div>\n\t\t\t<div class="basket__good-name">').concat(a,'</div>\n\t\t\t<div class="basket__good-amout">').concat(e,"</div>\n\t\t</div>")}(t)})).join(""))},o=function(){addContentToContainer(".js-count-result",t.reduce((function(t,n){return t+n.count*n.price}),0))},a=function(){localStorage.goodsInBasket=JSON.stringify(t),n(),o()};this.getLocalSorage=function(){null!=localStorage.getItem("goodsInBasket")&&(t=JSON.parse(localStorage.getItem("goodsInBasket"))),n(),o()},this.getCountGoodsInBasket=function(){addContentToContainer(".js-good-in-basket",t.reduce((function(t,n){return t+n.count}),0))},this.addGoodToBasket=function(n){!function(n){var o=t.find((function(t){return t.id===n.id}));o?o.count++:(n.count=1,t=[].concat(_toConsumableArray(t),[n]))}(n),a()},this.removeGoodFromBasket=function(n){!function(n){var o=t.findIndex((function(t){return t.id===+n}));t.splice(o,1)}(n),a()}}goods.loadGoods(),basket.getLocalSorage(),document.addEventListener("DOMContentLoaded",(function(){var t=function(t,n,o){document.querySelector(t).addEventListener(n,(function(t){return o(t)}))};t(".js-pagination","click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&goodsPaging.setActivePage(n.dataset.pButtonNumber-1)})),t(".js-sorting-buttons","click",(function(t){var n=t.target;if(n.classList.contains("js-sorting")&&!n.classList.contains("active")){var o=n.dataset.sorting;findContainersAndRemoveClass(".js-sorting","active"),goods.setSorting(o),n.classList.add("active")}})),t(".js-avaliable","change",(function(t){goods.setAvaliable(t.target.checked)})),t(".js-good","click",(function(t){if(t.target.classList.contains("js-add-to-basket")){var n=t.target.closest(".js-good-item").dataset.goodId;basket.addGoodToBasket(goods.getGoodInformation(n))}})),t(".js-basket-good","click",(function(t){t.target.classList.contains("js-remove-good")&&basket.removeGoodFromBasket(t.target.parentElement.dataset.bGoodId)}))}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwiYmFza2V0IiwiQmFza2V0U2V0dGluZyIsImdvb2RzIiwiR29vZFNldHRpbmciLCJnb29kc1BhZ2luZyIsIlBhZ2luZyIsImFkZENvbnRlbnRUb0NvbnRhaW5lciIsImNvbnRhaW5lckNsYXNzIiwiZWxlbWVudCIsImNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MiLCJjbGFzc05hbWUiLCJyZW1vdmVDbGFzc0luQ29udGFpbmVyIiwiYWxsQ29udGFpbmVycyIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJnb29kc0luUGFnZSIsImF2YWxpYWJsZSIsInNvcnRpbmdWYWx1ZSIsInRoaXMiLCJsb2FkR29vZHMiLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJtYXAiLCJnb29kIiwiaWQiLCJpbWFnZSIsInRpdGxlIiwicHJpY2UiLCJkZXNjciIsImNvbmNhdCIsIm1heExlbmd0aCIsImdhcCIsImxhc3RJbmRleE9mIiwic2xpY2UiLCJ0cnVuY2F0ZSIsImdldEdvb2RDb250ZW50Iiwiam9pbiIsImFkZEdvb2RzVG9Db250YWluZXIiLCJhZGRQYWdpbmdHZXRJdGVtc0luUGFnZSIsImZpbHRlciIsImVsZW0iLCJzb3J0aW5nQXZhbGlhYmxlIiwic29ydCIsInByZXYiLCJuZXh0Iiwic29ydGluZ0J5Q29zdCIsIngiLCJ0b0xvd2VyQ2FzZSIsInkiLCJzb3J0aW5nQnlOYW1lIiwic29ydGluZyIsInNldEF2YWxpYWJsZSIsInZhbHVlIiwic2V0QWN0aXZlUGFnZSIsInNldFNvcnRpbmciLCJnZXRHb29kSW5mb3JtYXRpb24iLCJmaW5kIiwiaXRlbSIsIm51bWJlckFjdGl2ZVBhZ2UiLCJnZXRQQnV0dG9uQ29udGVudCIsIm51bWJlciIsImdldFBCdXR0b25zTnVtYmVyQ29udGVudCIsImZpcnN0IiwibGFzdCIsInBCdXR0b25zQ29udGVudCIsIml0ZW1zIiwiYW1vdW50QnV0dG9ucyIsIk1hdGgiLCJjZWlsIiwiZ2V0UEJ1dHRvbnNDb250ZW50IiwiZmlyc3RJdGVtIiwibGFzdEl0ZW0iLCJnZXRJdGVtc0luQWN0aXZlUGFnZSIsImdvb2RzSW5CYXNrZXQiLCJhZGRHb29kVG9Db250YWluZXIiLCJjb3VudCIsImNvdW50VG90YWxDb3N0IiwicmVkdWNlIiwic3VtIiwicmVsb2FkQmFza2V0IiwibG9jYWxTdG9yYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldExvY2FsU29yYWdlIiwiZ2V0SXRlbSIsInBhcnNlIiwiZ2V0Q291bnRHb29kc0luQmFza2V0IiwiYWRkR29vZFRvQmFza2V0IiwiZ29vZEluQmFza2V0IiwiZmluZEdvb2RBbmRBZGQiLCJyZW1vdmVHb29kRnJvbUJhc2tldCIsImdvb2RJbmRleCIsImZpbmRJbmRleCIsInNwbGljZSIsImZpbmRHb29kQW5kUmVtb3ZlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZXIiLCJldmVudE5hbWUiLCJmbiIsImV2ZW50IiwidGFyZ2V0RWxlbWVudCIsInRhcmdldCIsImNvbnRhaW5zIiwiZGF0YXNldCIsInBCdXR0b25OdW1iZXIiLCJzb3J0aW5nU2V0dGluZyIsImFkZCIsImNoZWNrZWQiLCJnb29kSWQiLCJjbG9zZXN0IiwicGFyZW50RWxlbWVudCIsImJHb29kSWQiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsU0FBU0EsbUJBQW1CQyxHQUFPLE9BQU9DLG1CQUFtQkQsSUFBUUUsaUJBQWlCRixJQUFRRyxxQkFFOUYsU0FBU0EscUJBQXVCLE1BQU0sSUFBSUMsVUFBVSxtREFFcEQsU0FBU0YsaUJBQWlCRyxHQUFRLEdBQUlDLE9BQU9DLFlBQVlDLE9BQU9ILElBQWtELHVCQUF6Q0csT0FBT0MsVUFBVUMsU0FBU0MsS0FBS04sR0FBZ0MsT0FBT08sTUFBTUMsS0FBS1IsR0FFMUosU0FBU0osbUJBQW1CRCxHQUFPLEdBQUlZLE1BQU1FLFFBQVFkLEdBQU0sQ0FBRSxJQUFLLElBQUllLEVBQUksRUFBR0MsRUFBTyxJQUFJSixNQUFNWixFQUFJaUIsUUFBU0YsRUFBSWYsRUFBSWlCLE9BQVFGLElBQU9DLEVBQUtELEdBQUtmLEVBQUllLEdBQU0sT0FBT0MsR0FSN0osSUFBTUUsT0FBUyxJQUFJQyxjQUNsQkMsTUFBUSxJQUFJQyxZQUNaQyxZQUFjLElBQUlDLE9Bb0RuQixTQUFTQyxzQkFBc0JDLEVBQWdCQyxHQUM5QyxJQUFNQyxFQUFZQyxTQUFTQyxjQUFjSixHQUNyQ0UsSUFBV0EsRUFBVUcsVUFBWUosR0FJdEMsU0FBU0ssNkJBQTZCTixFQUFnQk8sSUFDdEIsU0FBekJDLEVBQTBCQyxFQUFlRixHQUFxQixJQUFWakIsRUFBVW9CLFVBQUFsQixPQUFBLFFBQUFtQixJQUFBRCxVQUFBLEdBQUFBLFVBQUEsR0FBTixFQUM3RCxHQUFJcEIsRUFBSW1CLEVBQWNqQixPQUVyQixPQURBaUIsRUFBY25CLEdBQUdzQixVQUFVQyxPQUFPTixHQUMzQkMsRUFBdUJDLEVBQWVGLEVBQVdqQixFQUFJLEdBSTlEa0IsQ0FEb0JMLFNBQVNXLGlCQUFpQmQsR0FDUk8sR0FJdkMsU0FBU1gsY0FDUixJQUFJbUIsRUFBYyxHQUNqQkMsR0FBWSxFQUNaQyxFQUFlLE9BeURoQkMsS0FBS0MsVUFBWSxXQUNoQkMsTUFBTSxvRUFDSkMsTUFBSyxTQUFBQyxHQUFRLE9BQUlBLEVBQVNDLFVBQzFCRixNQUFLLFNBQUExQixJQVRvQixTQUFBQSxHQUMzQm9CLEVBQWNwQixFQUVkSSxzQkFBc0IsV0FEREosRUFBTTZCLEtBQUksU0FBQUMsR0FBSSxPQWxCYixTQUFBQSxHQUFRLElBQ3hCQyxFQUFtQ0QsRUFBbkNDLEdBQUlDLEVBQStCRixFQUEvQkUsTUFBT0MsRUFBd0JILEVBQXhCRyxNQUFPQyxFQUFpQkosRUFBakJJLE1BQU9DLEVBQVVMLEVBQVZLLE1BQy9CLE1BQUEscURBQUFDLE9BQTRETCxFQUE1RCxvREFBQUssT0FDd0NKLEVBRHhDLCtGQUFBSSxPQUcrQkgsRUFIL0IsaURBQUFHLE9BSStCRixFQUovQiwyREFBQUUsT0FWZ0IsU0FBU0QsRUFBT0UsR0FDaEMsR0FBSUYsRUFBTXRDLE9BQVN3QyxFQUFXLENBQzdCLElBQUlDLEVBQU1ILEVBQU1JLFlBQVksSUFBS0YsR0FDakMsTUFBQSxHQUFBRCxPQUFVRCxFQUFNSyxNQUFNLEVBQUdGLEdBQXpCLFFBRUQsT0FBT0gsRUFVOEJNLENBQVNOLEVBQU8sSUFMckQseVFBZ0J1Q08sQ0FBZVosTUFBT2EsS0FBSyxLQVFoRUMsQ0FBb0IxQyxZQUFZMkMsd0JBMUNuQixTQUFBN0MsR0FLZixPQUpJcUIsSUFBV3JCLEVBbEJTLFNBQUFBLEdBQ3hCLE9BQU9BLEVBQU04QyxRQUFPLFNBQUFDLEdBQUksT0FBSUEsRUFBSzFCLGFBaUJWMkIsQ0FBaUJoRCxJQUVwQixRQUFoQnNCLEVBQXdCdEIsRUFoQlAsU0FBQUEsR0FDckIsT0FBT0EsRUFBTWlELE1BQUssU0FBQ0MsRUFBTUMsR0FBUCxPQUFnQkQsRUFBS2hCLE1BQVFpQixFQUFLakIsU0FlaEJrQixDQUFjcEQsR0FDekIsUUFBaEJzQixJQUF3QnRCLEVBYlosU0FBQUEsR0FDckIsT0FBT0EsRUFBTWlELE1BQUssU0FBQ0MsRUFBTUMsR0FDeEIsSUFBTUUsRUFBSUgsRUFBS2pCLE1BQU1xQixjQUNmQyxFQUFJSixFQUFLbEIsTUFBTXFCLGNBQ3JCLE9BQUlELEVBQUlFLEdBQVcsRUFDZkYsRUFBSUUsRUFBVSxPQUFsQixLQVF3Q0MsQ0FBY3hELElBQ2hEQSxFQXFDbUR5RCxDQUFRekQsU0FJbkV1QixLQUFLbUMsYUFBZSxTQUFTQyxHQUM1QnRDLEVBQVlzQyxFQUNaekQsWUFBWTBELGNBQWMsR0FDMUJyQyxLQUFLQyxhQUdORCxLQUFLc0MsV0FBYSxTQUFTRixHQUN0QnJDLEdBQWdCcUMsSUFDbkJyQyxFQUFlcUMsRUFDZnBDLEtBQUtDLGNBSVBELEtBQUt1QyxtQkFBcUIsU0FBUy9CLEdBQ2xDLE9BQU9YLEVBQVkyQyxNQUFLLFNBQUFDLEdBQUksT0FBSUEsRUFBS2pDLElBQU1BLE1BSzdDLFNBQVM1QixTQUNSLElBQ0k4RCxFQUFtQixFQUVqQkMsRUFBb0IsU0FBQUMsR0FDekIsTUFBQSxrRUFBQS9CLE9BQ2tEK0IsSUFBV0YsRUFBbUIsU0FBVyxHQUQzRixvQ0FBQTdCLE9BRXlCK0IsRUFBUyxFQUZsQyxnQkFBQS9CLE9BR0krQixFQUFTLEVBSGIsc0JBV0tDLEVBQTJCLFNBQTNCQSxFQUE0QkMsRUFBT0MsR0FBK0IsSUFBekJDLEVBQXlCeEQsVUFBQWxCLE9BQUEsUUFBQW1CLElBQUFELFVBQUEsR0FBQUEsVUFBQSxHQUFQLEdBQ2hFLE9BQUlzRCxFQUFRQyxFQUVKRixFQUF5QkMsRUFBUSxFQUFHQyxFQUQzQ0MsR0FBbUJMLEVBQWtCRyxJQUcvQkUsR0F1Q1JoRCxLQUFLcUMsY0FBZ0IsU0FBU08sR0FDN0JGLEVBQW1CRSxFQUNuQm5FLE1BQU13QixhQUdQRCxLQUFLc0Isd0JBQTBCLFNBQVMyQixHQUV2QyxPQURBcEUsc0JBQXNCLGlCQTFDSSxTQUFBb0UsR0FDMUIsSUFBSUMsRUFBZ0JDLEtBQUtDLEtBQUtILEVBQU0zRSxPQXhCYixHQXlCdEIwRSxFQUFrQixHQXlCbkIsT0F2QklFLEVBQWdCLEVBQ2ZSLEVBQW1CLEdBQUtBLEVBQW1CUSxFQUFnQixHQUM5REYsR0FBbUJILEVBQXlCLEVBQUcsR0FDL0NHLEdBbEJGLDRDQW1CRUEsR0FBbUJILEVBQXlCSyxFQUFnQixFQUFHQSxJQUNqQyxHQUFwQlIsR0FDVk0sR0FBbUJILEVBQXlCLEVBQUcsR0FDL0NHLEdBdEJGLDRDQXVCRUEsR0FBbUJILEVBQXlCSyxFQUFnQixFQUFHQSxJQUNyRFIsR0FBb0JRLEVBQWdCLEdBQzlDRixHQUFtQkgsRUFBeUIsRUFBRyxHQUMvQ0csR0ExQkYsNENBMkJFQSxHQUFtQkgsRUFBeUJLLEVBQWdCLEVBQUdBLElBQ3JEUixFQUFtQixHQUFLQSxFQUFtQlEsRUFBZ0IsSUFDckVGLEdBQW1CSCxFQUF5QixFQUFHLEdBQy9DRyxHQTlCRiw0Q0ErQkVBLEdBQW1CSCxFQUF5QkgsRUFBbUIsRUFBR0EsRUFBbUIsR0FDckZNLEdBaENGLDRDQWlDRUEsR0FBbUJILEVBQXlCSyxFQUFnQixFQUFHQSxJQUdoRUYsR0FBbUJILEVBQXlCLEVBQUdLLEdBRXpDRixFQWVpQ0ssQ0FBbUJKLElBWi9CLFNBQUFBLEdBQzVCLElBQU1LLEVBdERpQixFQXNETFosRUFDakJhLEVBQVdELEVBdkRXLEVBd0R2QixPQUFPTCxFQUFNaEMsTUFBTXFDLEVBQVdDLEdBVXZCQyxDQUFxQlAsSUFLOUIsU0FBU3pFLGdCQUNSLElBQUlpRixFQUFnQixHQVlkQyxFQUFxQixXQUUxQjdFLHNCQUFzQixrQkFESDRFLEVBQWNuRCxLQUFJLFNBQUFDLEdBQUksT0FYbkIsU0FBQUEsR0FBUSxJQUN4QkMsRUFBNEJELEVBQTVCQyxHQUFJQyxFQUF3QkYsRUFBeEJFLE1BQU9DLEVBQWlCSCxFQUFqQkcsTUFBT2lELEVBQVVwRCxFQUFWb0QsTUFDeEIsTUFBQSxrREFBQTlDLE9BQXlETCxFQUF6RCxxSUFBQUssT0FFNkNKLEVBRjdDLG9EQUFBSSxPQUdrQ0gsRUFIbEMsa0RBQUFHLE9BSW1DOEMsRUFKbkMsc0JBUzZDeEMsQ0FBZVosTUFBT2EsS0FBSyxNQW1CbkV3QyxFQUFpQixXQUV0Qi9FLHNCQUFzQixtQkFETjRFLEVBQWNJLFFBQU8sU0FBQ0MsRUFBS3JCLEdBQU4sT0FBZXFCLEVBQU1yQixFQUFLa0IsTUFBUWxCLEVBQUs5QixRQUFPLEtBWTlFb0QsRUFBZSxXQVBwQkMsYUFBYVAsY0FBZ0JRLEtBQUtDLFVBQVVULEdBUzVDQyxJQUNBRSxLQUdENUQsS0FBS21FLGVBQWlCLFdBQ3dCLE1BQXpDSCxhQUFhSSxRQUFRLG1CQUN4QlgsRUFBZ0JRLEtBQUtJLE1BQU1MLGFBQWFJLFFBQVEsbUJBQ2pEVixJQUNBRSxLQUdENUQsS0FBS3NFLHNCQUF3QixXQUM1QnpGLHNCQUFzQixxQkFqQmY0RSxFQUFjSSxRQUFPLFNBQUNDLEVBQUtyQixHQUFOLE9BQWVxQixFQUFNckIsRUFBS2tCLFFBQU8sS0FvQjlEM0QsS0FBS3VFLGdCQUFrQixTQUFBaEUsSUF4Q0EsU0FBQUEsR0FDdEIsSUFBSWlFLEVBQWVmLEVBQWNqQixNQUFLLFNBQUFDLEdBQUksT0FBSUEsRUFBS2pDLEtBQU9ELEVBQUtDLE1BQzNEZ0UsRUFDSEEsRUFBYWIsU0FFYnBELEVBQUtvRCxNQUFRLEVBQ2JGLEVBQWEsR0FBQTVDLE9BQUF6RCxtQkFBT3FHLEdBQVAsQ0FBc0JsRCxLQW1DcENrRSxDQUFlbEUsR0FDZndELEtBR0QvRCxLQUFLMEUscUJBQXVCLFNBQUFsRSxJQWxERixTQUFBQSxHQUN6QixJQUFJbUUsRUFBWWxCLEVBQWNtQixXQUFVLFNBQUFuQyxHQUFJLE9BQUlBLEVBQUtqQyxNQUFRQSxLQUM3RGlELEVBQWNvQixPQUFPRixFQUFXLEdBaURoQ0csQ0FBa0J0RSxHQUNsQnVELEtBelNGdEYsTUFBTXdCLFlBQ04xQixPQUFPNEYsaUJBRVBsRixTQUFTOEYsaUJBQWlCLG9CQUFvQixXQUM3QyxJQUFNQyxFQUFVLFNBQUNqRyxFQUFTa0csRUFBV0MsR0FDWGpHLFNBQVNDLGNBQWNILEdBQy9CZ0csaUJBQWlCRSxHQUFXLFNBQUFFLEdBQUssT0FBSUQsRUFBR0MsT0FJMURILEVBQVEsaUJBQWtCLFNBQVMsU0FBQUcsR0FDbEMsSUFBTUMsRUFBZ0JELEVBQU1FLE9BQ3hCRCxFQUFjMUYsVUFBVTRGLFNBQVMsMEJBQTRCRixFQUFjMUYsVUFBVTRGLFNBQVMsV0FDakczRyxZQUFZMEQsY0FBYytDLEVBQWNHLFFBQVFDLGNBQWdCLE1BS2xFUixFQUFRLHNCQUF1QixTQUFTLFNBQUFHLEdBQ3ZDLElBQU1DLEVBQWdCRCxFQUFNRSxPQUM1QixHQUFJRCxFQUFjMUYsVUFBVTRGLFNBQVMsZ0JBQWtCRixFQUFjMUYsVUFBVTRGLFNBQVMsVUFBVyxDQUNsRyxJQUFNRyxFQUFpQkwsRUFBY0csUUFBUXJELFFBQzdDOUMsNkJBQTZCLGNBQWUsVUFDNUNYLE1BQU02RCxXQUFXbUQsR0FDakJMLEVBQWMxRixVQUFVZ0csSUFBSSxjQUs5QlYsRUFBUSxnQkFBaUIsVUFBVSxTQUFBRyxHQUNsQzFHLE1BQU0wRCxhQUFhZ0QsRUFBTUUsT0FBT00sWUFJakNYLEVBQVEsV0FBWSxTQUFTLFNBQUFHLEdBQzVCLEdBQUlBLEVBQU1FLE9BQU8zRixVQUFVNEYsU0FBUyxvQkFBcUIsQ0FDeEQsSUFBSU0sRUFBU1QsRUFBTUUsT0FBT1EsUUFBUSxpQkFBaUJOLFFBQVFLLE9BQzNEckgsT0FBT2dHLGdCQUFnQjlGLE1BQU04RCxtQkFBbUJxRCxRQUtsRFosRUFBUSxrQkFBbUIsU0FBUyxTQUFBRyxHQUMvQkEsRUFBTUUsT0FBTzNGLFVBQVU0RixTQUFTLG1CQUNuQy9HLE9BQU9tRyxxQkFBcUJTLEVBQU1FLE9BQU9TLGNBQWNQLFFBQVFRIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJhc2tldCA9IG5ldyBCYXNrZXRTZXR0aW5nKCksXHJcblx0Z29vZHMgPSBuZXcgR29vZFNldHRpbmcoKSxcclxuXHRnb29kc1BhZ2luZyA9IG5ldyBQYWdpbmcoKTtcclxuXHJcbmdvb2RzLmxvYWRHb29kcygpO1xyXG5iYXNrZXQuZ2V0TG9jYWxTb3JhZ2UoKTtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHtcclxuXHRjb25zdCBoYW5kbGVyID0gKGVsZW1lbnQsIGV2ZW50TmFtZSwgZm4pID0+IHtcclxuXHRcdGNvbnN0IGVsZW1lbnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpO1xyXG5cdFx0ZWxlbWVudENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZXZlbnQgPT4gZm4oZXZlbnQpKTtcclxuXHR9O1xyXG5cclxuXHQvL9GB0LvRg9GI0LDQu9C60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGC0L7RgNCwXHJcblx0aGFuZGxlcignLmpzLXBhZ2luYXRpb24nLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1wYWdpbmF0aW9uLWJ1dHRvbicpICYmICF0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuXHRcdFx0Z29vZHNQYWdpbmcuc2V0QWN0aXZlUGFnZSh0YXJnZXRFbGVtZW50LmRhdGFzZXQucEJ1dHRvbk51bWJlciAtIDEpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyDRgdC70YPRiNCw0LvQutCwINGB0L7RgNGC0LjRgNC+0LLQvtC6XHJcblx0aGFuZGxlcignLmpzLXNvcnRpbmctYnV0dG9ucycsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXQ7XHJcblx0XHRpZiAodGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLXNvcnRpbmcnKSAmJiAhdGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XHJcblx0XHRcdGNvbnN0IHNvcnRpbmdTZXR0aW5nID0gdGFyZ2V0RWxlbWVudC5kYXRhc2V0LnNvcnRpbmc7XHJcblx0XHRcdGZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MoJy5qcy1zb3J0aW5nJywgJ2FjdGl2ZScpO1xyXG5cdFx0XHRnb29kcy5zZXRTb3J0aW5nKHNvcnRpbmdTZXR0aW5nKTtcclxuXHRcdFx0dGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0YHQu9GD0YjQsNC70LrQsCDRgdC+0YDRgtC40YDQvtCy0LrQuCDQv9C+INC90LDQu9C40YfQuNGOXHJcblx0aGFuZGxlcignLmpzLWF2YWxpYWJsZScsICdjaGFuZ2UnLCBldmVudCA9PiB7XHJcblx0XHRnb29kcy5zZXRBdmFsaWFibGUoZXZlbnQudGFyZ2V0LmNoZWNrZWQpO1xyXG5cdH0pO1xyXG5cclxuXHQvLyDQutC90L7Qv9C60LAg0LTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3Rg1xyXG5cdGhhbmRsZXIoJy5qcy1nb29kJywgJ2NsaWNrJywgZXZlbnQgPT4ge1xyXG5cdFx0aWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWFkZC10by1iYXNrZXQnKSkge1xyXG5cdFx0XHRsZXQgZ29vZElkID0gZXZlbnQudGFyZ2V0LmNsb3Nlc3QoJy5qcy1nb29kLWl0ZW0nKS5kYXRhc2V0Lmdvb2RJZDtcclxuXHRcdFx0YmFza2V0LmFkZEdvb2RUb0Jhc2tldChnb29kcy5nZXRHb29kSW5mb3JtYXRpb24oZ29vZElkKSk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vINC60L3QvtC/0LrQsCDRg9C00LDQu9C40YLRjCDQuNC3INC60L7RgNC30LjQvdGLXHJcblx0aGFuZGxlcignLmpzLWJhc2tldC1nb29kJywgJ2NsaWNrJywgZXZlbnQgPT4ge1xyXG5cdFx0aWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLXJlbW92ZS1nb29kJykpIHtcclxuXHRcdFx0YmFza2V0LnJlbW92ZUdvb2RGcm9tQmFza2V0KGV2ZW50LnRhcmdldC5wYXJlbnRFbGVtZW50LmRhdGFzZXQuYkdvb2RJZCk7XHJcblx0XHR9XHJcblx0fSk7XHJcbn0pO1xyXG5cclxuLy/QlNC+0LHQsNCy0LvQtdC90LjQtSDRjdC70LXQvNC10L3RgtC+0LIg0LIg0LrQvtC90YLQtdC50L3QtdGAXHJcbmZ1bmN0aW9uIGFkZENvbnRlbnRUb0NvbnRhaW5lcihjb250YWluZXJDbGFzcywgZWxlbWVudCkge1xyXG5cdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyQ2xhc3MpO1xyXG5cdGlmIChjb250YWluZXIpIGNvbnRhaW5lci5pbm5lckhUTUwgPSBlbGVtZW50O1xyXG59XHJcblxyXG4vL9GD0LTQsNC70LjRgtGMINC60LvQsNGB0YEg0YMg0LPRgNGD0L/Qv9GLINC60L7QvdGC0LXQudC90LXRgNC+0LJcclxuZnVuY3Rpb24gZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcyhjb250YWluZXJDbGFzcywgY2xhc3NOYW1lKSB7XHJcblx0Y29uc3QgcmVtb3ZlQ2xhc3NJbkNvbnRhaW5lciA9IChhbGxDb250YWluZXJzLCBjbGFzc05hbWUsIGkgPSAwKSA9PiB7XHJcblx0XHRpZiAoaSA8IGFsbENvbnRhaW5lcnMubGVuZ3RoKSB7XHJcblx0XHRcdGFsbENvbnRhaW5lcnNbaV0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xyXG5cdFx0XHRyZXR1cm4gcmVtb3ZlQ2xhc3NJbkNvbnRhaW5lcihhbGxDb250YWluZXJzLCBjbGFzc05hbWUsIGkgKyAxKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cdGxldCBhbGxDb250YWluZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb250YWluZXJDbGFzcyk7XHJcblx0cmVtb3ZlQ2xhc3NJbkNvbnRhaW5lcihhbGxDb250YWluZXJzLCBjbGFzc05hbWUpO1xyXG59XHJcblxyXG4vLyDRgtC+0LLQsNGA0YtcclxuZnVuY3Rpb24gR29vZFNldHRpbmcoKSB7XHJcblx0bGV0IGdvb2RzSW5QYWdlID0gW10sXHJcblx0XHRhdmFsaWFibGUgPSBmYWxzZSxcclxuXHRcdHNvcnRpbmdWYWx1ZSA9ICduYW1lJztcclxuXHJcblx0Y29uc3Qgc29ydGluZ0F2YWxpYWJsZSA9IGdvb2RzID0+IHtcclxuXHRcdHJldHVybiBnb29kcy5maWx0ZXIoZWxlbSA9PiBlbGVtLmF2YWxpYWJsZSk7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc29ydGluZ0J5Q29zdCA9IGdvb2RzID0+IHtcclxuXHRcdHJldHVybiBnb29kcy5zb3J0KChwcmV2LCBuZXh0KSA9PiBwcmV2LnByaWNlIC0gbmV4dC5wcmljZSk7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc29ydGluZ0J5TmFtZSA9IGdvb2RzID0+IHtcclxuXHRcdHJldHVybiBnb29kcy5zb3J0KChwcmV2LCBuZXh0KSA9PiB7XHJcblx0XHRcdGNvbnN0IHggPSBwcmV2LnRpdGxlLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdGNvbnN0IHkgPSBuZXh0LnRpdGxlLnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdGlmICh4IDwgeSkgcmV0dXJuIC0xO1xyXG5cdFx0XHRpZiAoeCA8IHkpIHJldHVybiAxO1xyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc29ydGluZyA9IGdvb2RzID0+IHtcclxuXHRcdGlmIChhdmFsaWFibGUpIGdvb2RzID0gc29ydGluZ0F2YWxpYWJsZShnb29kcyk7XHJcblxyXG5cdFx0aWYgKHNvcnRpbmdWYWx1ZSA9PSAnY29zdCcpIGdvb2RzID0gc29ydGluZ0J5Q29zdChnb29kcyk7XHJcblx0XHRlbHNlIGlmIChzb3J0aW5nVmFsdWUgPT0gJ25hbWUnKSBnb29kcyA9IHNvcnRpbmdCeU5hbWUoZ29vZHMpO1xyXG5cdFx0cmV0dXJuIGdvb2RzO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHRydW5jYXRlID0gZnVuY3Rpb24oZGVzY3IsIG1heExlbmd0aCkge1xyXG5cdFx0aWYgKGRlc2NyLmxlbmd0aCA+IG1heExlbmd0aCkge1xyXG5cdFx0XHRsZXQgZ2FwID0gZGVzY3IubGFzdEluZGV4T2YoJyAnLCBtYXhMZW5ndGgpO1xyXG5cdFx0XHRyZXR1cm4gYCR7ZGVzY3Iuc2xpY2UoMCwgZ2FwKX0gLi4uYDtcclxuXHRcdH1cclxuXHRcdHJldHVybiBkZXNjcjtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBnZXRHb29kQ29udGVudCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IHsgaWQsIGltYWdlLCB0aXRsZSwgcHJpY2UsIGRlc2NyIH0gPSBnb29kO1xyXG5cdFx0cmV0dXJuIGA8ZGl2IGNsYXNzPVwiZ29vZF9faXRlbSBqcy1nb29kLWl0ZW1cIiBkYXRhLWdvb2QtaWQ9JHtpZH0+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9faW1hZ2VcIj48aW1nIHNyYz1cIiR7aW1hZ2V9XCIvPjwvZGl2PlxyXG5cdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2luZm9ybWF0aW9uXCI+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX190aXRsZVwiPiR7dGl0bGV9PC9kaXY+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19wcmljZVwiPiR7cHJpY2V9INGA0YPQsTwvZGl2PlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fZGVzY3JpcHRpb25cIj4ke3RydW5jYXRlKGRlc2NyLCA2NSl9PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX190cmFuc2FjdGlvblwiPlxyXG5cdFx0XHRcdFx0XHQ8YnV0dG9uIGNsYXNzPVwiZ29vZF9fYnV0dG9uIGpzLWFkZC10by1iYXNrZXRcIj7QlNC+0LHQsNCy0LjRgtGMINCyINC60L7RgNC30LjQvdGDPC9idXR0b24+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19iYXNrZXQtZmVlZGJhY2sganMtZ29vZC1pbi1iYXNrZXRcIj48L2Rpdj5cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdDwvZGl2PmA7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgYWRkR29vZHNUb0NvbnRhaW5lciA9IGdvb2RzID0+IHtcclxuXHRcdGdvb2RzSW5QYWdlID0gZ29vZHM7XHJcblx0XHRjb25zdCBnb29kc0NvbnRlbnQgPSBnb29kcy5tYXAoZ29vZCA9PiBnZXRHb29kQ29udGVudChnb29kKSkuam9pbignJyk7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1nb29kJywgZ29vZHNDb250ZW50KTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLmxvYWRHb29kcyA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0ZmV0Y2goJ2h0dHBzOi8vZHphZHJhbmlrLmdpdGh1Yi5pby9nb29kcy1hbmQtYmFza2V0L3NyYy9qc29uL2dvb2RzLmpzb24nKVxyXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcblx0XHRcdC50aGVuKGdvb2RzID0+IHtcclxuXHRcdFx0XHRhZGRHb29kc1RvQ29udGFpbmVyKGdvb2RzUGFnaW5nLmFkZFBhZ2luZ0dldEl0ZW1zSW5QYWdlKHNvcnRpbmcoZ29vZHMpKSk7XHJcblx0XHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdHRoaXMuc2V0QXZhbGlhYmxlID0gZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdGF2YWxpYWJsZSA9IHZhbHVlO1xyXG5cdFx0Z29vZHNQYWdpbmcuc2V0QWN0aXZlUGFnZSgwKTtcclxuXHRcdHRoaXMubG9hZEdvb2RzKCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5zZXRTb3J0aW5nID0gZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdGlmIChzb3J0aW5nVmFsdWUgIT0gdmFsdWUpIHtcclxuXHRcdFx0c29ydGluZ1ZhbHVlID0gdmFsdWU7XHJcblx0XHRcdHRoaXMubG9hZEdvb2RzKCk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0dGhpcy5nZXRHb29kSW5mb3JtYXRpb24gPSBmdW5jdGlvbihpZCkge1xyXG5cdFx0cmV0dXJuIGdvb2RzSW5QYWdlLmZpbmQoaXRlbSA9PiBpdGVtLmlkID09IGlkKTtcclxuXHR9O1xyXG59XHJcblxyXG4vL9C/0LDQs9C40L3QsNGG0LjRj1xyXG5mdW5jdGlvbiBQYWdpbmcoKSB7XHJcblx0Y29uc3QgYW1vdW50UGFnZUl0ZW1zID0gNTsgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0Y3Qu9C10LzQtdC90YLQvtCyINC90LAg0YHRgtGA0LDQvdC40YbQtVxyXG5cdGxldCBudW1iZXJBY3RpdmVQYWdlID0gMDsgLy8g0LDQutGC0LjQstC90LDRjyDRgdGC0YDQsNC90LjRhtCwXHJcblxyXG5cdGNvbnN0IGdldFBCdXR0b25Db250ZW50ID0gbnVtYmVyID0+IHtcclxuXHRcdHJldHVybiBgPGJ1dHRvbiBcclxuXHRcdFx0Y2xhc3M9XCJwYWdpbmF0aW9uX19idXR0b24ganMtcGFnaW5hdGlvbi1idXR0b24gJHtudW1iZXIgPT09IG51bWJlckFjdGl2ZVBhZ2UgPyAnYWN0aXZlJyA6ICcnfVwiIFxyXG5cdFx0XHRkYXRhLXAtYnV0dG9uLW51bWJlcj1cIiR7bnVtYmVyICsgMX1cIj5cclxuXHRcdFx0XHQke251bWJlciArIDF9XHJcblx0XHRcdDwvYnV0dG9uPmA7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0UERvdHNDb250ZW50ID0gKCkgPT4ge1xyXG5cdFx0cmV0dXJuIGA8c3BhbiBjbGFzcz0ncGFnaW5hdGlvbl9fZG90cyc+Li4uPC9zcGFuPmA7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50ID0gKGZpcnN0LCBsYXN0LCBwQnV0dG9uc0NvbnRlbnQgPSAnJykgPT4ge1xyXG5cdFx0aWYgKGZpcnN0IDwgbGFzdCkge1xyXG5cdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UEJ1dHRvbkNvbnRlbnQoZmlyc3QpO1xyXG5cdFx0XHRyZXR1cm4gZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KGZpcnN0ICsgMSwgbGFzdCwgcEJ1dHRvbnNDb250ZW50KTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBwQnV0dG9uc0NvbnRlbnQ7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0UEJ1dHRvbnNDb250ZW50ID0gaXRlbXMgPT4ge1xyXG5cdFx0bGV0IGFtb3VudEJ1dHRvbnMgPSBNYXRoLmNlaWwoaXRlbXMubGVuZ3RoIC8gYW1vdW50UGFnZUl0ZW1zKSwgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0YHRgtGA0LDQvdC40YZcclxuXHRcdFx0cEJ1dHRvbnNDb250ZW50ID0gJyc7IC8vINGA0LDQt9C80LXRgtC60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGG0LjQuFxyXG5cclxuXHRcdGlmIChhbW91bnRCdXR0b25zID4gNikge1xyXG5cdFx0XHRpZiAobnVtYmVyQWN0aXZlUGFnZSA8IDIgfHwgbnVtYmVyQWN0aXZlUGFnZSA+IGFtb3VudEJ1dHRvbnMgLSAzKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCAzKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMywgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH0gZWxzZSBpZiAobnVtYmVyQWN0aXZlUGFnZSA9PSAyKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCA0KTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMSwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH0gZWxzZSBpZiAobnVtYmVyQWN0aXZlUGFnZSA9PSBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMSk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDQsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKG51bWJlckFjdGl2ZVBhZ2UgPiAyICYmIG51bWJlckFjdGl2ZVBhZ2UgPCBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMSk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQobnVtYmVyQWN0aXZlUGFnZSAtIDEsIG51bWJlckFjdGl2ZVBhZ2UgKyAyKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMSwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcEJ1dHRvbnNDb250ZW50O1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGdldEl0ZW1zSW5BY3RpdmVQYWdlID0gaXRlbXMgPT4ge1xyXG5cdFx0Y29uc3QgZmlyc3RJdGVtID0gbnVtYmVyQWN0aXZlUGFnZSAqIGFtb3VudFBhZ2VJdGVtcyxcclxuXHRcdFx0bGFzdEl0ZW0gPSBmaXJzdEl0ZW0gKyBhbW91bnRQYWdlSXRlbXM7XHJcblx0XHRyZXR1cm4gaXRlbXMuc2xpY2UoZmlyc3RJdGVtLCBsYXN0SXRlbSk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5zZXRBY3RpdmVQYWdlID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcblx0XHRudW1iZXJBY3RpdmVQYWdlID0gbnVtYmVyO1xyXG5cdFx0Z29vZHMubG9hZEdvb2RzKCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5hZGRQYWdpbmdHZXRJdGVtc0luUGFnZSA9IGZ1bmN0aW9uKGl0ZW1zKSB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1wYWdpbmF0aW9uJywgZ2V0UEJ1dHRvbnNDb250ZW50KGl0ZW1zKSk7XHJcblx0XHRyZXR1cm4gZ2V0SXRlbXNJbkFjdGl2ZVBhZ2UoaXRlbXMpO1xyXG5cdH07XHJcbn1cclxuXHJcbi8v0LrQvtGA0LfQuNC90LBcclxuZnVuY3Rpb24gQmFza2V0U2V0dGluZygpIHtcclxuXHRsZXQgZ29vZHNJbkJhc2tldCA9IFtdO1xyXG5cclxuXHRjb25zdCBnZXRHb29kQ29udGVudCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IHsgaWQsIGltYWdlLCB0aXRsZSwgY291bnQgfSA9IGdvb2Q7XHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtaXRlbVwiIGRhdGEtYi1nb29kLWlkPVwiJHtpZH1cIj5cclxuXHRcdFx0PGJ1dHRvbiBjbGFzcz1cImJhc2tldF9fZ29vZC1yZW1vdmUganMtcmVtb3ZlLWdvb2RcIj4mIzEyODkzODs8L2J1dHRvbj5cclxuXHRcdFx0PGRpdiBjbGFzcz1cImJhc2tldF9fZ29vZC1pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIi8+PC9kaXY+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtbmFtZVwiPiR7dGl0bGV9PC9kaXY+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtYW1vdXRcIj4ke2NvdW50fTwvZGl2PlxyXG5cdFx0PC9kaXY+YDtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBhZGRHb29kVG9Db250YWluZXIgPSAoKSA9PiB7XHJcblx0XHRsZXQgZ29vZHNDb250ZW50ID0gZ29vZHNJbkJhc2tldC5tYXAoZ29vZCA9PiBnZXRHb29kQ29udGVudChnb29kKSkuam9pbignJyk7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1iYXNrZXQtZ29vZCcsIGdvb2RzQ29udGVudCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZmluZEdvb2RBbmRSZW1vdmUgPSBpZCA9PiB7XHJcblx0XHRsZXQgZ29vZEluZGV4ID0gZ29vZHNJbkJhc2tldC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSAraWQpO1xyXG5cdFx0Z29vZHNJbkJhc2tldC5zcGxpY2UoZ29vZEluZGV4LCAxKTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBmaW5kR29vZEFuZEFkZCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IGdvb2RJbkJhc2tldCA9IGdvb2RzSW5CYXNrZXQuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGdvb2QuaWQpO1xyXG5cdFx0aWYgKGdvb2RJbkJhc2tldCkge1xyXG5cdFx0XHRnb29kSW5CYXNrZXQuY291bnQrKztcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGdvb2QuY291bnQgPSAxO1xyXG5cdFx0XHRnb29kc0luQmFza2V0ID0gWy4uLmdvb2RzSW5CYXNrZXQsIGdvb2RdO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGNvbnN0IGNvdW50VG90YWxDb3N0ID0gKCkgPT4ge1xyXG5cdFx0bGV0IHRvdGFsQ29zdCA9IGdvb2RzSW5CYXNrZXQucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0uY291bnQgKiBpdGVtLnByaWNlLCAwKTtcclxuXHRcdGFkZENvbnRlbnRUb0NvbnRhaW5lcignLmpzLWNvdW50LXJlc3VsdCcsIHRvdGFsQ29zdCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc2F2ZVRvTG9jYWxTdG9yYWdlID0gKCkgPT4ge1xyXG5cdFx0bG9jYWxTdG9yYWdlLmdvb2RzSW5CYXNrZXQgPSBKU09OLnN0cmluZ2lmeShnb29kc0luQmFza2V0KTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBjb3VudEdvb2RzSW5CYXNrZXQgPSAoKSA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHNJbkJhc2tldC5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5jb3VudCwgMCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgcmVsb2FkQmFza2V0ID0gKCkgPT4ge1xyXG5cdFx0c2F2ZVRvTG9jYWxTdG9yYWdlKCk7XHJcblx0XHRhZGRHb29kVG9Db250YWluZXIoKTtcclxuXHRcdGNvdW50VG90YWxDb3N0KCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5nZXRMb2NhbFNvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29kc0luQmFza2V0JykgIT0gbnVsbClcclxuXHRcdFx0Z29vZHNJbkJhc2tldCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2RzSW5CYXNrZXQnKSk7XHJcblx0XHRhZGRHb29kVG9Db250YWluZXIoKTtcclxuXHRcdGNvdW50VG90YWxDb3N0KCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5nZXRDb3VudEdvb2RzSW5CYXNrZXQgPSAoKSA9PiB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1nb29kLWluLWJhc2tldCcsIGNvdW50R29vZHNJbkJhc2tldCgpKTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLmFkZEdvb2RUb0Jhc2tldCA9IGdvb2QgPT4ge1xyXG5cdFx0ZmluZEdvb2RBbmRBZGQoZ29vZCk7XHJcblx0XHRyZWxvYWRCYXNrZXQoKTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLnJlbW92ZUdvb2RGcm9tQmFza2V0ID0gaWQgPT4ge1xyXG5cdFx0ZmluZEdvb2RBbmRSZW1vdmUoaWQpO1xyXG5cdFx0cmVsb2FkQmFza2V0KCk7XHJcblx0fTtcclxufVxyXG4iXX0=
