"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}var basket=new BasketSetting,goods=new GoodSetting,paging=new Paging,container=new ContainerClassSetting;function addContentToContainer(t,n){var o=document.querySelector(t);o&&(o.innerHTML=n)}function ContainerClassSetting(){this.findContainersAndRemoveClass=function(t,n){!function t(n,o){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<n.length)return n[e].classList.remove(o),t(n,o,e+1)}(document.querySelectorAll(t),n)}}function GoodSetting(){var t=[],n=!1,o="name";this.loadGoods=function(){fetch("https://dzadranik.github.io/goods-and-basket/src/json/goods.json").then((function(t){return t.json()})).then((function(e){!function(n){t=n,addContentToContainer(".js-good",n.map((function(t){return function(t){var n=t.id,o=t.image,e=t.title,a=t.price,i=t.descr;return'<div class="good__item js-good-item" data-good-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(o,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(e,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(a,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(function(t,n){if(t.length>n){var o=t.lastIndexOf(" ",n);return"".concat(t.slice(0,o)," ...")}return t}(i,65),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button js-add-to-basket">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}(t)})).join(""))}(paging.addPagingGetItemsInPage(function(t){return n&&(t=function(t){return t.filter((function(t){return t.avaliable}))}(t)),"cost"==o?t=function(t){return t.sort((function(t,n){return t.price-n.price}))}(t):"name"==o&&(t=function(t){return t.sort((function(t,n){var o=t.title.toLowerCase(),e=n.title.toLowerCase();return o<e?-1:o<e?1:void 0}))}(t)),t}(e)))}))},this.setAvaliable=function(t){n=t,paging.setActivePage(0),this.loadGoods()},this.setSorting=function(t){o!=t&&(o=t,this.loadGoods())},this.getGoodInformation=function(n){return t.find((function(t){return t.id==n}))}}function Paging(){var t=0,n=function(n){return'<button \n\t\t\tclass="pagination__button js-pagination-button '.concat(n===t?"active":"",'" \n\t\t\tdata-p-button-number="').concat(n+1,'">\n\t\t\t\t').concat(n+1,"\n\t\t\t</button>")},o=function t(o,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o<e?t(o+1,e,a+=n(o)):a};this.setActivePage=function(n){t=n,goods.loadGoods()},this.addPagingGetItemsInPage=function(n){return addContentToContainer(".js-pagination",function(n){var e=Math.ceil(n.length/5),a="";return e>6?t<2||t>e-3?(a+=o(0,3),a+="<span class='pagination__dots'>...</span>",a+=o(e-3,e)):2==t?(a+=o(0,4),a+="<span class='pagination__dots'>...</span>",a+=o(e-1,e)):t==e-3?(a+=o(0,1),a+="<span class='pagination__dots'>...</span>",a+=o(e-4,e)):t>2&&t<e-3&&(a+=getAnyPButtons(0,1),a+=o(),a+=getAnyPButtons(t-1,t+2),a+=o(),a+=getAnyPButtons(e-1,e)):a+=o(0,e),a}(n)),function(n){var o=5*t,e=o+5;return n.slice(o,e)}(n)}}function BasketSetting(){var t=[],n=function(){addContentToContainer(".js-basket-good",t.map((function(t){return function(t){var n=t.id,o=t.image,e=t.title,a=t.count;return'<div class="basket__good-item" data-b-good-id="'.concat(n,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(o,'"/></div>\n\t\t\t<div class="basket__good-name">').concat(e,'</div>\n\t\t\t<div class="basket__good-amout">').concat(a,"</div>\n\t\t</div>")}(t)})).join(""))},o=function(){addContentToContainer(".js-count-result",t.reduce((function(t,n){return t+n.count*n.price}),0))},e=function(){localStorage.goodsInBasket=JSON.stringify(t),n(),o()};this.getLocalSorage=function(){null!=localStorage.getItem("goodsInBasket")&&(t=JSON.parse(localStorage.getItem("goodsInBasket"))),n(),o()},this.getCountGoodsInBasket=function(){addContentToContainer(".js-good-in-basket",t.reduce((function(t,n){return t+n.count}),0))},this.addGoodToBasket=function(n){!function(n){var o=t.find((function(t){return t.id===n.id}));o?o.count++:(n.count=1,t=[].concat(_toConsumableArray(t),[n]))}(n),e()},this.removeGoodFromBasket=function(n){!function(n){var o=t.findIndex((function(t){return t.id===+n}));t.splice(o,1)}(n),e()}}goods.loadGoods(),basket.getLocalSorage(),document.addEventListener("DOMContentLoaded",(function(){var t=function(t,n,o){document.querySelector(t).addEventListener(n,(function(t){return o(t)}))};t(".js-pagination","click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&paging.setActivePage(n.dataset.pButtonNumber-1)})),t(".js-sorting-buttons","click",(function(t){var n=t.target;if(n.classList.contains("js-sorting")&&!n.classList.contains("active")){var o=n.dataset.sorting;container.findContainersAndRemoveClass(".js-sorting","active"),goods.setSorting(o),n.classList.add("active")}})),t(".js-avaliable","change",(function(t){goods.setAvaliable(t.target.checked)})),t(".js-good","click",(function(t){if(t.target.classList.contains("js-add-to-basket")){var n=t.target.closest(".js-good-item").dataset.goodId;basket.addGoodToBasket(goods.getGoodInformation(n))}})),t(".js-basket-good","click",(function(t){t.target.classList.contains("js-remove-good")&&basket.removeGoodFromBasket(t.target.parentElement.dataset.bGoodId)}))}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwiYmFza2V0IiwiQmFza2V0U2V0dGluZyIsImdvb2RzIiwiR29vZFNldHRpbmciLCJwYWdpbmciLCJQYWdpbmciLCJjb250YWluZXIiLCJDb250YWluZXJDbGFzc1NldHRpbmciLCJhZGRDb250ZW50VG9Db250YWluZXIiLCJjb250YWluZXJDbGFzcyIsImVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJ0aGlzIiwiZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcyIsImNsYXNzTmFtZSIsInJlbW92ZUNsYXNzSW5Db250YWluZXIiLCJhbGxDb250YWluZXJzIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwicXVlcnlTZWxlY3RvckFsbCIsImdvb2RzSW5QYWdlIiwiYXZhbGlhYmxlIiwic29ydGluZ1ZhbHVlIiwibG9hZEdvb2RzIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwibWFwIiwiZ29vZCIsImlkIiwiaW1hZ2UiLCJ0aXRsZSIsInByaWNlIiwiZGVzY3IiLCJjb25jYXQiLCJtYXhMZW5ndGgiLCJnYXAiLCJsYXN0SW5kZXhPZiIsInNsaWNlIiwidHJ1bmNhdGUiLCJnZXRHb29kQ29udGVudCIsImpvaW4iLCJhZGRHb29kc1RvQ29udGFpbmVyIiwiYWRkUGFnaW5nR2V0SXRlbXNJblBhZ2UiLCJmaWx0ZXIiLCJlbGVtIiwic29ydGluZ0F2YWxpYWJsZSIsInNvcnQiLCJwcmV2IiwibmV4dCIsInNvcnRpbmdCeUNvc3QiLCJ4IiwidG9Mb3dlckNhc2UiLCJ5Iiwic29ydGluZ0J5TmFtZSIsInNvcnRpbmciLCJzZXRBdmFsaWFibGUiLCJ2YWx1ZSIsInNldEFjdGl2ZVBhZ2UiLCJzZXRTb3J0aW5nIiwiZ2V0R29vZEluZm9ybWF0aW9uIiwiZmluZCIsIml0ZW0iLCJudW1iZXJBY3RpdmVQYWdlIiwiZ2V0UEJ1dHRvbkNvbnRlbnQiLCJudW1iZXIiLCJnZXRQQnV0dG9uc051bWJlckNvbnRlbnQiLCJmaXJzdCIsImxhc3QiLCJwQnV0dG9uc0NvbnRlbnQiLCJpdGVtcyIsImFtb3VudEJ1dHRvbnMiLCJNYXRoIiwiY2VpbCIsImdldEFueVBCdXR0b25zIiwiZ2V0UEJ1dHRvbnNDb250ZW50IiwiZmlyc3RJdGVtIiwibGFzdEl0ZW0iLCJnZXRJdGVtc0luQWN0aXZlUGFnZSIsImdvb2RzSW5CYXNrZXQiLCJhZGRHb29kVG9Db250YWluZXIiLCJjb3VudCIsImNvdW50VG90YWxDb3N0IiwicmVkdWNlIiwic3VtIiwicmVsb2FkQmFza2V0IiwibG9jYWxTdG9yYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldExvY2FsU29yYWdlIiwiZ2V0SXRlbSIsInBhcnNlIiwiZ2V0Q291bnRHb29kc0luQmFza2V0IiwiYWRkR29vZFRvQmFza2V0IiwiZ29vZEluQmFza2V0IiwiZmluZEdvb2RBbmRBZGQiLCJyZW1vdmVHb29kRnJvbUJhc2tldCIsImdvb2RJbmRleCIsImZpbmRJbmRleCIsInNwbGljZSIsImZpbmRHb29kQW5kUmVtb3ZlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZXIiLCJldmVudE5hbWUiLCJmbiIsImV2ZW50IiwidGFyZ2V0RWxlbWVudCIsInRhcmdldCIsImNvbnRhaW5zIiwiZGF0YXNldCIsInBCdXR0b25OdW1iZXIiLCJzb3J0aW5nU2V0dGluZyIsImFkZCIsImNoZWNrZWQiLCJnb29kSWQiLCJjbG9zZXN0IiwicGFyZW50RWxlbWVu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QUE0QkYsRUFBYzFGLFVBQVU0RixTQUFTLFdBQ2pHN0csT0FBTzJELGNBQWNnRCxFQUFjRyxRQUFRQyxjQUFnQixNQUs3RFIsRUFBUSxzQkFBdUIsU0FBUyxTQUFBRyxHQUN2QyxJQUFNQyxFQUFnQkQsRUFBTUUsT0FDNUIsR0FBSUQsRUFBYzFGLFVBQVU0RixTQUFTLGdCQUFrQkYsRUFBYzFGLFVBQVU0RixTQUFTLFVBQVcsQ0FDbEcsSUFBTUcsRUFBaUJMLEVBQWNHLFFBQVF0RCxRQUM3Q3RELFVBQVVTLDZCQUE2QixjQUFlLFVBQ3REYixNQUFNOEQsV0FBV29ELEdBQ2pCTCxFQUFjMUYsVUFBVWdHLElBQUksY0FLOUJWLEVBQVEsZ0JBQWlCLFVBQVUsU0FBQUcsR0FDbEM1RyxNQUFNMkQsYUFBYWlELEVBQU1FLE9BQU9NLFlBSWpDWCxFQUFRLFdBQVksU0FBUyxTQUFBRyxHQUM1QixHQUFJQSxFQUFNRSxPQUFPM0YsVUFBVTRGLFNBQVMsb0JBQXFCLENBQ3hELElBQUlNLEVBQVNULEVBQU1FLE9BQU9RLFFBQVEsaUJBQWlCTixRQUFRSyxPQUMzRHZILE9BQU9rRyxnQkFBZ0JoRyxNQUFNK0QsbUJBQW1Cc0QsUUFLbERaLEVBQVEsa0JBQW1CLFNBQVMsU0FBQUcsR0FDL0JBLEVBQU1FLE9BQU8zRixVQUFVNEYsU0FBUyxtQkFDbkNqSCxPQUFPcUcscUJBQXFCUyxFQUFNRSxPQUFPUyxjQUFjUCxRQUFRUSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBiYXNrZXQgPSBuZXcgQmFza2V0U2V0dGluZygpLFxyXG5cdGdvb2RzID0gbmV3IEdvb2RTZXR0aW5nKCksXHJcblx0cGFnaW5nID0gbmV3IFBhZ2luZygpLFxyXG5cdGNvbnRhaW5lciA9IG5ldyBDb250YWluZXJDbGFzc1NldHRpbmcoKTtcclxuXHJcbmdvb2RzLmxvYWRHb29kcygpO1xyXG5iYXNrZXQuZ2V0TG9jYWxTb3JhZ2UoKTtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHtcclxuXHRjb25zdCBoYW5kbGVyID0gKGVsZW1lbnQsIGV2ZW50TmFtZSwgZm4pID0+IHtcclxuXHRcdGNvbnN0IGVsZW1lbnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpO1xyXG5cdFx0ZWxlbWVudENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZXZlbnQgPT4gZm4oZXZlbnQpKTtcclxuXHR9O1xyXG5cclxuXHQvL9GB0LvRg9GI0LDQu9C60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGC0L7RgNCwXHJcblx0aGFuZGxlcignLmpzLXBhZ2luYXRpb24nLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1wYWdpbmF0aW9uLWJ1dHRvbicpICYmICF0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuXHRcdFx0cGFnaW5nLnNldEFjdGl2ZVBhZ2UodGFyZ2V0RWxlbWVudC5kYXRhc2V0LnBCdXR0b25OdW1iZXIgLSAxKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0YHQu9GD0YjQsNC70LrQsCDRgdC+0YDRgtC40YDQvtCy0L7QulxyXG5cdGhhbmRsZXIoJy5qcy1zb3J0aW5nLWJ1dHRvbnMnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1zb3J0aW5nJykgJiYgIXRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xyXG5cdFx0XHRjb25zdCBzb3J0aW5nU2V0dGluZyA9IHRhcmdldEVsZW1lbnQuZGF0YXNldC5zb3J0aW5nO1xyXG5cdFx0XHRjb250YWluZXIuZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcygnLmpzLXNvcnRpbmcnLCAnYWN0aXZlJyk7XHJcblx0XHRcdGdvb2RzLnNldFNvcnRpbmcoc29ydGluZ1NldHRpbmcpO1xyXG5cdFx0XHR0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvLyDRgdC70YPRiNCw0LvQutCwINGB0L7RgNGC0LjRgNC+0LLQutC4INC/0L4g0L3QsNC70LjRh9C40Y5cclxuXHRoYW5kbGVyKCcuanMtYXZhbGlhYmxlJywgJ2NoYW5nZScsIGV2ZW50ID0+IHtcclxuXHRcdGdvb2RzLnNldEF2YWxpYWJsZShldmVudC50YXJnZXQuY2hlY2tlZCk7XHJcblx0fSk7XHJcblxyXG5cdC8vINC60L3QvtC/0LrQsCDQtNC+0LHQsNCy0LjRgtGMINCyINC60L7RgNC30LjQvdGDXHJcblx0aGFuZGxlcignLmpzLWdvb2QnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtYWRkLXRvLWJhc2tldCcpKSB7XHJcblx0XHRcdGxldCBnb29kSWQgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmpzLWdvb2QtaXRlbScpLmRhdGFzZXQuZ29vZElkO1xyXG5cdFx0XHRiYXNrZXQuYWRkR29vZFRvQmFza2V0KGdvb2RzLmdldEdvb2RJbmZvcm1hdGlvbihnb29kSWQpKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0LrQvdC+0L/QutCwINGD0LTQsNC70LjRgtGMINC40Lcg0LrQvtGA0LfQuNC90YtcclxuXHRoYW5kbGVyKCcuanMtYmFza2V0LWdvb2QnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtcmVtb3ZlLWdvb2QnKSkge1xyXG5cdFx0XHRiYXNrZXQucmVtb3ZlR29vZEZyb21CYXNrZXQoZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuZGF0YXNldC5iR29vZElkKTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG4vL9CU0L7QsdCw0LLQu9C10L3QuNC1INGN0LvQtdC80LXQvdGC0L7QsiDQsiDQutC+0L3RgtC10LnQvdC10YBcclxuZnVuY3Rpb24gYWRkQ29udGVudFRvQ29udGFpbmVyKGNvbnRhaW5lckNsYXNzLCBlbGVtZW50KSB7XHJcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJDbGFzcyk7XHJcblx0aWYgKGNvbnRhaW5lcikgY29udGFpbmVyLmlubmVySFRNTCA9IGVsZW1lbnQ7XHJcbn1cclxuXHJcbi8v0YPQtNCw0LvQuNGC0Ywg0LrQu9Cw0YHRgSDRgyDQs9GA0YPQv9C/0Ysg0LrQvtC90YLQtdC50L3QtdGA0L7QslxyXG5mdW5jdGlvbiBDb250YWluZXJDbGFzc1NldHRpbmcoKSB7XHJcblx0Y29uc3QgcmVtb3ZlQ2xhc3NJbkNvbnRhaW5lciA9IChhbGxDb250YWluZXJzLCBjbGFzc05hbWUsIGkgPSAwKSA9PiB7XHJcblx0XHRpZiAoaSA8IGFsbENvbnRhaW5lcnMubGVuZ3RoKSB7XHJcblx0XHRcdGFsbENvbnRhaW5lcnNbaV0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xyXG5cdFx0XHRyZXR1cm4gcmVtb3ZlQ2xhc3NJbkNvbnRhaW5lcihhbGxDb250YWluZXJzLCBjbGFzc05hbWUsIGkgKyAxKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cdHRoaXMuZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGNvbnRhaW5lckNsYXNzLCBjbGFzc05hbWUpIHtcclxuXHRcdGxldCBhbGxDb250YWluZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb250YWluZXJDbGFzcyk7XHJcblx0XHRyZW1vdmVDbGFzc0luQ29udGFpbmVyKGFsbENvbnRhaW5lcnMsIGNsYXNzTmFtZSk7XHJcblx0fTtcclxufVxyXG5cclxuLy8g0YLQvtCy0LDRgNGLXHJcbmZ1bmN0aW9uIEdvb2RTZXR0aW5nKCkge1xyXG5cdGxldCBnb29kc0luUGFnZSA9IFtdLFxyXG5cdFx0YXZhbGlhYmxlID0gZmFsc2UsXHJcblx0XHRzb3J0aW5nVmFsdWUgPSAnbmFtZSc7XHJcblxyXG5cdGNvbnN0IHNvcnRpbmdBdmFsaWFibGUgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuZmlsdGVyKGVsZW0gPT4gZWxlbS5hdmFsaWFibGUpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNvcnRpbmdCeUNvc3QgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuc29ydCgocHJldiwgbmV4dCkgPT4gcHJldi5wcmljZSAtIG5leHQucHJpY2UpO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNvcnRpbmdCeU5hbWUgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuc29ydCgocHJldiwgbmV4dCkgPT4ge1xyXG5cdFx0XHRjb25zdCB4ID0gcHJldi50aXRsZS50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0XHRjb25zdCB5ID0gbmV4dC50aXRsZS50b0xvd2VyQ2FzZSgpO1xyXG5cdFx0XHRpZiAoeCA8IHkpIHJldHVybiAtMTtcclxuXHRcdFx0aWYgKHggPCB5KSByZXR1cm4gMTtcclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IHNvcnRpbmcgPSBnb29kcyA9PiB7XHJcblx0XHRpZiAoYXZhbGlhYmxlKSBnb29kcyA9IHNvcnRpbmdBdmFsaWFibGUoZ29vZHMpO1xyXG5cclxuXHRcdGlmIChzb3J0aW5nVmFsdWUgPT0gJ2Nvc3QnKSBnb29kcyA9IHNvcnRpbmdCeUNvc3QoZ29vZHMpO1xyXG5cdFx0ZWxzZSBpZiAoc29ydGluZ1ZhbHVlID09ICduYW1lJykgZ29vZHMgPSBzb3J0aW5nQnlOYW1lKGdvb2RzKTtcclxuXHRcdHJldHVybiBnb29kcztcclxuXHR9O1xyXG5cclxuXHRjb25zdCB0cnVuY2F0ZSA9IGZ1bmN0aW9uKGRlc2NyLCBtYXhMZW5ndGgpIHtcclxuXHRcdGlmIChkZXNjci5sZW5ndGggPiBtYXhMZW5ndGgpIHtcclxuXHRcdFx0bGV0IGdhcCA9IGRlc2NyLmxhc3RJbmRleE9mKCcgJywgbWF4TGVuZ3RoKTtcclxuXHRcdFx0cmV0dXJuIGAke2Rlc2NyLnNsaWNlKDAsIGdhcCl9IC4uLmA7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZGVzY3I7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0R29vZENvbnRlbnQgPSBnb29kID0+IHtcclxuXHRcdGxldCB7IGlkLCBpbWFnZSwgdGl0bGUsIHByaWNlLCBkZXNjciB9ID0gZ29vZDtcclxuXHRcdHJldHVybiBgPGRpdiBjbGFzcz1cImdvb2RfX2l0ZW0ganMtZ29vZC1pdGVtXCIgZGF0YS1nb29kLWlkPSR7aWR9PlxyXG5cdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2ltYWdlXCI+PGltZyBzcmM9XCIke2ltYWdlfVwiLz48L2Rpdj5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19pbmZvcm1hdGlvblwiPlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fdGl0bGVcIj4ke3RpdGxlfTwvZGl2PlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fcHJpY2VcIj4ke3ByaWNlfSDRgNGD0LE8L2Rpdj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2Rlc2NyaXB0aW9uXCI+JHt0cnVuY2F0ZShkZXNjciwgNjUpfTwvZGl2PlxyXG5cdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fdHJhbnNhY3Rpb25cIj5cclxuXHRcdFx0XHRcdFx0PGJ1dHRvbiBjbGFzcz1cImdvb2RfX2J1dHRvbiBqcy1hZGQtdG8tYmFza2V0XCI+0JTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3RgzwvYnV0dG9uPlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fYmFza2V0LWZlZWRiYWNrIGpzLWdvb2QtaW4tYmFza2V0XCI+PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHQ8L2Rpdj5gO1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGFkZEdvb2RzVG9Db250YWluZXIgPSBnb29kcyA9PiB7XHJcblx0XHRnb29kc0luUGFnZSA9IGdvb2RzO1xyXG5cdFx0Y29uc3QgZ29vZHNDb250ZW50ID0gZ29vZHMubWFwKGdvb2QgPT4gZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtZ29vZCcsIGdvb2RzQ29udGVudCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5sb2FkR29vZHMgPSBmdW5jdGlvbigpIHtcclxuXHRcdGZldGNoKCdodHRwczovL2R6YWRyYW5pay5naXRodWIuaW8vZ29vZHMtYW5kLWJhc2tldC9zcmMvanNvbi9nb29kcy5qc29uJylcclxuXHRcdFx0LnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG5cdFx0XHQudGhlbihnb29kcyA9PiB7XHJcblx0XHRcdFx0YWRkR29vZHNUb0NvbnRhaW5lcihwYWdpbmcuYWRkUGFnaW5nR2V0SXRlbXNJblBhZ2Uoc29ydGluZyhnb29kcykpKTtcclxuXHRcdFx0fSk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5zZXRBdmFsaWFibGUgPSBmdW5jdGlvbih2YWx1ZSkge1xyXG5cdFx0YXZhbGlhYmxlID0gdmFsdWU7XHJcblx0XHRwYWdpbmcuc2V0QWN0aXZlUGFnZSgwKTtcclxuXHRcdHRoaXMubG9hZEdvb2RzKCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5zZXRTb3J0aW5nID0gZnVuY3Rpb24odmFsdWUpIHtcclxuXHRcdGlmIChzb3J0aW5nVmFsdWUgIT0gdmFsdWUpIHtcclxuXHRcdFx0c29ydGluZ1ZhbHVlID0gdmFsdWU7XHJcblx0XHRcdHRoaXMubG9hZEdvb2RzKCk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0dGhpcy5nZXRHb29kSW5mb3JtYXRpb24gPSBmdW5jdGlvbihpZCkge1xyXG5cdFx0cmV0dXJuIGdvb2RzSW5QYWdlLmZpbmQoaXRlbSA9PiBpdGVtLmlkID09IGlkKTtcclxuXHR9O1xyXG59XHJcblxyXG4vL9C/0LDQs9C40L3QsNGG0LjRj1xyXG5mdW5jdGlvbiBQYWdpbmcoKSB7XHJcblx0Y29uc3QgYW1vdW50UGFnZUl0ZW1zID0gNTsgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0Y3Qu9C10LzQtdC90YLQvtCyINC90LAg0YHRgtGA0LDQvdC40YbQtVxyXG5cdGxldCBudW1iZXJBY3RpdmVQYWdlID0gMDsgLy8g0LDQutGC0LjQstC90LDRjyDRgdGC0YDQsNC90LjRhtCwXHJcblxyXG5cdGNvbnN0IGdldFBCdXR0b25Db250ZW50ID0gbnVtYmVyID0+IHtcclxuXHRcdHJldHVybiBgPGJ1dHRvbiBcclxuXHRcdFx0Y2xhc3M9XCJwYWdpbmF0aW9uX19idXR0b24ganMtcGFnaW5hdGlvbi1idXR0b24gJHtudW1iZXIgPT09IG51bWJlckFjdGl2ZVBhZ2UgPyAnYWN0aXZlJyA6ICcnfVwiIFxyXG5cdFx0XHRkYXRhLXAtYnV0dG9uLW51bWJlcj1cIiR7bnVtYmVyICsgMX1cIj5cclxuXHRcdFx0XHQke251bWJlciArIDF9XHJcblx0XHRcdDwvYnV0dG9uPmA7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0UERvdHNDb250ZW50ID0gKCkgPT4ge1xyXG5cdFx0cmV0dXJuIGA8c3BhbiBjbGFzcz0ncGFnaW5hdGlvbl9fZG90cyc+Li4uPC9zcGFuPmA7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50ID0gKGZpcnN0LCBsYXN0LCBwQnV0dG9uc0NvbnRlbnQgPSAnJykgPT4ge1xyXG5cdFx0aWYgKGZpcnN0IDwgbGFzdCkge1xyXG5cdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UEJ1dHRvbkNvbnRlbnQoZmlyc3QpO1xyXG5cdFx0XHRyZXR1cm4gZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KGZpcnN0ICsgMSwgbGFzdCwgcEJ1dHRvbnNDb250ZW50KTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBwQnV0dG9uc0NvbnRlbnQ7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZ2V0UEJ1dHRvbnNDb250ZW50ID0gaXRlbXMgPT4ge1xyXG5cdFx0bGV0IGFtb3VudEJ1dHRvbnMgPSBNYXRoLmNlaWwoaXRlbXMubGVuZ3RoIC8gYW1vdW50UGFnZUl0ZW1zKSwgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0YHRgtGA0LDQvdC40YZcclxuXHRcdFx0cEJ1dHRvbnNDb250ZW50ID0gJyc7IC8vINGA0LDQt9C80LXRgtC60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGG0LjQuFxyXG5cclxuXHRcdGlmIChhbW91bnRCdXR0b25zID4gNikge1xyXG5cdFx0XHRpZiAobnVtYmVyQWN0aXZlUGFnZSA8IDIgfHwgbnVtYmVyQWN0aXZlUGFnZSA+IGFtb3VudEJ1dHRvbnMgLSAzKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCAzKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMywgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH0gZWxzZSBpZiAobnVtYmVyQWN0aXZlUGFnZSA9PSAyKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCA0KTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMSwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH0gZWxzZSBpZiAobnVtYmVyQWN0aXZlUGFnZSA9PSBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMSk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDQsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKG51bWJlckFjdGl2ZVBhZ2UgPiAyICYmIG51bWJlckFjdGl2ZVBhZ2UgPCBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRBbnlQQnV0dG9ucygwLCAxKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldEFueVBCdXR0b25zKG51bWJlckFjdGl2ZVBhZ2UgLSAxLCBudW1iZXJBY3RpdmVQYWdlICsgMik7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRBbnlQQnV0dG9ucyhhbW91bnRCdXR0b25zIC0gMSwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcEJ1dHRvbnNDb250ZW50O1xyXG5cdH07XHJcblxyXG5cdGNvbnN0IGdldEl0ZW1zSW5BY3RpdmVQYWdlID0gaXRlbXMgPT4ge1xyXG5cdFx0Y29uc3QgZmlyc3RJdGVtID0gbnVtYmVyQWN0aXZlUGFnZSAqIGFtb3VudFBhZ2VJdGVtcyxcclxuXHRcdFx0bGFzdEl0ZW0gPSBmaXJzdEl0ZW0gKyBhbW91bnRQYWdlSXRlbXM7XHJcblx0XHRyZXR1cm4gaXRlbXMuc2xpY2UoZmlyc3RJdGVtLCBsYXN0SXRlbSk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5zZXRBY3RpdmVQYWdlID0gZnVuY3Rpb24obnVtYmVyKSB7XHJcblx0XHRudW1iZXJBY3RpdmVQYWdlID0gbnVtYmVyO1xyXG5cdFx0Z29vZHMubG9hZEdvb2RzKCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5hZGRQYWdpbmdHZXRJdGVtc0luUGFnZSA9IGZ1bmN0aW9uKGl0ZW1zKSB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1wYWdpbmF0aW9uJywgZ2V0UEJ1dHRvbnNDb250ZW50KGl0ZW1zKSk7XHJcblx0XHRyZXR1cm4gZ2V0SXRlbXNJbkFjdGl2ZVBhZ2UoaXRlbXMpO1xyXG5cdH07XHJcbn1cclxuXHJcbi8v0LrQvtGA0LfQuNC90LBcclxuZnVuY3Rpb24gQmFza2V0U2V0dGluZygpIHtcclxuXHRsZXQgZ29vZHNJbkJhc2tldCA9IFtdO1xyXG5cclxuXHRjb25zdCBnZXRHb29kQ29udGVudCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IHsgaWQsIGltYWdlLCB0aXRsZSwgY291bnQgfSA9IGdvb2Q7XHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtaXRlbVwiIGRhdGEtYi1nb29kLWlkPVwiJHtpZH1cIj5cclxuXHRcdFx0PGJ1dHRvbiBjbGFzcz1cImJhc2tldF9fZ29vZC1yZW1vdmUganMtcmVtb3ZlLWdvb2RcIj4mIzEyODkzODs8L2J1dHRvbj5cclxuXHRcdFx0PGRpdiBjbGFzcz1cImJhc2tldF9fZ29vZC1pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIi8+PC9kaXY+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtbmFtZVwiPiR7dGl0bGV9PC9kaXY+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtYW1vdXRcIj4ke2NvdW50fTwvZGl2PlxyXG5cdFx0PC9kaXY+YDtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBhZGRHb29kVG9Db250YWluZXIgPSAoKSA9PiB7XHJcblx0XHRsZXQgZ29vZHNDb250ZW50ID0gZ29vZHNJbkJhc2tldC5tYXAoZ29vZCA9PiBnZXRHb29kQ29udGVudChnb29kKSkuam9pbignJyk7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1iYXNrZXQtZ29vZCcsIGdvb2RzQ29udGVudCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgZmluZEdvb2RBbmRSZW1vdmUgPSBpZCA9PiB7XHJcblx0XHRsZXQgZ29vZEluZGV4ID0gZ29vZHNJbkJhc2tldC5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSAraWQpO1xyXG5cdFx0Z29vZHNJbkJhc2tldC5zcGxpY2UoZ29vZEluZGV4LCAxKTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBmaW5kR29vZEFuZEFkZCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IGdvb2RJbkJhc2tldCA9IGdvb2RzSW5CYXNrZXQuZmluZChpdGVtID0+IGl0ZW0uaWQgPT09IGdvb2QuaWQpO1xyXG5cdFx0aWYgKGdvb2RJbkJhc2tldCkge1xyXG5cdFx0XHRnb29kSW5CYXNrZXQuY291bnQrKztcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdGdvb2QuY291bnQgPSAxO1xyXG5cdFx0XHRnb29kc0luQmFza2V0ID0gWy4uLmdvb2RzSW5CYXNrZXQsIGdvb2RdO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGNvbnN0IGNvdW50VG90YWxDb3N0ID0gKCkgPT4ge1xyXG5cdFx0bGV0IHRvdGFsQ29zdCA9IGdvb2RzSW5CYXNrZXQucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0uY291bnQgKiBpdGVtLnByaWNlLCAwKTtcclxuXHRcdGFkZENvbnRlbnRUb0NvbnRhaW5lcignLmpzLWNvdW50LXJlc3VsdCcsIHRvdGFsQ29zdCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3Qgc2F2ZVRvTG9jYWxTdG9yYWdlID0gKCkgPT4ge1xyXG5cdFx0bG9jYWxTdG9yYWdlLmdvb2RzSW5CYXNrZXQgPSBKU09OLnN0cmluZ2lmeShnb29kc0luQmFza2V0KTtcclxuXHR9O1xyXG5cclxuXHRjb25zdCBjb3VudEdvb2RzSW5CYXNrZXQgPSAoKSA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHNJbkJhc2tldC5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5jb3VudCwgMCk7XHJcblx0fTtcclxuXHJcblx0Y29uc3QgcmVsb2FkQmFza2V0ID0gKCkgPT4ge1xyXG5cdFx0c2F2ZVRvTG9jYWxTdG9yYWdlKCk7XHJcblx0XHRhZGRHb29kVG9Db250YWluZXIoKTtcclxuXHRcdGNvdW50VG90YWxDb3N0KCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5nZXRMb2NhbFNvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29kc0luQmFza2V0JykgIT0gbnVsbClcclxuXHRcdFx0Z29vZHNJbkJhc2tldCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2RzSW5CYXNrZXQnKSk7XHJcblx0XHRhZGRHb29kVG9Db250YWluZXIoKTtcclxuXHRcdGNvdW50VG90YWxDb3N0KCk7XHJcblx0fTtcclxuXHJcblx0dGhpcy5nZXRDb3VudEdvb2RzSW5CYXNrZXQgPSAoKSA9PiB7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIoJy5qcy1nb29kLWluLWJhc2tldCcsIGNvdW50R29vZHNJbkJhc2tldCgpKTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLmFkZEdvb2RUb0Jhc2tldCA9IGdvb2QgPT4ge1xyXG5cdFx0ZmluZEdvb2RBbmRBZGQoZ29vZCk7XHJcblx0XHRyZWxvYWRCYXNrZXQoKTtcclxuXHR9O1xyXG5cclxuXHR0aGlzLnJlbW92ZUdvb2RGcm9tQmFza2V0ID0gaWQgPT4ge1xyXG5cdFx0ZmluZEdvb2RBbmRSZW1vdmUoaWQpO1xyXG5cdFx0cmVsb2FkQmFza2V0KCk7XHJcblx0fTtcclxufVxyXG4iXX0=
