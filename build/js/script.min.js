"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,o=new Array(t.length);n<t.length;n++)o[n]=t[n];return o}}var basket=new BasketSetting,goods=new GoodSetting,paging=new Paging,container=new ContainerClassSetting;function addContentToContainer(t,n){var o=document.querySelector(t);o&&(o.innerHTML=n)}function ContainerClassSetting(){this.findContainersAndRemoveClass=function(t,n){!function t(n,o){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<n.length)return n[e].classList.remove(o),t(n,o,e+1)}(document.querySelectorAll(t),n)}}function GoodSetting(){var t=[],n=!1,o="name";this.loadGoods=function(){fetch("https://dzadranik.github.io/goods-and-basket/src/json/goods.json").then((function(t){return t.json()})).then((function(e){!function(n){t=n,addContentToContainer(".js-good",n.map((function(t){return function(t){var n=t.id,o=t.image,e=t.title,a=t.price,i=t.descr;return'<div class="good__item js-good-item" data-good-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(o,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(e,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(a,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(i,'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button js-add-to-basket">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}(t)})).join(""))}(paging.addPagingGetItemsInPage(function(t){return n&&(t=function(t){return t.filter((function(t){return t.avaliable}))}(t)),"cost"==o?t=function(t){return t.sort((function(t,n){return t.price-n.price}))}(t):"name"==o&&(t=function(t){return t.sort((function(t,n){var o=t.title.toLowerCase(),e=n.title.toLowerCase();return o<e?-1:o<e?1:void 0}))}(t)),t}(e)))}))},this.setAvaliable=function(t){n=t,paging.setActivePage(0),this.loadGoods()},this.setSorting=function(t){o!=t&&(o=t,this.loadGoods())},this.getGoodInformation=function(n){return t.find((function(t){return t.id==n}))}}function Paging(){var t=0,n=function(n){return'<button \n\t\t\tclass="pagination__button js-pagination-button '.concat(n===t?"active":"",'" \n\t\t\tdata-p-button-number="').concat(n+1,'">\n\t\t\t\t').concat(n+1,"\n\t\t\t</button>")},o=function t(o,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o<e?t(o+1,e,a+=n(o)):a};this.setActivePage=function(n){t=n,goods.loadGoods()},this.addPagingGetItemsInPage=function(n){return addContentToContainer(".js-pagination",function(n){var e=Math.ceil(n.length/5),a="";return e>6?t<2||t>e-3?(a+=o(0,3),a+="<span class='pagination__dots'>...</span>",a+=o(e-3,e)):2==t?(a+=o(0,4),a+="<span class='pagination__dots'>...</span>",a+=o(e-1,e)):t==e-3?(a+=o(0,1),a+="<span class='pagination__dots'>...</span>",a+=o(e-4,e)):t>2&&t<e-3&&(a+=getAnyPButtons(0,1),a+=o(),a+=getAnyPButtons(t-1,t+2),a+=o(),a+=getAnyPButtons(e-1,e)):a+=o(0,e),a}(n)),function(n){var o=5*t,e=o+5;return n.slice(o,e)}(n)}}function BasketSetting(){var t=[],n=function(){addContentToContainer(".js-basket-good",t.map((function(t){return function(t){var n=t.id,o=t.image,e=t.title,a=t.count;return'<div class="basket__good-item" data-b-good-id="'.concat(n,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(o,'"/></div>\n\t\t\t<div class="basket__good-name">').concat(e,'</div>\n\t\t\t<div class="basket__good-amout">').concat(a,"</div>\n\t\t</div>")}(t)})).join(""))},o=function(){addContentToContainer(".js-count-result",t.reduce((function(t,n){return t+n.count*n.price}),0))},e=function(){localStorage.goodsInBasket=JSON.stringify(t),n(),o()};this.getLocalSorage=function(){null!=localStorage.getItem("goodsInBasket")&&(t=JSON.parse(localStorage.getItem("goodsInBasket"))),n(),o()},this.getCountGoodsInBasket=function(){addContentToContainer(".js-good-in-basket",t.reduce((function(t,n){return t+n.count}),0))},this.addGoodToBasket=function(n){!function(n){t.find((function(t){if(n.id===t.id)return t.count++,!0}))||(n.count=1,t=[].concat(_toConsumableArray(t),[n]))}(n),e()},this.removeGoodFromBasket=function(n){!function(n){var o=t.findIndex((function(t){return t.id===+n}));t.splice(o,1)}(n),e()}}goods.loadGoods(),basket.getLocalSorage(),document.addEventListener("DOMContentLoaded",(function(){var t=function(t,n,o){document.querySelector(t).addEventListener(n,(function(t){return o(t)}))};t(".js-pagination","click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&paging.setActivePage(n.dataset.pButtonNumber-1)})),t(".js-sorting-buttons","click",(function(t){var n=t.target;if(n.classList.contains("js-sorting")&&!n.classList.contains("active")){var o=n.dataset.sorting;container.findContainersAndRemoveClass(".js-sorting","active"),goods.setSorting(o),n.classList.add("active")}})),t(".js-avaliable","change",(function(t){goods.setAvaliable(t.target.checked)})),t(".js-good","click",(function(t){if(t.target.classList.contains("js-add-to-basket")){var n=t.target.closest(".js-good-item").dataset.goodId;basket.addGoodToBasket(goods.getGoodInformation(n))}})),t(".js-basket-good","click",(function(t){t.target.classList.contains("js-remove-good")&&basket.removeGoodFromBasket(t.target.parentElement.dataset.bGoodId)}))}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwiYmFza2V0IiwiQmFza2V0U2V0dGluZyIsImdvb2RzIiwiR29vZFNldHRpbmciLCJwYWdpbmciLCJQYWdpbmciLCJjb250YWluZXIiLCJDb250YWluZXJDbGFzc1NldHRpbmciLCJhZGRDb250ZW50VG9Db250YWluZXIiLCJjb250YWluZXJDbGFzcyIsImVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJ0aGlzIiwiZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcyIsImNsYXNzTmFtZSIsInJlbW92ZUNsYXNzSW5Db250YWluZXIiLCJhbGxDb250YWluZXJzIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwicXVlcnlTZWxlY3RvckFsbCIsImdvb2RzSW5QYWdlIiwiYXZhbGlhYmxlIiwic29ydGluZ1ZhbHVlIiwibG9hZEdvb2RzIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwibWFwIiwiZ29vZCIsImlkIiwiaW1hZ2UiLCJ0aXRsZSIsInByaWNlIiwiZGVzY3IiLCJjb25jYXQiLCJnZXRHb29kQ29udGVudCIsImpvaW4iLCJhZGRHb29kc1RvQ29udGFpbmVyIiwiYWRkUGFnaW5nR2V0SXRlbXNJblBhZ2UiLCJmaWx0ZXIiLCJlbGVtIiwic29ydGluZ0F2YWxpYWJsZSIsInNvcnQiLCJwcmV2IiwibmV4dCIsInNvcnRpbmdCeUNvc3QiLCJ4IiwidG9Mb3dlckNhc2UiLCJ5Iiwic29ydGluZ0J5TmFtZSIsInNvcnRpbmciLCJzZXRBdmFsaWFibGUiLCJ2YWx1ZSIsInNldEFjdGl2ZVBhZ2UiLCJzZXRTb3J0aW5nIiwiZ2V0R29vZEluZm9ybWF0aW9uIiwiZmluZCIsIml0ZW0iLCJudW1iZXJBY3RpdmVQYWdlIiwiZ2V0UEJ1dHRvbkNvbnRlbnQiLCJudW1iZXIiLCJnZXRQQnV0dG9uc051bWJlckNvbnRlbnQiLCJmaXJzdCIsImxhc3QiLCJwQnV0dG9uc0NvbnRlbnQiLCJpdGVtcyIsImFtb3VudEJ1dHRvbnMiLCJNYXRoIiwiY2VpbCIsImdldEFueVBCdXR0b25zIiwiZ2V0UEJ1dHRvbnNDb250ZW50IiwiZmlyc3RJdGVtIiwibGFzdEl0ZW0iLCJzbGljZSIsImdldEl0ZW1zSW5BY3RpdmVQYWdlIiwiZ29vZHNJbkJhc2tldCIsImFkZEdvb2RUb0NvbnRhaW5lciIsImNvdW50IiwiY291bnRUb3RhbENvc3QiLCJyZWR1Y2UiLCJzdW0iLCJyZWxvYWRCYXNrZXQiLCJsb2NhbFN0b3JhZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0TG9jYWxTb3JhZ2UiLCJnZXRJdGVtIiwicGFyc2UiLCJnZXRDb3VudEdvb2RzSW5CYXNrZXQiLCJhZGRHb29kVG9CYXNrZXQiLCJmaW5kR29vZEFuZEFkZCIsInJlbW92ZUdvb2RGcm9tQmFza2V0IiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJzcGxpY2UiLCJmaW5kR29vZEFuZFJlbW92ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVyIiwiZXZlbnROYW1lIiwiZm4iLCJldmVudCIsInRhcmdldEVsZW1lbnQiLCJ0YXJnZXQiLCJjb250YWlucyIsImRhdGFzZXQiLCJwQnV0dG9uTnVtYmVyIiwic29ydGluZ1NldHRpbmciLCJhZGQiLCJjaGVja2VkIiwiZ29vZElkIiwiY2xvc2VzdCIsInBhcmVudEVsZW1lbnQiLCJiR29vZElkIl0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLFNBQVNBLG1CQUFtQkMsR0FBTyxPQUFPQyxt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VUFBVVMsNkJBQTZCLGNBQWUsVUFDdERiLE1BQU15RCxXQUFXb0QsR0FDakJMLEVBQWNyRixVQUFVMkYsSUFBSSxjQUs5QlYsRUFBUSxnQkFBaUIsVUFBVSxTQUFBRyxHQUNsQ3ZHLE1BQU1zRCxhQUFhaUQsRUFBTUUsT0FBT00sWUFJakNYLEVBQVEsV0FBWSxTQUFTLFNBQUFHLEdBQzVCLEdBQUlBLEVBQU1FLE9BQU90RixVQUFVdUYsU0FBUyxvQkFBcUIsQ0FDeEQsSUFBSU0sRUFBU1QsRUFBTUUsT0FBT1EsUUFBUSxpQkFBaUJOLFFBQVFLLE9BQzNEbEgsT0FBTzhGLGdCQUFnQjVGLE1BQU0wRCxtQkFBbUJzRCxRQUtsRFosRUFBUSxrQkFBbUIsU0FBUyxTQUFBRyxHQUMvQkEsRUFBTUUsT0FBT3RGLFVBQVV1RixTQUFTLG1CQUNuQzVHLE9BQU9nRyxxQkFBcUJTLEVBQU1FLE9BQU9TLGNBQWNQLFFBQVFRIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJhc2tldCA9IG5ldyBCYXNrZXRTZXR0aW5nKCksXHJcblx0Z29vZHMgPSBuZXcgR29vZFNldHRpbmcoKSxcclxuXHRwYWdpbmcgPSBuZXcgUGFnaW5nKCksXHJcblx0Y29udGFpbmVyID0gbmV3IENvbnRhaW5lckNsYXNzU2V0dGluZygpXHJcblxyXG5nb29kcy5sb2FkR29vZHMoKVxyXG5iYXNrZXQuZ2V0TG9jYWxTb3JhZ2UoKVxyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG5cdGNvbnN0IGhhbmRsZXIgPSAoZWxlbWVudCwgZXZlbnROYW1lLCBmbikgPT4ge1xyXG5cdFx0Y29uc3QgZWxlbWVudENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudClcclxuXHRcdGVsZW1lbnRDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGV2ZW50ID0+IGZuKGV2ZW50KSlcclxuXHR9XHJcblxyXG5cdC8v0YHQu9GD0YjQsNC70LrQsCDQutC90L7Qv9C+0Log0L/QsNCz0LjQvdCw0YLQvtGA0LBcclxuXHRoYW5kbGVyKCcuanMtcGFnaW5hdGlvbicsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXRcclxuXHRcdGlmICh0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanMtcGFnaW5hdGlvbi1idXR0b24nKSAmJiAhdGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XHJcblx0XHRcdHBhZ2luZy5zZXRBY3RpdmVQYWdlKHRhcmdldEVsZW1lbnQuZGF0YXNldC5wQnV0dG9uTnVtYmVyIC0gMSlcclxuXHRcdH1cclxuXHR9KVxyXG5cclxuXHQvLyDRgdC70YPRiNCw0LvQutCwINGB0L7RgNGC0LjRgNC+0LLQvtC6XHJcblx0aGFuZGxlcignLmpzLXNvcnRpbmctYnV0dG9ucycsICdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXRcclxuXHRcdGlmICh0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanMtc29ydGluZycpICYmICF0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuXHRcdFx0Y29uc3Qgc29ydGluZ1NldHRpbmcgPSB0YXJnZXRFbGVtZW50LmRhdGFzZXQuc29ydGluZ1xyXG5cdFx0XHRjb250YWluZXIuZmluZENvbnRhaW5lcnNBbmRSZW1vdmVDbGFzcygnLmpzLXNvcnRpbmcnLCAnYWN0aXZlJylcclxuXHRcdFx0Z29vZHMuc2V0U29ydGluZyhzb3J0aW5nU2V0dGluZylcclxuXHRcdFx0dGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKVxyXG5cdFx0fVxyXG5cdH0pXHJcblxyXG5cdC8vINGB0LvRg9GI0LDQu9C60LAg0YHQvtGA0YLQuNGA0L7QstC60Lgg0L/QviDQvdCw0LvQuNGH0LjRjlxyXG5cdGhhbmRsZXIoJy5qcy1hdmFsaWFibGUnLCAnY2hhbmdlJywgZXZlbnQgPT4ge1xyXG5cdFx0Z29vZHMuc2V0QXZhbGlhYmxlKGV2ZW50LnRhcmdldC5jaGVja2VkKVxyXG5cdH0pXHJcblxyXG5cdC8vINC60L3QvtC/0LrQsCDQtNC+0LHQsNCy0LjRgtGMINCyINC60L7RgNC30LjQvdGDXHJcblx0aGFuZGxlcignLmpzLWdvb2QnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtYWRkLXRvLWJhc2tldCcpKSB7XHJcblx0XHRcdGxldCBnb29kSWQgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmpzLWdvb2QtaXRlbScpLmRhdGFzZXQuZ29vZElkXHJcblx0XHRcdGJhc2tldC5hZGRHb29kVG9CYXNrZXQoZ29vZHMuZ2V0R29vZEluZm9ybWF0aW9uKGdvb2RJZCkpXHJcblx0XHR9XHJcblx0fSlcclxuXHJcblx0Ly8g0LrQvdC+0L/QutCwINGD0LTQsNC70LjRgtGMINC40Lcg0LrQvtGA0LfQuNC90YtcclxuXHRoYW5kbGVyKCcuanMtYmFza2V0LWdvb2QnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtcmVtb3ZlLWdvb2QnKSkge1xyXG5cdFx0XHRiYXNrZXQucmVtb3ZlR29vZEZyb21CYXNrZXQoZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuZGF0YXNldC5iR29vZElkKVxyXG5cdFx0fVxyXG5cdH0pXHJcbn0pXHJcblxyXG4vL9CU0L7QsdCw0LLQu9C10L3QuNC1INGN0LvQtdC80LXQvdGC0L7QsiDQsiDQutC+0L3RgtC10LnQvdC10YBcclxuZnVuY3Rpb24gYWRkQ29udGVudFRvQ29udGFpbmVyKGNvbnRhaW5lckNsYXNzLCBlbGVtZW50KSB7XHJcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJDbGFzcylcclxuXHRpZiAoY29udGFpbmVyKSBjb250YWluZXIuaW5uZXJIVE1MID0gZWxlbWVudFxyXG59XHJcblxyXG4vL9GD0LTQsNC70LjRgtGMINC60LvQsNGB0YEg0YMg0LPRgNGD0L/Qv9GLINC60L7QvdGC0LXQudC90LXRgNC+0LJcclxuZnVuY3Rpb24gQ29udGFpbmVyQ2xhc3NTZXR0aW5nKCkge1xyXG5cdGNvbnN0IHJlbW92ZUNsYXNzSW5Db250YWluZXIgPSAoYWxsQ29udGFpbmVycywgY2xhc3NOYW1lLCBpID0gMCkgPT4ge1xyXG5cdFx0aWYgKGkgPCBhbGxDb250YWluZXJzLmxlbmd0aCkge1xyXG5cdFx0XHRhbGxDb250YWluZXJzW2ldLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKVxyXG5cdFx0XHRyZXR1cm4gcmVtb3ZlQ2xhc3NJbkNvbnRhaW5lcihhbGxDb250YWluZXJzLCBjbGFzc05hbWUsIGkgKyAxKVxyXG5cdFx0fVxyXG5cdH1cclxuXHR0aGlzLmZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbihjb250YWluZXJDbGFzcywgY2xhc3NOYW1lKSB7XHJcblx0XHRsZXQgYWxsQ29udGFpbmVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29udGFpbmVyQ2xhc3MpXHJcblx0XHRyZW1vdmVDbGFzc0luQ29udGFpbmVyKGFsbENvbnRhaW5lcnMsIGNsYXNzTmFtZSlcclxuXHR9XHJcbn1cclxuXHJcbi8vINGC0L7QstCw0YDRi1xyXG5mdW5jdGlvbiBHb29kU2V0dGluZygpIHtcclxuXHRsZXQgZ29vZHNJblBhZ2UgPSBbXSxcclxuXHRcdGF2YWxpYWJsZSA9IGZhbHNlLFxyXG5cdFx0c29ydGluZ1ZhbHVlID0gJ25hbWUnXHJcblxyXG5cdGNvbnN0IHNvcnRpbmdBdmFsaWFibGUgPSBnb29kcyA9PiB7XHJcblx0XHRyZXR1cm4gZ29vZHMuZmlsdGVyKGVsZW0gPT4gZWxlbS5hdmFsaWFibGUpXHJcblx0fVxyXG5cclxuXHRjb25zdCBzb3J0aW5nQnlDb3N0ID0gZ29vZHMgPT4ge1xyXG5cdFx0cmV0dXJuIGdvb2RzLnNvcnQoKHByZXYsIG5leHQpID0+IHByZXYucHJpY2UgLSBuZXh0LnByaWNlKVxyXG5cdH1cclxuXHJcblx0Y29uc3Qgc29ydGluZ0J5TmFtZSA9IGdvb2RzID0+IHtcclxuXHRcdHJldHVybiBnb29kcy5zb3J0KChwcmV2LCBuZXh0KSA9PiB7XHJcblx0XHRcdGNvbnN0IHggPSBwcmV2LnRpdGxlLnRvTG93ZXJDYXNlKClcclxuXHRcdFx0Y29uc3QgeSA9IG5leHQudGl0bGUudG9Mb3dlckNhc2UoKVxyXG5cdFx0XHRpZiAoeCA8IHkpIHJldHVybiAtMVxyXG5cdFx0XHRpZiAoeCA8IHkpIHJldHVybiAxXHJcblx0XHR9KVxyXG5cdH1cclxuXHJcblx0Y29uc3Qgc29ydGluZyA9IGdvb2RzID0+IHtcclxuXHRcdGlmIChhdmFsaWFibGUpIGdvb2RzID0gc29ydGluZ0F2YWxpYWJsZShnb29kcylcclxuXHJcblx0XHRpZiAoc29ydGluZ1ZhbHVlID09ICdjb3N0JykgZ29vZHMgPSBzb3J0aW5nQnlDb3N0KGdvb2RzKVxyXG5cdFx0ZWxzZSBpZiAoc29ydGluZ1ZhbHVlID09ICduYW1lJykgZ29vZHMgPSBzb3J0aW5nQnlOYW1lKGdvb2RzKVxyXG5cdFx0cmV0dXJuIGdvb2RzXHJcblx0fVxyXG5cclxuXHRjb25zdCBnZXRHb29kQ29udGVudCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IHsgaWQsIGltYWdlLCB0aXRsZSwgcHJpY2UsIGRlc2NyIH0gPSBnb29kXHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJnb29kX19pdGVtIGpzLWdvb2QtaXRlbVwiIGRhdGEtZ29vZC1pZD0ke2lkfT5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIi8+PC9kaXY+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9faW5mb3JtYXRpb25cIj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3RpdGxlXCI+JHt0aXRsZX08L2Rpdj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3ByaWNlXCI+JHtwcmljZX0g0YDRg9CxPC9kaXY+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19kZXNjcmlwdGlvblwiPiR7ZGVzY3J9PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX190cmFuc2FjdGlvblwiPlxyXG5cdFx0XHRcdFx0XHQ8YnV0dG9uIGNsYXNzPVwiZ29vZF9fYnV0dG9uIGpzLWFkZC10by1iYXNrZXRcIj7QlNC+0LHQsNCy0LjRgtGMINCyINC60L7RgNC30LjQvdGDPC9idXR0b24+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19iYXNrZXQtZmVlZGJhY2sganMtZ29vZC1pbi1iYXNrZXRcIj48L2Rpdj5cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdDwvZGl2PmBcclxuXHR9XHJcblxyXG5cdGNvbnN0IGFkZEdvb2RzVG9Db250YWluZXIgPSBnb29kcyA9PiB7XHJcblx0XHRnb29kc0luUGFnZSA9IGdvb2RzXHJcblx0XHRjb25zdCBnb29kc0NvbnRlbnQgPSBnb29kcy5tYXAoZ29vZCA9PiBnZXRHb29kQ29udGVudChnb29kKSkuam9pbignJylcclxuXHRcdGFkZENvbnRlbnRUb0NvbnRhaW5lcignLmpzLWdvb2QnLCBnb29kc0NvbnRlbnQpXHJcblx0fVxyXG5cclxuXHR0aGlzLmxvYWRHb29kcyA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0ZmV0Y2goJ2h0dHBzOi8vZHphZHJhbmlrLmdpdGh1Yi5pby9nb29kcy1hbmQtYmFza2V0L3NyYy9qc29uL2dvb2RzLmpzb24nKVxyXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcblx0XHRcdC50aGVuKGdvb2RzID0+IHtcclxuXHRcdFx0XHRhZGRHb29kc1RvQ29udGFpbmVyKHBhZ2luZy5hZGRQYWdpbmdHZXRJdGVtc0luUGFnZShzb3J0aW5nKGdvb2RzKSkpXHJcblx0XHRcdH0pXHJcblx0fVxyXG5cclxuXHR0aGlzLnNldEF2YWxpYWJsZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRhdmFsaWFibGUgPSB2YWx1ZVxyXG5cdFx0cGFnaW5nLnNldEFjdGl2ZVBhZ2UoMClcclxuXHRcdHRoaXMubG9hZEdvb2RzKClcclxuXHR9XHJcblxyXG5cdHRoaXMuc2V0U29ydGluZyA9IGZ1bmN0aW9uKHZhbHVlKSB7XHJcblx0XHRpZiAoc29ydGluZ1ZhbHVlICE9IHZhbHVlKSB7XHJcblx0XHRcdHNvcnRpbmdWYWx1ZSA9IHZhbHVlXHJcblx0XHRcdHRoaXMubG9hZEdvb2RzKClcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHRoaXMuZ2V0R29vZEluZm9ybWF0aW9uID0gZnVuY3Rpb24oaWQpIHtcclxuXHRcdHJldHVybiBnb29kc0luUGFnZS5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PSBpZClcclxuXHR9XHJcbn1cclxuXHJcbi8v0L/QsNCz0LjQvdCw0YbQuNGPXHJcbmZ1bmN0aW9uIFBhZ2luZygpIHtcclxuXHRjb25zdCBhbW91bnRQYWdlSXRlbXMgPSA1IC8vINC60L7Qu9C40YfQtdGB0YLQstC+INGN0LvQtdC80LXQvdGC0L7QsiDQvdCwINGB0YLRgNCw0L3QuNGG0LVcclxuXHRsZXQgbnVtYmVyQWN0aXZlUGFnZSA9IDAgLy8g0LDQutGC0LjQstC90LDRjyDRgdGC0YDQsNC90LjRhtCwXHJcblxyXG5cdGNvbnN0IGdldFBCdXR0b25Db250ZW50ID0gbnVtYmVyID0+IHtcclxuXHRcdHJldHVybiBgPGJ1dHRvbiBcclxuXHRcdFx0Y2xhc3M9XCJwYWdpbmF0aW9uX19idXR0b24ganMtcGFnaW5hdGlvbi1idXR0b24gJHtudW1iZXIgPT09IG51bWJlckFjdGl2ZVBhZ2UgPyAnYWN0aXZlJyA6ICcnfVwiIFxyXG5cdFx0XHRkYXRhLXAtYnV0dG9uLW51bWJlcj1cIiR7bnVtYmVyICsgMX1cIj5cclxuXHRcdFx0XHQke251bWJlciArIDF9XHJcblx0XHRcdDwvYnV0dG9uPmBcclxuXHR9XHJcblxyXG5cdGNvbnN0IGdldFBEb3RzQ29udGVudCA9ICgpID0+IHtcclxuXHRcdHJldHVybiBgPHNwYW4gY2xhc3M9J3BhZ2luYXRpb25fX2RvdHMnPi4uLjwvc3Bhbj5gXHJcblx0fVxyXG5cclxuXHRjb25zdCBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQgPSAoZmlyc3QsIGxhc3QsIHBCdXR0b25zQ29udGVudCA9ICcnKSA9PiB7XHJcblx0XHRpZiAoZmlyc3QgPCBsYXN0KSB7XHJcblx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uQ29udGVudChmaXJzdClcclxuXHRcdFx0cmV0dXJuIGdldFBCdXR0b25zTnVtYmVyQ29udGVudChmaXJzdCArIDEsIGxhc3QsIHBCdXR0b25zQ29udGVudClcclxuXHRcdH1cclxuXHRcdHJldHVybiBwQnV0dG9uc0NvbnRlbnRcclxuXHR9XHJcblxyXG5cdGNvbnN0IGdldFBCdXR0b25zQ29udGVudCA9IGl0ZW1zID0+IHtcclxuXHRcdGxldCBhbW91bnRCdXR0b25zID0gTWF0aC5jZWlsKGl0ZW1zLmxlbmd0aCAvIGFtb3VudFBhZ2VJdGVtcyksIC8vINC60L7Qu9C40YfQtdGB0YLQstC+INGB0YLRgNCw0L3QuNGGXHJcblx0XHRcdHBCdXR0b25zQ29udGVudCA9ICcnIC8vINGA0LDQt9C80LXRgtC60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGG0LjQuFxyXG5cclxuXHRcdGlmIChhbW91bnRCdXR0b25zID4gNikge1xyXG5cdFx0XHRpZiAobnVtYmVyQWN0aXZlUGFnZSA8IDIgfHwgbnVtYmVyQWN0aXZlUGFnZSA+IGFtb3VudEJ1dHRvbnMgLSAzKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCAzKVxyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQRG90c0NvbnRlbnQoKVxyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDMsIGFtb3VudEJ1dHRvbnMpXHJcblx0XHRcdH0gZWxzZSBpZiAobnVtYmVyQWN0aXZlUGFnZSA9PSAyKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCA0KVxyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQRG90c0NvbnRlbnQoKVxyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDEsIGFtb3VudEJ1dHRvbnMpXHJcblx0XHRcdH0gZWxzZSBpZiAobnVtYmVyQWN0aXZlUGFnZSA9PSBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMSlcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UERvdHNDb250ZW50KClcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KGFtb3VudEJ1dHRvbnMgLSA0LCBhbW91bnRCdXR0b25zKVxyXG5cdFx0XHR9IGVsc2UgaWYgKG51bWJlckFjdGl2ZVBhZ2UgPiAyICYmIG51bWJlckFjdGl2ZVBhZ2UgPCBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRBbnlQQnV0dG9ucygwLCAxKVxyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRQQnV0dG9uc051bWJlckNvbnRlbnQoKVxyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSBnZXRBbnlQQnV0dG9ucyhudW1iZXJBY3RpdmVQYWdlIC0gMSwgbnVtYmVyQWN0aXZlUGFnZSArIDIpXHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldFBCdXR0b25zTnVtYmVyQ29udGVudCgpXHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IGdldEFueVBCdXR0b25zKGFtb3VudEJ1dHRvbnMgLSAxLCBhbW91bnRCdXR0b25zKVxyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gZ2V0UEJ1dHRvbnNOdW1iZXJDb250ZW50KDAsIGFtb3VudEJ1dHRvbnMpXHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcEJ1dHRvbnNDb250ZW50XHJcblx0fVxyXG5cclxuXHRjb25zdCBnZXRJdGVtc0luQWN0aXZlUGFnZSA9IGl0ZW1zID0+IHtcclxuXHRcdGNvbnN0IGZpcnN0SXRlbSA9IG51bWJlckFjdGl2ZVBhZ2UgKiBhbW91bnRQYWdlSXRlbXMsXHJcblx0XHRcdGxhc3RJdGVtID0gZmlyc3RJdGVtICsgYW1vdW50UGFnZUl0ZW1zXHJcblx0XHRyZXR1cm4gaXRlbXMuc2xpY2UoZmlyc3RJdGVtLCBsYXN0SXRlbSlcclxuXHR9XHJcblxyXG5cdHRoaXMuc2V0QWN0aXZlUGFnZSA9IGZ1bmN0aW9uKG51bWJlcikge1xyXG5cdFx0bnVtYmVyQWN0aXZlUGFnZSA9IG51bWJlclxyXG5cdFx0Z29vZHMubG9hZEdvb2RzKClcclxuXHR9XHJcblxyXG5cdHRoaXMuYWRkUGFnaW5nR2V0SXRlbXNJblBhZ2UgPSBmdW5jdGlvbihpdGVtcykge1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtcGFnaW5hdGlvbicsIGdldFBCdXR0b25zQ29udGVudChpdGVtcykpXHJcblx0XHRyZXR1cm4gZ2V0SXRlbXNJbkFjdGl2ZVBhZ2UoaXRlbXMpXHJcblx0fVxyXG59XHJcblxyXG4vL9C60L7RgNC30LjQvdCwXHJcbmZ1bmN0aW9uIEJhc2tldFNldHRpbmcoKSB7XHJcblx0bGV0IGdvb2RzSW5CYXNrZXQgPSBbXVxyXG5cclxuXHRjb25zdCBnZXRHb29kQ29udGVudCA9IGdvb2QgPT4ge1xyXG5cdFx0bGV0IHsgaWQsIGltYWdlLCB0aXRsZSwgY291bnQgfSA9IGdvb2RcclxuXHRcdHJldHVybiBgPGRpdiBjbGFzcz1cImJhc2tldF9fZ29vZC1pdGVtXCIgZGF0YS1iLWdvb2QtaWQ9XCIke2lkfVwiPlxyXG5cdFx0XHQ8YnV0dG9uIGNsYXNzPVwiYmFza2V0X19nb29kLXJlbW92ZSBqcy1yZW1vdmUtZ29vZFwiPiYjMTI4OTM4OzwvYnV0dG9uPlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWltYWdlXCI+PGltZyBzcmM9XCIke2ltYWdlfVwiLz48L2Rpdj5cclxuXHRcdFx0PGRpdiBjbGFzcz1cImJhc2tldF9fZ29vZC1uYW1lXCI+JHt0aXRsZX08L2Rpdj5cclxuXHRcdFx0PGRpdiBjbGFzcz1cImJhc2tldF9fZ29vZC1hbW91dFwiPiR7Y291bnR9PC9kaXY+XHJcblx0XHQ8L2Rpdj5gXHJcblx0fVxyXG5cclxuXHRjb25zdCBhZGRHb29kVG9Db250YWluZXIgPSAoKSA9PiB7XHJcblx0XHRsZXQgZ29vZHNDb250ZW50ID0gZ29vZHNJbkJhc2tldC5tYXAoZ29vZCA9PiBnZXRHb29kQ29udGVudChnb29kKSkuam9pbignJylcclxuXHRcdGFkZENvbnRlbnRUb0NvbnRhaW5lcignLmpzLWJhc2tldC1nb29kJywgZ29vZHNDb250ZW50KVxyXG5cdH1cclxuXHJcblx0Y29uc3QgZmluZEdvb2RBbmRSZW1vdmUgPSBpZCA9PiB7XHJcblx0XHRsZXQgaW5kZXggPSBnb29kc0luQmFza2V0LmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaWQgPT09ICtpZClcclxuXHRcdGdvb2RzSW5CYXNrZXQuc3BsaWNlKGluZGV4LCAxKVxyXG5cdH1cclxuXHJcblx0Y29uc3QgZmluZEdvb2RBbmRBZGQgPSBnb29kID0+IHtcclxuXHRcdGlmIChcclxuXHRcdFx0IWdvb2RzSW5CYXNrZXQuZmluZChpdGVtID0+IHtcclxuXHRcdFx0XHRpZiAoZ29vZC5pZCA9PT0gaXRlbS5pZCkge1xyXG5cdFx0XHRcdFx0aXRlbS5jb3VudCsrXHJcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSlcclxuXHRcdCkge1xyXG5cdFx0XHRnb29kLmNvdW50ID0gMVxyXG5cdFx0XHRnb29kc0luQmFza2V0ID0gWy4uLmdvb2RzSW5CYXNrZXQsIGdvb2RdXHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRjb25zdCBjb3VudFRvdGFsQ29zdCA9ICgpID0+IHtcclxuXHRcdGxldCB0b3RhbENvc3QgPSBnb29kc0luQmFza2V0LnJlZHVjZShmdW5jdGlvbihzdW0sIGl0ZW0pIHtcclxuXHRcdFx0cmV0dXJuIHN1bSArIGl0ZW0uY291bnQgKiBpdGVtLnByaWNlXHJcblx0XHR9LCAwKVxyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKCcuanMtY291bnQtcmVzdWx0JywgdG90YWxDb3N0KVxyXG5cdH1cclxuXHJcblx0Y29uc3Qgc2F2ZVRvTG9jYWxTdG9yYWdlID0gKCkgPT4ge1xyXG5cdFx0bG9jYWxTdG9yYWdlLmdvb2RzSW5CYXNrZXQgPSBKU09OLnN0cmluZ2lmeShnb29kc0luQmFza2V0KVxyXG5cdH1cclxuXHJcblx0Y29uc3QgY291bnRHb29kc0luQmFza2V0ID0gKCkgPT4ge1xyXG5cdFx0cmV0dXJuIGdvb2RzSW5CYXNrZXQucmVkdWNlKGZ1bmN0aW9uKHN1bSwgaXRlbSkge1xyXG5cdFx0XHRyZXR1cm4gc3VtICsgaXRlbS5jb3VudFxyXG5cdFx0fSwgMClcclxuXHR9XHJcblxyXG5cdGNvbnN0IHJlbG9hZEJhc2tldCA9ICgpID0+IHtcclxuXHRcdHNhdmVUb0xvY2FsU3RvcmFnZSgpXHJcblx0XHRhZGRHb29kVG9Db250YWluZXIoKVxyXG5cdFx0Y291bnRUb3RhbENvc3QoKVxyXG5cdH1cclxuXHJcblx0dGhpcy5nZXRMb2NhbFNvcmFnZSA9IGZ1bmN0aW9uKCkge1xyXG5cdFx0aWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29kc0luQmFza2V0JykgIT0gbnVsbClcclxuXHRcdFx0Z29vZHNJbkJhc2tldCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2RzSW5CYXNrZXQnKSlcclxuXHRcdGFkZEdvb2RUb0NvbnRhaW5lcigpXHJcblx0XHRjb3VudFRvdGFsQ29zdCgpXHJcblx0fVxyXG5cclxuXHR0aGlzLmdldENvdW50R29vZHNJbkJhc2tldCA9ICgpID0+IHtcclxuXHRcdGFkZENvbnRlbnRUb0NvbnRhaW5lcignLmpzLWdvb2QtaW4tYmFza2V0JywgY291bnRHb29kc0luQmFza2V0KCkpXHJcblx0fVxyXG5cclxuXHR0aGlzLmFkZEdvb2RUb0Jhc2tldCA9IGdvb2QgPT4ge1xyXG5cdFx0ZmluZEdvb2RBbmRBZGQoZ29vZClcclxuXHRcdHJlbG9hZEJhc2tldCgpXHJcblx0fVxyXG5cclxuXHR0aGlzLnJlbW92ZUdvb2RGcm9tQmFza2V0ID0gaWQgPT4ge1xyXG5cdFx0ZmluZEdvb2RBbmRSZW1vdmUoaWQpXHJcblx0XHRyZWxvYWRCYXNrZXQoKVxyXG5cdH1cclxufVxyXG4iXX0=
