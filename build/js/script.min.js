"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),t}var Goods=function(){function t(n){_classCallCheck(this,t),this._linkToJson=n,this._goodsInPage=[],this._avaliable=!1,this._sortingValue="name"}return _createClass(t,[{key:"_sortingAvaliable",value:function(t){return t.filter((function(t){return t.avaliable}))}},{key:"_sortingByCost",value:function(t){return t.sort((function(t,n){return t.price-n.price}))}},{key:"_sortingByName",value:function(t){return t.sort((function(t,n){var e=t.title.toLowerCase(),o=n.title.toLowerCase();return e<o?-1:e<o?1:void 0}))}},{key:"_sorting",value:function(t){return this._avaliable&&(t=this._sortingAvaliable(t)),"cost"==this._sortingValue?t=this._sortingByCost(t):"name"==this._sortingValue&&(t=this._sortingByName(t)),t}},{key:"_truncate",value:function(t,n){if(t.length>n){var e=t.lastIndexOf(" ",n);return"".concat(t.slice(0,e)," ...")}return t}},{key:"_getGoodContent",value:function(t){var n=t.id,e=t.image,o=t.title,a=t.price,s=t.descr;return'<div class="good__item js-good-item" data-good-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(e,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(o,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(a,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(this._truncate(s,65),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button js-add-to-basket">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}},{key:"_addGoodsToContainer",value:function(t){var n=this;this._goodsInPage=t,addContentToContainer(t.map((function(t){return n._getGoodContent(t)})).join(""),".js-good")}},{key:"loadGoods",value:function(){var t=this;fetch(this._linkToJson).then((function(t){return t.json()})).then((function(n){t._addGoodsToContainer(goodsPaging.addPagingGetItemsInPage(t._sorting(n)))}))}},{key:"setAvaliable",value:function(t){this._avaliable=t,this.loadGoods()}},{key:"setSorting",value:function(t){this._sortingValue!=t&&(this._sortingValue=t,this.loadGoods())}},{key:"getGoodInformation",value:function(t){return this._goodsInPage.find((function(n){return n.id==t}))}}]),t}(),Basket=function(){function t(){_classCallCheck(this,t),this._goodsInBasket=null!=localStorage.getItem("goodsInBasket")?JSON.parse(localStorage.getItem("goodsInBasket")):[]}return _createClass(t,[{key:"_getGoodContent",value:function(t){var n=t.id,e=t.image,o=t.title,a=t.count;return'<div class="basket__good-item" data-b-good-id="'.concat(n,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(e,'"/></div>\n\t\t\t<div class="basket__good-name">').concat(o,'</div>\n\t\t\t<div class="basket__good-amout">').concat(a,"</div>\n\t\t</div>")}},{key:"_addGoodsToContainer",value:function(){var t=this;addContentToContainer(this._goodsInBasket.map((function(n){return t._getGoodContent(n)})).join(""),".js-basket-good")}},{key:"_findGoodAndRemove",value:function(t){var n=this._goodsInBasket.findIndex((function(n){return n.id===+t}));return this._goodsInBasket.splice(n,1)}},{key:"_findGoodAndAdd",value:function(t){var n=this._goodsInBasket.find((function(n){return n.id===t.id}));n?n.count++:(t.count=1,this._goodsInBasket=[].concat(_toConsumableArray(this._goodsInBasket),[t]))}},{key:"_addTotalCost",value:function(){addContentToContainer(this._goodsInBasket.reduce((function(t,n){return t+n.count*n.price}),0),".js-count-result")}},{key:"_saveToLocalStorage",value:function(){localStorage.goodsInBasket=JSON.stringify(this._goodsInBasket)}},{key:"_countGoodsInBasket",value:function(){return this._goodsInBasket.reduce((function(t,n){return t+n.count}),0)}},{key:"addCountGoodsInBasket",value:function(){addContentToContainer(this._countGoodsInBasket(),".js-good-in-basket")}},{key:"addGoodToBasket",value:function(t){this._findGoodAndAdd(t),this._saveToLocalStorage(),this.reloadBasket()}},{key:"removeGoodFromBasket",value:function(t){this._findGoodAndRemove(t),this._saveToLocalStorage(),this.reloadBasket()}},{key:"reloadBasket",value:function(){this._addGoodsToContainer(),this._addTotalCost()}}]),t}(),Paging=function(){function t(n,e){_classCallCheck(this,t),this._container=e,this._amountPageItems=n,this._activePage=0}return _createClass(t,[{key:"_getPButtonContent",value:function(t){return'<button \n\t\t\t\t\tclass="pagination__button js-pagination-button \n\t\t\t\t\t'.concat(t===this._activePage?"active":"",'" \n\t\t\t\t\tdata-p-button-number="').concat(t+1,'">\n\t\t\t\t\t\t').concat(t+1,"\n\t\t\t\t</button>")}},{key:"_getPDotsContent",value:function(){return"<span class='pagination__dots'>...</span>"}},{key:"_getPButtonsNumberContent",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return t<n?(e+=this._getPButtonContent(t),this._getPButtonsNumberContent(t+1,n,e)):e}},{key:"_getPButtonsContent",value:function(t){var n=Math.ceil(t.length/this._amountPageItems),e="";return n>6?this._activePage<2||this._activePage>n-3?(e+=this._getPButtonsNumberContent(0,3),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-3,n)):2==this._activePage?(e+=this._getPButtonsNumberContent(0,4),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-1,n)):this._activePage==n-3?(e+=this._getPButtonsNumberContent(0,1),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-4,n)):this._activePage>2&&this._activePage<n-3&&(e+=this._getPButtonsNumberContent(0,1),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(this._activePage-1,this._activePage+2),e+=this._getPDotsContent(),e+=this._getPButtonsNumberContent(n-1,n)):e+=this._getPButtonsNumberContent(0,n),e}},{key:"_getItemsInActivePage",value:function(t){var n=this._activePage*this._amountPageItems,e=n+this._amountPageItems;return t.slice(n,e)}},{key:"setActivePage",value:function(t){this._activePage=t}},{key:"addPagingGetItemsInPage",value:function(t){return addContentToContainer(this._getPButtonsContent(t),this._container),this._getItemsInActivePage(t)}}]),t}();function addContentToContainer(t,n){var e=document.querySelector(n);e&&(e.innerHTML=t)}function findContainersAndRemoveClass(t,n){var e=document.querySelectorAll(t);!function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(o<e.length)return e[o].classList.remove(n),t(o+1)}()}document.addEventListener("DOMContentLoaded",(function(){var t=function(t,n,e){document.querySelector(t).addEventListener(n,(function(t){return e(t)}))};t(".js-pagination","click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&(goodsPaging.setActivePage(n.dataset.pButtonNumber-1),goods.loadGoods())})),t(".js-sorting-buttons","click",(function(t){var n=t.target;if(n.classList.contains("js-sorting")&&!n.classList.contains("active")){var e=n.dataset.sorting;findContainersAndRemoveClass(".js-sorting","active"),goods.setSorting(e),n.classList.add("active")}})),t(".js-avaliable","change",(function(t){goodsPaging.setActivePage(0),goods.setAvaliable(t.target.checked)})),t(".js-good","click",(function(t){if(t.target.classList.contains("js-add-to-basket")){var n=t.target.closest(".js-good-item").dataset.goodId;basket.addGoodToBasket(goods.getGoodInformation(n))}})),t(".js-basket-good","click",(function(t){t.target.classList.contains("js-remove-good")&&basket.removeGoodFromBasket(t.target.parentElement.dataset.bGoodId)}))}));var basket=new Basket,goods=new Goods("https://dzadranik.github.io/goods-and-basket/src/json/goods.json"),goodsPaging=new Paging(5,".js-pagination");goods.loadGoods(),basket.reloadBasket();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIl9kZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJfY3JlYXRlQ2xhc3MiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJHb29kcyIsImxpbmtUb0pzb24iLCJ0aGlzIiwiX2xpbmtUb0pzb24iLCJfZ29vZHNJblBhZ2UiLCJfYXZhbGlhYmxlIiwiX3NvcnRpbmdWYWx1ZSIsInZhbHVlIiwiZ29vZHMiLCJmaWx0ZXIiLCJlbGVtIiwiYXZhbGlhYmxlIiwic29ydCIsInByZXYiLCJuZXh0IiwicHJpY2UiLCJ4IiwidGl0bGUiLCJ0b0xvd2VyQ2FzZSIsInkiLCJfc29ydGluZ0F2YWxpYWJsZSIsIl9zb3J0aW5nQnlDb3N0IiwiX3NvcnRpbmdCeU5hbWUiLCJkZXNjciIsIm1heExlbmd0aCIsImdhcCIsImxhc3RJbmRleE9mIiwiY29uY2F0Iiwic2xpY2UiLCJnb29kIiwiaWQiLCJpbWFnZSIsIl90cnVuY2F0ZSIsIl90aGlzIiwiYWRkQ29udGVudFRvQ29udGFpbmVyIiwibWFwIiwiX2dldEdvb2RDb250ZW50Iiwiam9pbiIsIl90aGlzMiIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwianNvbiIsIl9hZGRHb29kc1RvQ29udGFpbmVyIiwiZ29vZHNQYWdpbmciLCJhZGRQYWdpbmdHZXRJdGVtc0luUGFnZSIsIl9zb3J0aW5nIiwibG9hZEdvb2RzIiwiZmluZCIsIml0ZW0iLCJCYXNrZXQiLCJfZ29vZHNJbkJhc2tldCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJjb3VudCIsIl90aGlzMyIsImdvb2RJbmRleCIsImZpbmRJbmRleCIsInNwbGljZSIsImdvb2RJbkJhc2tldCIsInJlZHVjZSIsInN1bSIsImdvb2RzSW5CYXNrZXQiLCJzdHJpbmdpZnkiLCJfY291bnRHb29kc0luQmFza2V0IiwiX2ZpbmRHb29kQW5kQWRkIiwiX3NhdmVUb0xvY2FsU3RvcmFnZSIsInJlbG9hZEJhc2tldCIsIl9maW5kR29vZEFuZFJlbW92ZSIsIl9hZGRUb3RhbENvc3QiLCJQYWdpbmciLCJhbW91bnRQYWdlSXRlbXMiLCJjb250YWluZXIiLCJfY29udGFpbmVyIiwiX2Ftb3VudFBhZ2VJdGVtcyIsIl9hY3RpdmVQYWdlIiwibnVtYmVyIiwiZmlyc3QiLCJsYXN0IiwicEJ1dHRvbnNDb250ZW50IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiX2dldFBCdXR0b25Db250ZW50IiwiX2dldFBCdXR0b25zTnVtYmVyQ29udGVudCIsIml0ZW1zIiwiYW1vdW50QnV0dG9ucyIsIk1hdGgiLCJjZWlsIiwiX2dldFBEb3RzQ29udGVudCIsImZpcnN0SXRlbSIsImxhc3RJdGVtIiwiX2dldFBCdXR0b25zQ29udGVudCIsIl9nZXRJdGVtc0luQWN0aXZlUGFnZSIsImNvbnRlbnQiLCJjb250YWluZXJDbGFzcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MiLCJjbGFzc05hbWUiLCJhbGxDb250YWluZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbW92ZUNsYXNzSW5Db250YWluZXIiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlciIsImVsZW1lbnQiLCJldmVudE5hbWUiLCJmbiIsImV2ZW50IiwidGFyZ2V0RWxlbWVudCIsImNvbnRhaW5zIiwic2V0QWN0aXZlUGFnZSIsImRhdGFzZXQiLCJwQnV0dG9uTnVtYmVyIiwic29ydGluZ1NldHRpbmciLCJzb3J0aW5nIiwic2V0U29ydGluZyIsImFkZCIsInNldEF2YWxpYWJsZSIsImNoZWNrZWQiLCJnb29kSWQiLCJjbG9zZXN0IiwiYmFza2V0IiwiYWRkR29vZFRvQmFza2V0IiwiZ2V0R29vZEluZm9ybWF0aW9uIiwicmVtb3ZlR29vZEZyb21CYXNrZXQiLCJwYXJlbnRFbGVtZW50IiwiYkdvb2RJZCJdLCJtYXBwaW5ncyI6IkFBQUEsYUFFQSxTQUFTQSxtQkFBbUJDLEdBQU8sT0FBT0MsbUJBQW1CRCxJQUFRRSxpQkFBaUJGLElBQVFHLHFCQUU5RixTQUFTQSxxQkFBdUIsTUFBTSxJQUFJQyxVQUFVLG1EQUVwRCxTQUFTRixpQkFBaUJHLEdBQVEsR0FBSUMsT0FBT0MsWUFBWUMsT0FBT0gsSUFBa0QsdUJBQXpDRyxPQUFPQyxVQUFVQyxTQUFTQyxLQUFLTixHQUFnQyxPQUFPTyxNQUFNQyxLQUFLUixHQUUxSixTQUFTSixtQkFBbUJELEdBQU8sR0FBSVksTUFBTUUsUUFBUWQsR0FBTSxDQUFFLElBQUssSUFBSWUsRUFBSSxFQUFHQyxFQUFPLElBQUlKLE1BQU1aLEVBQUlpQixRQUFTRixFQUFJZixFQUFJaUIsT0FBUUYsSUFBT0MsRUFBS0QsR0FBS2YsRUFBSWUsR0FBTSxPQUFPQyxHQUU3SixTQUFTRSxnQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsYUFBb0JDLEdBQWdCLE1BQU0sSUFBSWhCLFVBQVUscUNBRWhILFNBQVNpQixrQkFBa0JDLEVBQVFDLEdBQVMsSUFBSyxJQUFJUixFQUFJLEVBQUdBLEVBQUlRLEVBQU1OLE9BQVFGLElBQUssQ0FBRSxJQUFJUyxFQUFhRCxFQUFNUixHQUFJUyxFQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxVQUFXRixJQUFZQSxFQUFXRyxVQUFXLEdBQU1uQixPQUFPb0IsZUFBZU4sRUFBUUUsRUFBV0ssSUFBS0wsSUFFN1MsU0FBU00sYUFBYVYsRUFBYVcsRUFBWUMsR0FBbUosT0FBaElELEdBQVlWLGtCQUFrQkQsRUFBWVgsVUFBV3NCLEdBQWlCQyxHQUFhWCxrQkFBa0JELEVBQWFZLEdBQXFCWixFQUd6TSxJQWhCTWEsTUFnQm1CLFdBZnhCLFNBQUFBLEVBQVlDLEdBQVloQixnQkFBQWlCLEtBQUFGLEdBQ3ZCRSxLQUFLQyxZQUFjRixFQUNuQkMsS0FBS0UsYUFBZSxHQUNwQkYsS0FBS0csWUFBYSxFQUNsQkgsS0FBS0ksY0FBZ0IsT0FxSHJCLE9BaEdBVCxhQUFhRyxFQUFPLENBQUMsQ0FDbkJKLElBQUssb0JBQ0xXLE1BQU8sU0FwQlFDLEdBQ2pCLE9BQU9BLEVBQU1DLFFBQU8sU0FBQUMsR0FBSSxPQUFJQSxFQUFLQyxlQXdCOUIsQ0FDRGYsSUFBSyxpQkFDTFcsTUFBTyxTQXZCS0MsR0FDZCxPQUFPQSxFQUFNSSxNQUFLLFNBQUNDLEVBQU1DLEdBQVAsT0FBZ0JELEVBQUtFLE1BQVFELEVBQUtDLFdBMkJqRCxDQUNEbkIsSUFBSyxpQkFDTFcsTUFBTyxTQTFCS0MsR0FDZCxPQUFPQSxFQUFNSSxNQUFLLFNBQUNDLEVBQU1DLEdBQ3hCLElBQU1FLEVBQUlILEVBQUtJLE1BQU1DLGNBQ2ZDLEVBQUlMLEVBQUtHLE1BQU1DLGNBQ3JCLE9BQUlGLEVBQUlHLEdBQVcsRUFDZkgsRUFBSUcsRUFBVSxPQUFsQixPQTZCRSxDQUNEdkIsSUFBSyxXQUNMVyxNQUFPLFNBNUJEQyxHQUtSLE9BSklOLEtBQUtHLGFBQVlHLEVBQVFOLEtBQUtrQixrQkFBa0JaLElBRTFCLFFBQXRCTixLQUFLSSxjQUF5QkUsRUFBUU4sS0FBS21CLGVBQWViLEdBQy9CLFFBQXRCTixLQUFLSSxnQkFBeUJFLEVBQVFOLEtBQUtvQixlQUFlZCxJQUM1REEsSUE0QkosQ0FDRFosSUFBSyxZQUNMVyxNQUFPLFNBNUJBZ0IsRUFBT0MsR0FDaEIsR0FBSUQsRUFBTXZDLE9BQVN3QyxFQUFXLENBQzdCLElBQUlDLEVBQU1GLEVBQU1HLFlBQVksSUFBS0YsR0FDakMsTUFBQSxHQUFBRyxPQUFVSixFQUFNSyxNQUFNLEVBQUdILEdBQXpCLFFBRUQsT0FBT0YsSUErQkosQ0FDRDNCLElBQUssa0JBQ0xXLE1BQU8sU0E5Qk1zQixHQUFNLElBQ2ZDLEVBQW1DRCxFQUFuQ0MsR0FBSUMsRUFBK0JGLEVBQS9CRSxNQUFPZCxFQUF3QlksRUFBeEJaLE1BQU9GLEVBQWlCYyxFQUFqQmQsTUFBT1EsRUFBVU0sRUFBVk4sTUFDL0IsTUFBQSxxREFBQUksT0FBNERHLEVBQTVELG9EQUFBSCxPQUN3Q0ksRUFEeEMsK0ZBQUFKLE9BRytCVixFQUgvQixpREFBQVUsT0FJK0JaLEVBSi9CLDJEQUFBWSxPQUtxQ3pCLEtBQUs4QixVQUFVVCxFQUFPLElBTDNELDJRQW9DRyxDQUNEM0IsSUFBSyx1QkFDTFcsTUFBTyxTQXhCV0MsR0FBTyxJQUFBeUIsRUFBQS9CLEtBQzNCQSxLQUFLRSxhQUFlSSxFQUVwQjBCLHNCQURxQjFCLEVBQU0yQixLQUFJLFNBQUFOLEdBQUksT0FBSUksRUFBS0csZ0JBQWdCUCxNQUFPUSxLQUFLLElBQ3BDLGNBOEJqQyxDQUNEekMsSUFBSyxZQUNMVyxNQUFPLFdBN0JFLElBQUErQixFQUFBcEMsS0FDWHFDLE1BQU1yQyxLQUFLQyxhQUNUcUMsTUFBSyxTQUFBQyxHQUFRLE9BQUlBLEVBQVNDLFVBQzFCRixNQUFLLFNBQUFoQyxHQUNMOEIsRUFBS0sscUJBQXFCQyxZQUFZQyx3QkFBd0JQLEVBQUtRLFNBQVN0QyxVQWtDM0UsQ0FDRFosSUFBSyxlQUNMVyxNQUFPLFNBaENHQSxHQUNaTCxLQUFLRyxXQUFhRSxFQUNsQkwsS0FBSzZDLGNBa0NGLENBQ0RuRCxJQUFLLGFBQ0xXLE1BQU8sU0FqQ0NBLEdBQ05MLEtBQUtJLGVBQWlCQyxJQUN6QkwsS0FBS0ksY0FBZ0JDLEVBQ3JCTCxLQUFLNkMsZUFvQ0gsQ0FDRG5ELElBQUsscUJBQ0xXLE1BQU8sU0FsQ1N1QixHQUNsQixPQUFPNUIsS0FBS0UsYUFBYTRDLE1BQUssU0FBQUMsR0FBSSxPQUFJQSxFQUFLbkIsSUFBTUEsU0F3QzFDOUIsRUExR2dCLEdBdUVuQmtELE9BdUNvQixXQXRDekIsU0FBQUEsSUFBY2pFLGdCQUFBaUIsS0FBQWdELEdBQ2JoRCxLQUFLaUQsZUFDcUMsTUFBekNDLGFBQWFDLFFBQVEsaUJBQTJCQyxLQUFLQyxNQUFNSCxhQUFhQyxRQUFRLGtCQUFvQixHQTJJckcsT0FoR0F4RCxhQUFhcUQsRUFBUSxDQUFDLENBQ3BCdEQsSUFBSyxrQkFDTFcsTUFBTyxTQTFDTXNCLEdBQU0sSUFDYkMsRUFBNEJELEVBQTVCQyxHQUFJQyxFQUF3QkYsRUFBeEJFLE1BQU9kLEVBQWlCWSxFQUFqQlosTUFBT3VDLEVBQVUzQixFQUFWMkIsTUFDMUIsTUFBQSxrREFBQTdCLE9BQXlERyxFQUF6RCxxSUFBQUgsT0FFNkNJLEVBRjdDLG9EQUFBSixPQUdrQ1YsRUFIbEMsa0RBQUFVLE9BSW1DNkIsRUFKbkMsd0JBK0NHLENBQ0Q1RCxJQUFLLHVCQUNMVyxNQUFPLFdBekNhLElBQUFrRCxFQUFBdkQsS0FFdEJnQyxzQkFEcUJoQyxLQUFLaUQsZUFBZWhCLEtBQUksU0FBQU4sR0FBSSxPQUFJNEIsRUFBS3JCLGdCQUFnQlAsTUFBT1EsS0FBSyxJQUNsRCxxQkFnRGpDLENBQ0R6QyxJQUFLLHFCQUNMVyxNQUFPLFNBL0NTdUIsR0FDbEIsSUFBTTRCLEVBQVl4RCxLQUFLaUQsZUFBZVEsV0FBVSxTQUFBVixHQUFJLE9BQUlBLEVBQUtuQixNQUFRQSxLQUNyRSxPQUFPNUIsS0FBS2lELGVBQWVTLE9BQU9GLEVBQVcsS0FvRDFDLENBQ0Q5RCxJQUFLLGtCQUNMVyxNQUFPLFNBbkRNc0IsR0FDZixJQUFNZ0MsRUFBZTNELEtBQUtpRCxlQUFlSCxNQUFLLFNBQUFDLEdBQUksT0FBSUEsRUFBS25CLEtBQU9ELEVBQUtDLE1BQ25FK0IsRUFDSEEsRUFBYUwsU0FFYjNCLEVBQUsyQixNQUFRLEVBQ2J0RCxLQUFLaUQsZUFBTCxHQUFBeEIsT0FBQTdELG1CQUEwQm9DLEtBQUtpRCxnQkFBL0IsQ0FBK0N0QixPQXlEN0MsQ0FDRGpDLElBQUssZ0JBQ0xXLE1BQU8sV0FyRFQyQixzQkFEa0JoQyxLQUFLaUQsZUFBZVcsUUFBTyxTQUFDQyxFQUFLZCxHQUFOLE9BQWVjLEVBQU1kLEVBQUtPLE1BQVFQLEVBQUtsQyxRQUFPLEdBQzFELHNCQTREOUIsQ0FDRG5CLElBQUssc0JBQ0xXLE1BQU8sV0ExRFQ2QyxhQUFhWSxjQUFnQlYsS0FBS1csVUFBVS9ELEtBQUtpRCxrQkE2RDlDLENBQ0R2RCxJQUFLLHNCQUNMVyxNQUFPLFdBM0RULE9BQU9MLEtBQUtpRCxlQUFlVyxRQUFPLFNBQUNDLEVBQUtkLEdBQU4sT0FBZWMsRUFBTWQsRUFBS08sUUFBTyxLQWdFaEUsQ0FDRDVELElBQUssd0JBQ0xXLE1BQU8sV0E5RFQyQixzQkFBc0JoQyxLQUFLZ0Usc0JBQXVCLHdCQWlFL0MsQ0FDRHRFLElBQUssa0JBQ0xXLE1BQU8sU0FoRU1zQixHQUNmM0IsS0FBS2lFLGdCQUFnQnRDLEdBQ3JCM0IsS0FBS2tFLHNCQUNMbEUsS0FBS21FLGlCQW9FRixDQUNEekUsSUFBSyx1QkFDTFcsTUFBTyxTQW5FV3VCLEdBQ3BCNUIsS0FBS29FLG1CQUFtQnhDLEdBQ3hCNUIsS0FBS2tFLHNCQUNMbEUsS0FBS21FLGlCQXVFRixDQUNEekUsSUFBSyxlQUNMVyxNQUFPLFdBckVUTCxLQUFLeUMsdUJBQ0x6QyxLQUFLcUUsb0JBMkVFckIsRUF2R2lCLEdBaUNwQnNCLE9BMEVvQixXQXpFekIsU0FBQUEsRUFBWUMsRUFBaUJDLEdBQVd6RixnQkFBQWlCLEtBQUFzRSxHQUN2Q3RFLEtBQUt5RSxXQUFhRCxFQUNsQnhFLEtBQUswRSxpQkFBbUJILEVBQ3hCdkUsS0FBSzJFLFlBQWMsRUEwSm5CLE9BM0VBaEYsYUFBYTJFLEVBQVEsQ0FBQyxDQUNwQjVFLElBQUsscUJBQ0xXLE1BQU8sU0E5RVN1RSxHQUNsQixNQUFBLGtGQUFBbkQsT0FFS21ELElBQVc1RSxLQUFLMkUsWUFBYyxTQUFXLEdBRjlDLHdDQUFBbEQsT0FHMkJtRCxFQUFTLEVBSHBDLG9CQUFBbkQsT0FJTW1ELEVBQVMsRUFKZix5QkFnRkcsQ0FDRGxGLElBQUssbUJBQ0xXLE1BQU8sV0F6RVQsTUFBQSw4Q0E0RUcsQ0FDRFgsSUFBSyw0QkFDTFcsTUFBTyxTQTNFZ0J3RSxFQUFPQyxHQUE0QixJQUF0QkMsRUFBc0JDLFVBQUFsRyxPQUFBLFFBQUFtRyxJQUFBRCxVQUFBLEdBQUFBLFVBQUEsR0FBSixHQUN4RCxPQUFJSCxFQUFRQyxHQUNYQyxHQUFtQi9FLEtBQUtrRixtQkFBbUJMLEdBQ3BDN0UsS0FBS21GLDBCQUEwQk4sRUFBUSxFQUFHQyxFQUFNQyxJQUVqREEsSUFnRkosQ0FDRHJGLElBQUssc0JBQ0xXLE1BQU8sU0EvRVUrRSxHQUNuQixJQUFJQyxFQUFnQkMsS0FBS0MsS0FBS0gsRUFBTXRHLE9BQVNrQixLQUFLMEUsa0JBQ2pESyxFQUFrQixHQXlCbkIsT0F2QklNLEVBQWdCLEVBQ2ZyRixLQUFLMkUsWUFBYyxHQUFLM0UsS0FBSzJFLFlBQWNVLEVBQWdCLEdBQzlETixHQUFtQi9FLEtBQUttRiwwQkFBMEIsRUFBRyxHQUNyREosR0FBbUIvRSxLQUFLd0YsbUJBQ3hCVCxHQUFtQi9FLEtBQUttRiwwQkFBMEJFLEVBQWdCLEVBQUdBLElBQ3ZDLEdBQXBCckYsS0FBSzJFLGFBQ2ZJLEdBQW1CL0UsS0FBS21GLDBCQUEwQixFQUFHLEdBQ3JESixHQUFtQi9FLEtBQUt3RixtQkFDeEJULEdBQW1CL0UsS0FBS21GLDBCQUEwQkUsRUFBZ0IsRUFBR0EsSUFDM0RyRixLQUFLMkUsYUFBZVUsRUFBZ0IsR0FDOUNOLEdBQW1CL0UsS0FBS21GLDBCQUEwQixFQUFHLEdBQ3JESixHQUFtQi9FLEtBQUt3RixtQkFDeEJULEdBQW1CL0UsS0FBS21GLDBCQUEwQkUsRUFBZ0IsRUFBR0EsSUFDM0RyRixLQUFLMkUsWUFBYyxHQUFLM0UsS0FBSzJFLFlBQWNVLEVBQWdCLElBQ3JFTixHQUFtQi9FLEtBQUttRiwwQkFBMEIsRUFBRyxHQUNyREosR0FBbUIvRSxLQUFLd0YsbUJBQ3hCVCxHQUFtQi9FLEtBQUttRiwwQkFBMEJuRixLQUFLMkUsWUFBYyxFQUFHM0UsS0FBSzJFLFlBQWMsR0FDM0ZJLEdBQW1CL0UsS0FBS3dGLG1CQUN4QlQsR0FBbUIvRSxLQUFLbUYsMEJBQTBCRSxFQUFnQixFQUFHQSxJQUd0RU4sR0FBbUIvRSxLQUFLbUYsMEJBQTBCLEVBQUdFLEdBRS9DTixJQW1GSixDQUNEckYsSUFBSyx3QkFDTFcsTUFBTyxTQWxGWStFLEdBQ3JCLElBQU1LLEVBQVl6RixLQUFLMkUsWUFBYzNFLEtBQUswRSxpQkFDekNnQixFQUFXRCxFQUFZekYsS0FBSzBFLGlCQUM3QixPQUFPVSxFQUFNMUQsTUFBTStELEVBQVdDLEtBb0YzQixDQUNEaEcsSUFBSyxnQkFDTFcsTUFBTyxTQW5GSXVFLEdBQ2I1RSxLQUFLMkUsWUFBY0MsSUFxRmhCLENBQ0RsRixJQUFLLDBCQUNMVyxNQUFPLFNBcEZjK0UsR0FFdkIsT0FEQXBELHNCQUFzQmhDLEtBQUsyRixvQkFBb0JQLEdBQVFwRixLQUFLeUUsWUFDckR6RSxLQUFLNEYsc0JBQXNCUixPQXdGM0JkLEVBcEZpQixHQUMxQixTQUFTdEMsc0JBQXNCNkQsRUFBU0MsR0FDdkMsSUFBTXRCLEVBQVl1QixTQUFTQyxjQUFjRixHQUNyQ3RCLElBQVdBLEVBQVV5QixVQUFZSixHQUl0QyxTQUFTSyw2QkFBNkJKLEVBQWdCSyxHQUNyRCxJQUFNQyxFQUFnQkwsU0FBU00saUJBQWlCUCxJQUN0QixTQUF6QlEsSUFBb0MsSUFBVjFILEVBQVVvRyxVQUFBbEcsT0FBQSxRQUFBbUcsSUFBQUQsVUFBQSxHQUFBQSxVQUFBLEdBQU4sRUFDN0IsR0FBSXBHLEVBQUl3SCxFQUFjdEgsT0FFckIsT0FEQXNILEVBQWN4SCxHQUFHMkgsVUFBVUMsT0FBT0wsR0FDM0JHLEVBQXVCMUgsRUFBSSxHQUdyQzBILEdBR0RQLFNBQVNVLGlCQUFpQixvQkFBb0IsV0FDN0MsSUFBTUMsRUFBVSxTQUFDQyxFQUFTQyxFQUFXQyxHQUNYZCxTQUFTQyxjQUFjVyxHQUMvQkYsaUJBQWlCRyxHQUFXLFNBQUFFLEdBQUssT0FBSUQsRUFBR0MsT0FJMURKLEVBQVEsaUJBQWtCLFNBQVMsU0FBQUksR0FDbEMsSUFBTUMsRUFBZ0JELEVBQU0zSCxPQUN4QjRILEVBQWNSLFVBQVVTLFNBQVMsMEJBQTRCRCxFQUFjUixVQUFVUyxTQUFTLFlBQ2pHdEUsWUFBWXVFLGNBQWNGLEVBQWNHLFFBQVFDLGNBQWdCLEdBQ2hFN0csTUFBTXVDLGdCQUtSNkQsRUFBUSxzQkFBdUIsU0FBUyxTQUFBSSxHQUN2QyxJQUFNQyxFQUFnQkQsRUFBTTNILE9BQzVCLEdBQUk0SCxFQUFjUixVQUFVUyxTQUFTLGdCQUFrQkQsRUFBY1IsVUFBVVMsU0FBUyxVQUFXLENBQ2xHLElBQU1JLEVBQWlCTCxFQUFjRyxRQUFRRyxRQUM3Q25CLDZCQUE2QixjQUFlLFVBQzVDNUYsTUFBTWdILFdBQVdGLEdBQ2pCTCxFQUFjUixVQUFVZ0IsSUFBSSxjQUs5QmIsRUFBUSxnQkFBaUIsVUFBVSxTQUFBSSxHQUNsQ3BFLFlBQVl1RSxjQUFjLEdBQzFCM0csTUFBTWtILGFBQWFWLEVBQU0zSCxPQUFPc0ksWUFJakNmLEVBQVEsV0FBWSxTQUFTLFNBQUFJLEdBQzVCLEdBQUlBLEVBQU0zSCxPQUFPb0gsVUFBVVMsU0FBUyxvQkFBcUIsQ0FDeEQsSUFBSVUsRUFBU1osRUFBTTNILE9BQU93SSxRQUFRLGlCQUFpQlQsUUFBUVEsT0FDM0RFLE9BQU9DLGdCQUFnQnZILE1BQU13SCxtQkFBbUJKLFFBS2xEaEIsRUFBUSxrQkFBbUIsU0FBUyxTQUFBSSxHQUMvQkEsRUFBTTNILE9BQU9vSCxVQUFVUyxTQUFTLG1CQUNuQ1ksT0FBT0cscUJBQXFCakIsRUFBTTNILE9BQU82SSxjQUFjZCxRQUFRZSxlQUtsRSxJQUFNTCxPQUFTLElBQUk1RSxPQUNsQjFDLE1BQVEsSUFBSVIsTUFBTSxvRUFDbEI0QyxZQUFjLElBQUk0QixPQUFPLEVBQUcsa0JBRTdCaEUsTUFBTXVDLFlBQ04rRSxPQUFPekQiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8g0YLQvtCy0LDRgNGLXHJcbmNsYXNzIEdvb2RzIHtcclxuXHRjb25zdHJ1Y3RvcihsaW5rVG9Kc29uKSB7XHJcblx0XHR0aGlzLl9saW5rVG9Kc29uID0gbGlua1RvSnNvbjtcclxuXHRcdHRoaXMuX2dvb2RzSW5QYWdlID0gW107XHJcblx0XHR0aGlzLl9hdmFsaWFibGUgPSBmYWxzZTtcclxuXHRcdHRoaXMuX3NvcnRpbmdWYWx1ZSA9ICduYW1lJztcclxuXHR9XHJcblxyXG5cdF9zb3J0aW5nQXZhbGlhYmxlKGdvb2RzKSB7XHJcblx0XHRyZXR1cm4gZ29vZHMuZmlsdGVyKGVsZW0gPT4gZWxlbS5hdmFsaWFibGUpO1xyXG5cdH1cclxuXHJcblx0X3NvcnRpbmdCeUNvc3QoZ29vZHMpIHtcclxuXHRcdHJldHVybiBnb29kcy5zb3J0KChwcmV2LCBuZXh0KSA9PiBwcmV2LnByaWNlIC0gbmV4dC5wcmljZSk7XHJcblx0fVxyXG5cclxuXHRfc29ydGluZ0J5TmFtZShnb29kcykge1xyXG5cdFx0cmV0dXJuIGdvb2RzLnNvcnQoKHByZXYsIG5leHQpID0+IHtcclxuXHRcdFx0Y29uc3QgeCA9IHByZXYudGl0bGUudG9Mb3dlckNhc2UoKTtcclxuXHRcdFx0Y29uc3QgeSA9IG5leHQudGl0bGUudG9Mb3dlckNhc2UoKTtcclxuXHRcdFx0aWYgKHggPCB5KSByZXR1cm4gLTE7XHJcblx0XHRcdGlmICh4IDwgeSkgcmV0dXJuIDE7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0X3NvcnRpbmcoZ29vZHMpIHtcclxuXHRcdGlmICh0aGlzLl9hdmFsaWFibGUpIGdvb2RzID0gdGhpcy5fc29ydGluZ0F2YWxpYWJsZShnb29kcyk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3NvcnRpbmdWYWx1ZSA9PSAnY29zdCcpIGdvb2RzID0gdGhpcy5fc29ydGluZ0J5Q29zdChnb29kcyk7XHJcblx0XHRlbHNlIGlmICh0aGlzLl9zb3J0aW5nVmFsdWUgPT0gJ25hbWUnKSBnb29kcyA9IHRoaXMuX3NvcnRpbmdCeU5hbWUoZ29vZHMpO1xyXG5cdFx0cmV0dXJuIGdvb2RzO1xyXG5cdH1cclxuXHRfdHJ1bmNhdGUoZGVzY3IsIG1heExlbmd0aCkge1xyXG5cdFx0aWYgKGRlc2NyLmxlbmd0aCA+IG1heExlbmd0aCkge1xyXG5cdFx0XHRsZXQgZ2FwID0gZGVzY3IubGFzdEluZGV4T2YoJyAnLCBtYXhMZW5ndGgpO1xyXG5cdFx0XHRyZXR1cm4gYCR7ZGVzY3Iuc2xpY2UoMCwgZ2FwKX0gLi4uYDtcclxuXHRcdH1cclxuXHRcdHJldHVybiBkZXNjcjtcclxuXHR9XHJcblxyXG5cdF9nZXRHb29kQ29udGVudChnb29kKSB7XHJcblx0XHRsZXQgeyBpZCwgaW1hZ2UsIHRpdGxlLCBwcmljZSwgZGVzY3IgfSA9IGdvb2Q7XHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJnb29kX19pdGVtIGpzLWdvb2QtaXRlbVwiIGRhdGEtZ29vZC1pZD0ke2lkfT5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIi8+PC9kaXY+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9faW5mb3JtYXRpb25cIj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3RpdGxlXCI+JHt0aXRsZX08L2Rpdj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3ByaWNlXCI+JHtwcmljZX0g0YDRg9CxPC9kaXY+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19kZXNjcmlwdGlvblwiPiR7dGhpcy5fdHJ1bmNhdGUoZGVzY3IsIDY1KX08L2Rpdj5cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3RyYW5zYWN0aW9uXCI+XHJcblx0XHRcdFx0XHRcdDxidXR0b24gY2xhc3M9XCJnb29kX19idXR0b24ganMtYWRkLXRvLWJhc2tldFwiPtCU0L7QsdCw0LLQuNGC0Ywg0LIg0LrQvtGA0LfQuNC90YM8L2J1dHRvbj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX2Jhc2tldC1mZWVkYmFjayBqcy1nb29kLWluLWJhc2tldFwiPjwvZGl2PlxyXG5cdFx0XHRcdFx0PC9kaXY+XHJcblx0XHRcdFx0PC9kaXY+YDtcclxuXHR9XHJcblxyXG5cdF9hZGRHb29kc1RvQ29udGFpbmVyKGdvb2RzKSB7XHJcblx0XHR0aGlzLl9nb29kc0luUGFnZSA9IGdvb2RzO1xyXG5cdFx0Y29uc3QgZ29vZHNDb250ZW50ID0gZ29vZHMubWFwKGdvb2QgPT4gdGhpcy5fZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKGdvb2RzQ29udGVudCwgJy5qcy1nb29kJyk7XHJcblx0fVxyXG5cclxuXHRsb2FkR29vZHMoKSB7XHJcblx0XHRmZXRjaCh0aGlzLl9saW5rVG9Kc29uKVxyXG5cdFx0XHQudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcblx0XHRcdC50aGVuKGdvb2RzID0+IHtcclxuXHRcdFx0XHR0aGlzLl9hZGRHb29kc1RvQ29udGFpbmVyKGdvb2RzUGFnaW5nLmFkZFBhZ2luZ0dldEl0ZW1zSW5QYWdlKHRoaXMuX3NvcnRpbmcoZ29vZHMpKSk7XHJcblx0XHRcdH0pO1xyXG5cdH1cclxuXHJcblx0c2V0QXZhbGlhYmxlKHZhbHVlKSB7XHJcblx0XHR0aGlzLl9hdmFsaWFibGUgPSB2YWx1ZTtcclxuXHRcdHRoaXMubG9hZEdvb2RzKCk7XHJcblx0fVxyXG5cclxuXHRzZXRTb3J0aW5nKHZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy5fc29ydGluZ1ZhbHVlICE9IHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuX3NvcnRpbmdWYWx1ZSA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLmxvYWRHb29kcygpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0R29vZEluZm9ybWF0aW9uKGlkKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fZ29vZHNJblBhZ2UuZmluZChpdGVtID0+IGl0ZW0uaWQgPT0gaWQpO1xyXG5cdH1cclxufVxyXG5cclxuLy/QutC+0YDQt9C40L3QsFxyXG5jbGFzcyBCYXNrZXQge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5fZ29vZHNJbkJhc2tldCA9XHJcblx0XHRcdGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnb29kc0luQmFza2V0JykgIT0gbnVsbCA/IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2RzSW5CYXNrZXQnKSkgOiBbXTtcclxuXHR9XHJcblxyXG5cdF9nZXRHb29kQ29udGVudChnb29kKSB7XHJcblx0XHRjb25zdCB7IGlkLCBpbWFnZSwgdGl0bGUsIGNvdW50IH0gPSBnb29kO1xyXG5cdFx0cmV0dXJuIGA8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWl0ZW1cIiBkYXRhLWItZ29vZC1pZD1cIiR7aWR9XCI+XHJcblx0XHRcdDxidXR0b24gY2xhc3M9XCJiYXNrZXRfX2dvb2QtcmVtb3ZlIGpzLXJlbW92ZS1nb29kXCI+JiMxMjg5Mzg7PC9idXR0b24+XHJcblx0XHRcdDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtaW1hZ2VcIj48aW1nIHNyYz1cIiR7aW1hZ2V9XCIvPjwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLW5hbWVcIj4ke3RpdGxlfTwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWFtb3V0XCI+JHtjb3VudH08L2Rpdj5cclxuXHRcdDwvZGl2PmA7XHJcblx0fVxyXG5cclxuXHRfYWRkR29vZHNUb0NvbnRhaW5lcigpIHtcclxuXHRcdGNvbnN0IGdvb2RzQ29udGVudCA9IHRoaXMuX2dvb2RzSW5CYXNrZXQubWFwKGdvb2QgPT4gdGhpcy5fZ2V0R29vZENvbnRlbnQoZ29vZCkpLmpvaW4oJycpO1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKGdvb2RzQ29udGVudCwgJy5qcy1iYXNrZXQtZ29vZCcpO1xyXG5cdH1cclxuXHJcblx0X2ZpbmRHb29kQW5kUmVtb3ZlKGlkKSB7XHJcblx0XHRjb25zdCBnb29kSW5kZXggPSB0aGlzLl9nb29kc0luQmFza2V0LmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaWQgPT09ICtpZCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fZ29vZHNJbkJhc2tldC5zcGxpY2UoZ29vZEluZGV4LCAxKTtcclxuXHR9XHJcblxyXG5cdF9maW5kR29vZEFuZEFkZChnb29kKSB7XHJcblx0XHRjb25zdCBnb29kSW5CYXNrZXQgPSB0aGlzLl9nb29kc0luQmFza2V0LmZpbmQoaXRlbSA9PiBpdGVtLmlkID09PSBnb29kLmlkKTtcclxuXHRcdGlmIChnb29kSW5CYXNrZXQpIHtcclxuXHRcdFx0Z29vZEluQmFza2V0LmNvdW50Kys7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRnb29kLmNvdW50ID0gMTtcclxuXHRcdFx0dGhpcy5fZ29vZHNJbkJhc2tldCA9IFsuLi50aGlzLl9nb29kc0luQmFza2V0LCBnb29kXTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdF9hZGRUb3RhbENvc3QoKSB7XHJcblx0XHRjb25zdCB0b3RhbENvc3QgPSB0aGlzLl9nb29kc0luQmFza2V0LnJlZHVjZSgoc3VtLCBpdGVtKSA9PiBzdW0gKyBpdGVtLmNvdW50ICogaXRlbS5wcmljZSwgMCk7XHJcblx0XHRhZGRDb250ZW50VG9Db250YWluZXIodG90YWxDb3N0LCAnLmpzLWNvdW50LXJlc3VsdCcpO1xyXG5cdH1cclxuXHJcblx0X3NhdmVUb0xvY2FsU3RvcmFnZSgpIHtcclxuXHRcdGxvY2FsU3RvcmFnZS5nb29kc0luQmFza2V0ID0gSlNPTi5zdHJpbmdpZnkodGhpcy5fZ29vZHNJbkJhc2tldCk7XHJcblx0fVxyXG5cclxuXHRfY291bnRHb29kc0luQmFza2V0KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2dvb2RzSW5CYXNrZXQucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0uY291bnQsIDApO1xyXG5cdH1cclxuXHJcblx0YWRkQ291bnRHb29kc0luQmFza2V0KCkge1xyXG5cdFx0YWRkQ29udGVudFRvQ29udGFpbmVyKHRoaXMuX2NvdW50R29vZHNJbkJhc2tldCgpLCAnLmpzLWdvb2QtaW4tYmFza2V0Jyk7XHJcblx0fVxyXG5cclxuXHRhZGRHb29kVG9CYXNrZXQoZ29vZCkge1xyXG5cdFx0dGhpcy5fZmluZEdvb2RBbmRBZGQoZ29vZCk7XHJcblx0XHR0aGlzLl9zYXZlVG9Mb2NhbFN0b3JhZ2UoKTtcclxuXHRcdHRoaXMucmVsb2FkQmFza2V0KCk7XHJcblx0fVxyXG5cclxuXHRyZW1vdmVHb29kRnJvbUJhc2tldChpZCkge1xyXG5cdFx0dGhpcy5fZmluZEdvb2RBbmRSZW1vdmUoaWQpO1xyXG5cdFx0dGhpcy5fc2F2ZVRvTG9jYWxTdG9yYWdlKCk7XHJcblx0XHR0aGlzLnJlbG9hZEJhc2tldCgpO1xyXG5cdH1cclxuXHJcblx0cmVsb2FkQmFza2V0KCkge1xyXG5cdFx0dGhpcy5fYWRkR29vZHNUb0NvbnRhaW5lcigpO1xyXG5cdFx0dGhpcy5fYWRkVG90YWxDb3N0KCk7XHJcblx0fVxyXG59XHJcblxyXG4vL9C/0LDQs9C40L3QsNGG0LjRj1xyXG5jbGFzcyBQYWdpbmcge1xyXG5cdGNvbnN0cnVjdG9yKGFtb3VudFBhZ2VJdGVtcywgY29udGFpbmVyKSB7XHJcblx0XHR0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XHJcblx0XHR0aGlzLl9hbW91bnRQYWdlSXRlbXMgPSBhbW91bnRQYWdlSXRlbXM7XHJcblx0XHR0aGlzLl9hY3RpdmVQYWdlID0gMDtcclxuXHR9XHJcblxyXG5cdF9nZXRQQnV0dG9uQ29udGVudChudW1iZXIpIHtcclxuXHRcdHJldHVybiBgPGJ1dHRvbiBcclxuXHRcdFx0XHRcdGNsYXNzPVwicGFnaW5hdGlvbl9fYnV0dG9uIGpzLXBhZ2luYXRpb24tYnV0dG9uIFxyXG5cdFx0XHRcdFx0JHtudW1iZXIgPT09IHRoaXMuX2FjdGl2ZVBhZ2UgPyAnYWN0aXZlJyA6ICcnfVwiIFxyXG5cdFx0XHRcdFx0ZGF0YS1wLWJ1dHRvbi1udW1iZXI9XCIke251bWJlciArIDF9XCI+XHJcblx0XHRcdFx0XHRcdCR7bnVtYmVyICsgMX1cclxuXHRcdFx0XHQ8L2J1dHRvbj5gO1xyXG5cdH1cclxuXHJcblx0X2dldFBEb3RzQ29udGVudCgpIHtcclxuXHRcdHJldHVybiBgPHNwYW4gY2xhc3M9J3BhZ2luYXRpb25fX2RvdHMnPi4uLjwvc3Bhbj5gO1xyXG5cdH1cclxuXHJcblx0X2dldFBCdXR0b25zTnVtYmVyQ29udGVudChmaXJzdCwgbGFzdCwgcEJ1dHRvbnNDb250ZW50ID0gJycpIHtcclxuXHRcdGlmIChmaXJzdCA8IGxhc3QpIHtcclxuXHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBCdXR0b25Db250ZW50KGZpcnN0KTtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2dldFBCdXR0b25zTnVtYmVyQ29udGVudChmaXJzdCArIDEsIGxhc3QsIHBCdXR0b25zQ29udGVudCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcEJ1dHRvbnNDb250ZW50O1xyXG5cdH1cclxuXHJcblx0X2dldFBCdXR0b25zQ29udGVudChpdGVtcykge1xyXG5cdFx0bGV0IGFtb3VudEJ1dHRvbnMgPSBNYXRoLmNlaWwoaXRlbXMubGVuZ3RoIC8gdGhpcy5fYW1vdW50UGFnZUl0ZW1zKSwgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0YHRgtGA0LDQvdC40YZcclxuXHRcdFx0cEJ1dHRvbnNDb250ZW50ID0gJyc7IC8vINGA0LDQt9C80LXRgtC60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGG0LjQuFxyXG5cclxuXHRcdGlmIChhbW91bnRCdXR0b25zID4gNikge1xyXG5cdFx0XHRpZiAodGhpcy5fYWN0aXZlUGFnZSA8IDIgfHwgdGhpcy5fYWN0aXZlUGFnZSA+IGFtb3VudEJ1dHRvbnMgLSAzKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCAzKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMywgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5fYWN0aXZlUGFnZSA9PSAyKSB7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBCdXR0b25zTnVtYmVyQ29udGVudCgwLCA0KTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMSwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5fYWN0aXZlUGFnZSA9PSBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMSk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoYW1vdW50QnV0dG9ucyAtIDQsIGFtb3VudEJ1dHRvbnMpO1xyXG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuX2FjdGl2ZVBhZ2UgPiAyICYmIHRoaXMuX2FjdGl2ZVBhZ2UgPCBhbW91bnRCdXR0b25zIC0gMykge1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgMSk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBEb3RzQ29udGVudCgpO1xyXG5cdFx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQodGhpcy5fYWN0aXZlUGFnZSAtIDEsIHRoaXMuX2FjdGl2ZVBhZ2UgKyAyKTtcclxuXHRcdFx0XHRwQnV0dG9uc0NvbnRlbnQgKz0gdGhpcy5fZ2V0UERvdHNDb250ZW50KCk7XHJcblx0XHRcdFx0cEJ1dHRvbnNDb250ZW50ICs9IHRoaXMuX2dldFBCdXR0b25zTnVtYmVyQ29udGVudChhbW91bnRCdXR0b25zIC0gMSwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHRcdH1cclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHBCdXR0b25zQ29udGVudCArPSB0aGlzLl9nZXRQQnV0dG9uc051bWJlckNvbnRlbnQoMCwgYW1vdW50QnV0dG9ucyk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcEJ1dHRvbnNDb250ZW50O1xyXG5cdH1cclxuXHJcblx0X2dldEl0ZW1zSW5BY3RpdmVQYWdlKGl0ZW1zKSB7XHJcblx0XHRjb25zdCBmaXJzdEl0ZW0gPSB0aGlzLl9hY3RpdmVQYWdlICogdGhpcy5fYW1vdW50UGFnZUl0ZW1zLFxyXG5cdFx0XHRsYXN0SXRlbSA9IGZpcnN0SXRlbSArIHRoaXMuX2Ftb3VudFBhZ2VJdGVtcztcclxuXHRcdHJldHVybiBpdGVtcy5zbGljZShmaXJzdEl0ZW0sIGxhc3RJdGVtKTtcclxuXHR9XHJcblxyXG5cdHNldEFjdGl2ZVBhZ2UobnVtYmVyKSB7XHJcblx0XHR0aGlzLl9hY3RpdmVQYWdlID0gbnVtYmVyO1xyXG5cdH1cclxuXHJcblx0YWRkUGFnaW5nR2V0SXRlbXNJblBhZ2UoaXRlbXMpIHtcclxuXHRcdGFkZENvbnRlbnRUb0NvbnRhaW5lcih0aGlzLl9nZXRQQnV0dG9uc0NvbnRlbnQoaXRlbXMpLCB0aGlzLl9jb250YWluZXIpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX2dldEl0ZW1zSW5BY3RpdmVQYWdlKGl0ZW1zKTtcclxuXHR9XHJcbn1cclxuXHJcbi8v0JTQvtCx0LDQstC70LXQvdC40LUg0Y3Qu9C10LzQtdC90YLQvtCyINCyINC60L7QvdGC0LXQudC90LXRgFxyXG5mdW5jdGlvbiBhZGRDb250ZW50VG9Db250YWluZXIoY29udGVudCwgY29udGFpbmVyQ2xhc3MpIHtcclxuXHRjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckNsYXNzKTtcclxuXHRpZiAoY29udGFpbmVyKSBjb250YWluZXIuaW5uZXJIVE1MID0gY29udGVudDtcclxufVxyXG5cclxuLy/Rg9C00LDQu9C40YLRjCDQutC70LDRgdGBINGDINCz0YDRg9C/0L/RiyDQutC+0L3RgtC10LnQvdC10YDQvtCyXHJcbmZ1bmN0aW9uIGZpbmRDb250YWluZXJzQW5kUmVtb3ZlQ2xhc3MoY29udGFpbmVyQ2xhc3MsIGNsYXNzTmFtZSkge1xyXG5cdGNvbnN0IGFsbENvbnRhaW5lcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbnRhaW5lckNsYXNzKSxcclxuXHRcdHJlbW92ZUNsYXNzSW5Db250YWluZXIgPSAoaSA9IDApID0+IHtcclxuXHRcdFx0aWYgKGkgPCBhbGxDb250YWluZXJzLmxlbmd0aCkge1xyXG5cdFx0XHRcdGFsbENvbnRhaW5lcnNbaV0uY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xyXG5cdFx0XHRcdHJldHVybiByZW1vdmVDbGFzc0luQ29udGFpbmVyKGkgKyAxKTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHRyZW1vdmVDbGFzc0luQ29udGFpbmVyKCk7XHJcbn1cclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHtcclxuXHRjb25zdCBoYW5kbGVyID0gKGVsZW1lbnQsIGV2ZW50TmFtZSwgZm4pID0+IHtcclxuXHRcdGNvbnN0IGVsZW1lbnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpO1xyXG5cdFx0ZWxlbWVudENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZXZlbnQgPT4gZm4oZXZlbnQpKTtcclxuXHR9O1xyXG5cclxuXHQvL9GB0LvRg9GI0LDQu9C60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGC0L7RgNCwXHJcblx0aGFuZGxlcignLmpzLXBhZ2luYXRpb24nLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1wYWdpbmF0aW9uLWJ1dHRvbicpICYmICF0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuXHRcdFx0Z29vZHNQYWdpbmcuc2V0QWN0aXZlUGFnZSh0YXJnZXRFbGVtZW50LmRhdGFzZXQucEJ1dHRvbk51bWJlciAtIDEpO1xyXG5cdFx0XHRnb29kcy5sb2FkR29vZHMoKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0YHQu9GD0YjQsNC70LrQsCDRgdC+0YDRgtC40YDQvtCy0L7QulxyXG5cdGhhbmRsZXIoJy5qcy1zb3J0aW5nLWJ1dHRvbnMnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRjb25zdCB0YXJnZXRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1zb3J0aW5nJykgJiYgIXRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xyXG5cdFx0XHRjb25zdCBzb3J0aW5nU2V0dGluZyA9IHRhcmdldEVsZW1lbnQuZGF0YXNldC5zb3J0aW5nO1xyXG5cdFx0XHRmaW5kQ29udGFpbmVyc0FuZFJlbW92ZUNsYXNzKCcuanMtc29ydGluZycsICdhY3RpdmUnKTtcclxuXHRcdFx0Z29vZHMuc2V0U29ydGluZyhzb3J0aW5nU2V0dGluZyk7XHJcblx0XHRcdHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vINGB0LvRg9GI0LDQu9C60LAg0YHQvtGA0YLQuNGA0L7QstC60Lgg0L/QviDQvdCw0LvQuNGH0LjRjlxyXG5cdGhhbmRsZXIoJy5qcy1hdmFsaWFibGUnLCAnY2hhbmdlJywgZXZlbnQgPT4ge1xyXG5cdFx0Z29vZHNQYWdpbmcuc2V0QWN0aXZlUGFnZSgwKTtcclxuXHRcdGdvb2RzLnNldEF2YWxpYWJsZShldmVudC50YXJnZXQuY2hlY2tlZCk7XHJcblx0fSk7XHJcblxyXG5cdC8vINC60L3QvtC/0LrQsCDQtNC+0LHQsNCy0LjRgtGMINCyINC60L7RgNC30LjQvdGDXHJcblx0aGFuZGxlcignLmpzLWdvb2QnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtYWRkLXRvLWJhc2tldCcpKSB7XHJcblx0XHRcdGxldCBnb29kSWQgPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmpzLWdvb2QtaXRlbScpLmRhdGFzZXQuZ29vZElkO1xyXG5cdFx0XHRiYXNrZXQuYWRkR29vZFRvQmFza2V0KGdvb2RzLmdldEdvb2RJbmZvcm1hdGlvbihnb29kSWQpKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly8g0LrQvdC+0L/QutCwINGD0LTQsNC70LjRgtGMINC40Lcg0LrQvtGA0LfQuNC90YtcclxuXHRoYW5kbGVyKCcuanMtYmFza2V0LWdvb2QnLCAnY2xpY2snLCBldmVudCA9PiB7XHJcblx0XHRpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtcmVtb3ZlLWdvb2QnKSkge1xyXG5cdFx0XHRiYXNrZXQucmVtb3ZlR29vZEZyb21CYXNrZXQoZXZlbnQudGFyZ2V0LnBhcmVudEVsZW1lbnQuZGF0YXNldC5iR29vZElkKTtcclxuXHRcdH1cclxuXHR9KTtcclxufSk7XHJcblxyXG5jb25zdCBiYXNrZXQgPSBuZXcgQmFza2V0KCksXHJcblx0Z29vZHMgPSBuZXcgR29vZHMoJ2h0dHBzOi8vZHphZHJhbmlrLmdpdGh1Yi5pby9nb29kcy1hbmQtYmFza2V0L3NyYy9qc29uL2dvb2RzLmpzb24nKSxcclxuXHRnb29kc1BhZ2luZyA9IG5ldyBQYWdpbmcoNSwgJy5qcy1wYWdpbmF0aW9uJyk7XHJcblxyXG5nb29kcy5sb2FkR29vZHMoKTtcclxuYmFza2V0LnJlbG9hZEJhc2tldCgpO1xyXG4iXX0=
