"use strict";var _basketSetting=basketSetting(),addGoodToBasket=_basketSetting.addGoodToBasket,getLocalSorage=_basketSetting.getLocalSorage,removeGoodFromBasket=_basketSetting.removeGoodFromBasket,countGoodInBasket=_basketSetting.countGoodInBasket,_paging=paging(),addPaging=_paging.addPaging,setActivePage=_paging.setActivePage,_goodSetting=goodSetting(),loadGoodToPage=_goodSetting.loadGoodToPage,setAvaliable=_goodSetting.setAvaliable,setSorting=_goodSetting.setSorting,returnGoodData=_goodSetting.returnGoodData;function addToContainer(t,n){var o=document.querySelector(t);o&&(o.innerHTML=n)}function addToAnyContainers(t,n){var o=document.querySelectorAll(t);if(o)for(var e=0;e<o.length;e++)o[e].innerHTML=n}function get(t){return new Promise((function(n,o){var e=new XMLHttpRequest;e.open("GET",t,!0),e.addEventListener("load",(function(){e.status<400?n(e.response):o(new Error("Request failed: "+e.statusText))})),e.addEventListener("error",(function(){o(new Error("Network error"))})),e.send()}))}function goodSetting(){var t=[],n=!1,o="sorting-name";return{loadGoodToPage:function(){get("js/goods.json").then((function(t){return JSON.parse(t)})).then((function(t){return function(t){var e=t;return n&&(e=function(t){return t.filter((function(t){return t.avaliable}))}(t)),"sorting-cost"==o?e=function(t){return t.sort((function(t,n){return t.price-n.price}))}(e):"sorting-name"==o&&(e=function(t){return t.sort((function(t,n){var o=t.title.toLowerCase(),e=n.title.toLowerCase();return o<e?-1:o<e?1:void 0}))}(e)),e}(t)})).then((function(t){return addPaging(t)})).then((function(n){!function(n){t=n;var o=n.map((function(t){return function(t){var n=t.id,o=t.image,e=t.title,a=t.price,i=t.descr;return'<div class="good__item" data-id='.concat(n,'>\n\t\t\t\t\t<div class="good__image"><img src="').concat(o,'"/></div>\n\t\t\t\t\t<div class="good__information">\n\t\t\t\t\t\t<div class="good__title">').concat(e,'</div>\n\t\t\t\t\t\t<div class="good__price">').concat(a,' руб</div>\n\t\t\t\t\t\t<div class="good__description">').concat(i,'</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="good__transaction">\n\t\t\t\t\t\t<button class="good__button">Добавить в корзину</button>\n\t\t\t\t\t\t<div class="good__basket-feedback js-good-in-basket"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')}(t)}));addToContainer(".js-good",o=o.join(""))}(n),countGoodInBasket()})).catch()},setAvaliable:function(t){n=t,setActivePage(0),loadGoodToPage()},setSorting:function(t){o!=t&&(o=t,loadGoodToPage())},returnGoodData:function(n){return t.find((function(t){return t.id==n}))}}}function paging(){var t=0;function n(n){return'<button \n\t\t\tclass="pagination__item js-pagination-button '.concat(n==t?"active":"",'" \n\t\t\tid="').concat(n+1,'">\n\t\t\t\t').concat(n+1,"\n\t\t\t</button>")}function o(t,o){for(var e="",a=t;a<o;a++)e+=n(a);return e}return{setActivePage:function(n){t=n,loadGoodToPage()},addPaging:function(n){return addToContainer(".js-pagination",function(n){var e=n.length,a=Math.ceil(e/15),i="";return a>6?t<2||t>a-3?(i+=o(0,3),i+="<span class='pagination__dots'>...</span>",i+=o(a-3,a)):2==t?(i+=o(0,4),i+="<span class='pagination__dots'>...</span>",i+=o(a-1,a)):t==a-3?(i+=o(0,1),i+="<span class='pagination__dots'>...</span>",i+=o(a-4,a)):t>2&&t<a-3&&(i+=o(0,1),i+="<span class='pagination__dots'>...</span>",i+=o(t-1,t+2),i+="<span class='pagination__dots'>...</span>",i+=o(a-1,a)):i+=o(0,a),i}(n)),function(n){var o=15*t,e=o+15;return n.slice(o,e)}(n)}}}function basketSetting(){var t=[];function n(){localStorage.goodInBasket=JSON.stringify(t),addToContainer(".js-basket-good",t.map((function(t){return o=(n=t).id,e=n.image,a=n.title,i=n.count,'<div class="basket__good-item" basket-good-id="'.concat(o,'">\n\t\t\t<button class="basket__good-remove js-remove-good">&#128938;</button>\n\t\t\t<div class="basket__good-image"><img src="').concat(e,'" /></div>\n\t\t\t<div class="basket__good-name">').concat(a,'</div>\n\t\t\t<div class="basket__good-amout">').concat(i,"</div>\n\t\t</div>");var n,o,e,a,i})).join("")),addToContainer(".js-count-result",t.reduce((function(t,n){return t+n.count*n.price}),0)),countGoodInBasket()}return{getLocalSorage:function(){null!=localStorage.getItem("goodInBasket")&&(t=JSON.parse(localStorage.getItem("goodInBasket"))),n()},countGoodInBasket:function(){var n=t.reduce((function(t,n){return t+n.count}),0);addToAnyContainers(".js-good-in-basket","Товаров в корзине  ".concat(n))},addGoodToBasket:function(o){for(var e=0;e<t.length;e++)if(o.id==t[e].id)return t[e].count++,void n();o.count=1,t.push(o),n()},removeGoodFromBasket:function(o){!function n(o){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e<t.length||o!==t[e].id?t.splice(e,1):n(e++)}(o),n()}}}document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector(".js-pagination"),n=document.querySelector(".js-sorting-buttons"),o=document.getElementById("avaliable"),e=document.querySelector(".js-good"),a=document.querySelector(".js-basket-good");t.addEventListener("click",(function(t){var n=t.target;n.classList.contains("js-pagination-button")&&!n.classList.contains("active")&&setActivePage(n.getAttribute("id")-1)})),n.addEventListener("click",(function(t){var n=t.target,o=n.getAttribute("id");n.classList.contains("js-sorting")&&setSorting(o)})),o.addEventListener("change",(function(t){setAvaliable(t.target.checked)})),e.addEventListener("click",(function(t){if(t.target.classList.contains("good__button")){var n=t.target.parentElement.parentElement.getAttribute("data-id"),o=returnGoodData(n);addGoodToBasket(o)}})),a.addEventListener("click",(function(t){var n=t.target;if(n.classList.contains("js-remove-good")){var o=n.parentElement.getAttribute("basket-good-id");removeGoodFromBasket(o)}}))})),loadGoodToPage(),getLocalSorage();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyJdLCJuYW1lcyI6WyJfYmFza2V0U2V0dGluZyIsImJhc2tldFNldHRpbmciLCJhZGRHb29kVG9CYXNrZXQiLCJnZXRMb2NhbFNvcmFnZSIsInJlbW92ZUdvb2RGcm9tQmFza2V0IiwiY291bnRHb29kSW5CYXNrZXQiLCJfcGFnaW5nIiwicGFnaW5nIiwiYWRkUGFnaW5nIiwic2V0QWN0aXZlUGFnZSIsIl9nb29kU2V0dGluZyIsImdvb2RTZXR0aW5nIiwibG9hZEdvb2RUb1BhZ2UiLCJzZXRBdmFsaWFibGUiLCJzZXRTb3J0aW5nIiwicmV0dXJuR29vZERhdGEiLCJhZGRUb0NvbnRhaW5lciIsImNvbnRhaW5lckNsYXNzIiwiZWxlbWVudCIsImNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImFkZFRvQW55Q29udGFpbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpIiwibGVuZ3RoIiwiZ2V0IiwidXJsIiwiUHJvbWlzZSIsInN1Y2NlZWQiLCJmYWlsIiwicmVxdWVzdCIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJzdGF0dXMiLCJyZXNwb25zZSIsIkVycm9yIiwic3RhdHVzVGV4dCIsInNlbmQiLCJnb29kRGF0YSIsImF2YWxpYWJsZSIsInNvcnRpbmdWYWx1ZSIsInRoZW4iLCJKU09OIiwicGFyc2UiLCJkYXRhIiwiaXRlbSIsImZpbHRlciIsImVsZW0iLCJzb3J0aW5nQXZhbGlhYmxlIiwic29ydCIsInByZXYiLCJuZXh0IiwicHJpY2UiLCJzb3J0aW5nQnlDb3N0IiwieCIsInRpdGxlIiwidG9Mb3dlckNhc2UiLCJ5Iiwic29ydGluZ0J5TmFtZSIsInNvcnRpbmciLCJnb29kSXRlbXMiLCJtYXAiLCJpZCIsImltYWdlIiwiZGVzY3IiLCJjb25jYXQiLCJyZXR1cm5Hb29kSXRlbSIsImpvaW4iLCJhZGRHb29kVG9Db250YWluZXIiLCJ2YWx1ZSIsImZpbmQiLCJhY3RpdmVQYWdlIiwicmV0dXJuUGFnaW5nQnV0dG9uIiwicmV0dXJuQW55UGFnaW5nQnV0dG9ucyIsImZyc3QiLCJsYXN0IiwicGFnaW5nQnV0dG9ucyIsImFtb3VudEl0ZW0iLCJhbW91bnRCdXR0b24iLCJNYXRoIiwiY2VpbCIsInJldHVyblBhZ2luZ0J1dHRvbnMiLCJmaXJzdEl0ZW0iLCJsYXN0SXRlbSIsInNsaWNlIiwicmV0dXJuSXRlbUluQWN0aXZlUGFnZSIsImdvb2RJbkJhc2tldCIsInJlbG9hZEJhc2tldCIsImxvY2FsU3RvcmFnZSIsInN0cmluZ2lmeSIsImNvdW50IiwicmVkdWNlIiwic3VtIiwiZ2V0SXRlbSIsInB1c2giLCJmaW5kR29vZEFuZFJlbW92ZSIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsInNwbGljZSIsInBhZ2luYXRpb25CdXR0b25Db250YWluZXIiLCJzb3J0aW5nQnV0dG9uQ29udGFpbmVyIiwiYXZhbGlhYmxlQ2hlY2tib3giLCJnZXRFbGVtZW50QnlJZCIsImdvb2RDb250YWluZXIiLCJiYXNrZXRHb29kQ29udGFpbmVyIiwiZXZlbnQiLCJ0YXJnZXRFbGVtZW50IiwidGFyZ2V0IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJnZXRBdHRyaWJ1dGUiLCJzb3J0aW5nU2V0dGluZyIsImNoZWNrZWQiLCJnb29kSWQiLCJwYXJlbnRFbGVtZW50Il0sIm1hcHBpbmdzIjoiQUFBQSxhQUVBLElBQUlBLGVBRitFQyxnQkFBN0VDLGdCQUdnQkYsZUFIaEJFLGdCQUFpQkMsZUFJRkgsZUFKRUcsZUFBZ0JDLHFCQUtaSixlQUxZSSxxQkFBc0JDLGtCQU1yQ0wsZUFOcUNLLGtCQU96REMsUUFONEJDLFNBQTdCQyxVQU9hRixRQVBiRSxVQUFXQyxjQVFNSCxRQVJORyxjQVNWQyxhQVI0REMsY0FBN0RDLGVBU2tCRixhQVRsQkUsZUFBZ0JDLGFBVUFILGFBVkFHLGFBQWNDLFdBV2hCSixhQVhnQkksV0FBWUMsZUFZeEJMLGFBWndCSyxlQXNEN0MsU0FBU0MsZUFBZUMsRUFB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QzdDLElBQU1DLEVBQWdCRCxFQUFNRSxPQUM1QixHQUFJRCxFQUFjRSxVQUFVQyxTQUFTLGtCQUFtQixDQUN2RCxJQUFJSSxFQUFTUCxFQUFjUSxjQUFjSixhQUFhLGtCQUN0RDdHLHFCQUFxQmdILFVBS3hCeEcsaUJBQ0FUIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciB7IGFkZEdvb2RUb0Jhc2tldCwgZ2V0TG9jYWxTb3JhZ2UsIHJlbW92ZUdvb2RGcm9tQmFza2V0LCBjb3VudEdvb2RJbkJhc2tldCB9ID0gYmFza2V0U2V0dGluZygpLFxyXG5cdHsgYWRkUGFnaW5nLCBzZXRBY3RpdmVQYWdlIH0gPSBwYWdpbmcoKSxcclxuXHR7IGxvYWRHb29kVG9QYWdlLCBzZXRBdmFsaWFibGUsIHNldFNvcnRpbmcsIHJldHVybkdvb2REYXRhIH0gPSBnb29kU2V0dGluZygpXHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7XHJcblx0Y29uc3QgcGFnaW5hdGlvbkJ1dHRvbkNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1wYWdpbmF0aW9uJyksXHJcblx0XHRzb3J0aW5nQnV0dG9uQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXNvcnRpbmctYnV0dG9ucycpLFxyXG5cdFx0YXZhbGlhYmxlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXZhbGlhYmxlJyksXHJcblx0XHRnb29kQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWdvb2QnKSxcclxuXHRcdGJhc2tldEdvb2RDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtYmFza2V0LWdvb2QnKVxyXG5cclxuXHQvL9GB0LvRg9GI0LDQu9C60LAg0LrQvdC+0L/QvtC6INC/0LDQs9C40L3QsNGC0L7RgNCwXHJcblx0cGFnaW5hdGlvbkJ1dHRvbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXRcclxuXHRcdGlmICh0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanMtcGFnaW5hdGlvbi1idXR0b24nKSAmJiAhdGFyZ2V0RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSB7XHJcblx0XHRcdHNldEFjdGl2ZVBhZ2UodGFyZ2V0RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2lkJykgLSAxKVxyXG5cdFx0fVxyXG5cdH0pXHJcblxyXG5cdC8vINGB0LvRg9GI0LDQu9C60LAg0YHQvtGA0YLQuNGA0L7QstC+0LpcclxuXHRzb3J0aW5nQnV0dG9uQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xyXG5cdFx0Y29uc3QgdGFyZ2V0RWxlbWVudCA9IGV2ZW50LnRhcmdldCxcclxuXHRcdFx0c29ydGluZ1NldHRpbmcgPSB0YXJnZXRFbGVtZW50LmdldEF0dHJpYnV0ZSgnaWQnKVxyXG5cdFx0aWYgKHRhcmdldEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1zb3J0aW5nJykpIHtcclxuXHRcdFx0c2V0U29ydGluZyhzb3J0aW5nU2V0dGluZylcclxuXHRcdH1cclxuXHR9KVxyXG5cclxuXHQvLyDRgdC70YPRiNCw0LvQutCwINGB0L7RgNGC0LjRgNC+0LLQutC4INC/0L4g0L3QsNC70LjRh9C40Y5cclxuXHRhdmFsaWFibGVDaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBldmVudCA9PiB7XHJcblx0XHRzZXRBdmFsaWFibGUoZXZlbnQudGFyZ2V0LmNoZWNrZWQpXHJcblx0fSlcclxuXHJcblx0Ly8g0LrQvdC+0L/QutCwINC00L7QsdCw0LLQuNGC0Ywg0LIg0LrQvtGA0LfQuNC90YNcclxuXHRnb29kQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4ge1xyXG5cdFx0aWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2dvb2RfX2J1dHRvbicpKSB7XHJcblx0XHRcdGxldCBnb29kSWQgPSBldmVudC50YXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpXHJcblx0XHRcdGxldCBnb29kRGF0YSA9IHJldHVybkdvb2REYXRhKGdvb2RJZClcclxuXHRcdFx0YWRkR29vZFRvQmFza2V0KGdvb2REYXRhKVxyXG5cdFx0fVxyXG5cdH0pXHJcblxyXG5cdC8vINC60L3QvtC/0LrQsCDRg9C00LDQu9C40YLRjCDQuNC3INC60L7RgNC30LjQvdGLXHJcblx0YmFza2V0R29vZENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV2ZW50ID0+IHtcclxuXHRcdGNvbnN0IHRhcmdldEVsZW1lbnQgPSBldmVudC50YXJnZXRcclxuXHRcdGlmICh0YXJnZXRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnanMtcmVtb3ZlLWdvb2QnKSkge1xyXG5cdFx0XHRsZXQgZ29vZElkID0gdGFyZ2V0RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnYmFza2V0LWdvb2QtaWQnKVxyXG5cdFx0XHRyZW1vdmVHb29kRnJvbUJhc2tldChnb29kSWQpXHJcblx0XHR9XHJcblx0fSlcclxufSlcclxuXHJcbmxvYWRHb29kVG9QYWdlKClcclxuZ2V0TG9jYWxTb3JhZ2UoKVxyXG5cclxuLy/QlNC+0LHQsNCy0LvQtdC90LjQtSDRjdC70LXQvNC10L3RgtC+0LIg0LIg0LrQvtC90YLQtdC50L3QtdGAXHJcbmZ1bmN0aW9uIGFkZFRvQ29udGFpbmVyKGNvbnRhaW5lckNsYXNzLCBlbGVtZW50KSB7XHJcblx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJDbGFzcylcclxuXHRpZiAoY29udGFpbmVyKSBjb250YWluZXIuaW5uZXJIVE1MID0gZWxlbWVudFxyXG59XHJcbmZ1bmN0aW9uIGFkZFRvQW55Q29udGFpbmVycyhjb250YWluZXJDbGFzcywgZWxlbWVudCkge1xyXG5cdGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29udGFpbmVyQ2xhc3MpXHJcblx0aWYgKGNvbnRhaW5lcikge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjb250YWluZXIubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0Y29udGFpbmVyW2ldLmlubmVySFRNTCA9IGVsZW1lbnRcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8vINC/0L7Qu9GD0YfQtdC90LjQtSDQtNCw0L3QvdGL0YVcclxuZnVuY3Rpb24gZ2V0KHVybCkge1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihzdWNjZWVkLCBmYWlsKSB7XHJcblx0XHRsZXQgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpXHJcblx0XHRyZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSlcclxuXHRcdHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRpZiAocmVxdWVzdC5zdGF0dXMgPCA0MDApIHN1Y2NlZWQocmVxdWVzdC5yZXNwb25zZSlcclxuXHRcdFx0ZWxzZSBmYWlsKG5ldyBFcnJvcignUmVxdWVzdCBmYWlsZWQ6ICcgKyByZXF1ZXN0LnN0YXR1c1RleHQpKVxyXG5cdFx0fSlcclxuXHRcdHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0ZmFpbChuZXcgRXJyb3IoJ05ldHdvcmsgZXJyb3InKSlcclxuXHRcdH0pXHJcblx0XHRyZXF1ZXN0LnNlbmQoKVxyXG5cdH0pXHJcbn1cclxuXHJcbi8vINGC0L7QstCw0YDRi1xyXG5mdW5jdGlvbiBnb29kU2V0dGluZygpIHtcclxuXHR2YXIgZ29vZERhdGEgPSBbXSxcclxuXHRcdGF2YWxpYWJsZSA9IGZhbHNlLFxyXG5cdFx0c29ydGluZ1ZhbHVlID0gJ3NvcnRpbmctbmFtZSdcclxuXHRmdW5jdGlvbiBzb3J0aW5nQXZhbGlhYmxlKGRhdGEpIHtcclxuXHRcdHJldHVybiBkYXRhLmZpbHRlcihlbGVtID0+IGVsZW0uYXZhbGlhYmxlKVxyXG5cdH1cclxuXHRmdW5jdGlvbiBzb3J0aW5nQnlDb3N0KGRhdGEpIHtcclxuXHRcdHJldHVybiBkYXRhLnNvcnQoKHByZXYsIG5leHQpID0+IHByZXYucHJpY2UgLSBuZXh0LnByaWNlKVxyXG5cdH1cclxuXHRmdW5jdGlvbiBzb3J0aW5nQnlOYW1lKGRhdGEpIHtcclxuXHRcdHJldHVybiBkYXRhLnNvcnQoKHByZXYsIG5leHQpID0+IHtcclxuXHRcdFx0Y29uc3QgeCA9IHByZXYudGl0bGUudG9Mb3dlckNhc2UoKVxyXG5cdFx0XHRjb25zdCB5ID0gbmV4dC50aXRsZS50b0xvd2VyQ2FzZSgpXHJcblx0XHRcdGlmICh4IDwgeSkgcmV0dXJuIC0xXHJcblx0XHRcdGlmICh4IDwgeSkgcmV0dXJuIDFcclxuXHRcdH0pXHJcblx0fVxyXG5cdGZ1bmN0aW9uIHNvcnRpbmcoZGF0YSkge1xyXG5cdFx0bGV0IGl0ZW0gPSBkYXRhXHJcblx0XHRpZiAoYXZhbGlhYmxlKSBpdGVtID0gc29ydGluZ0F2YWxpYWJsZShkYXRhKVxyXG5cclxuXHRcdGlmIChzb3J0aW5nVmFsdWUgPT0gJ3NvcnRpbmctY29zdCcpIGl0ZW0gPSBzb3J0aW5nQnlDb3N0KGl0ZW0pXHJcblx0XHRlbHNlIGlmIChzb3J0aW5nVmFsdWUgPT0gJ3NvcnRpbmctbmFtZScpIGl0ZW0gPSBzb3J0aW5nQnlOYW1lKGl0ZW0pXHJcblx0XHRyZXR1cm4gaXRlbVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmV0dXJuR29vZEl0ZW0oZGF0YSkge1xyXG5cdFx0bGV0IHsgaWQsIGltYWdlLCB0aXRsZSwgcHJpY2UsIGRlc2NyIH0gPSBkYXRhXHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJnb29kX19pdGVtXCIgZGF0YS1pZD0ke2lkfT5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIi8+PC9kaXY+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9faW5mb3JtYXRpb25cIj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3RpdGxlXCI+JHt0aXRsZX08L2Rpdj5cclxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzcz1cImdvb2RfX3ByaWNlXCI+JHtwcmljZX0g0YDRg9CxPC9kaXY+XHJcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX19kZXNjcmlwdGlvblwiPiR7ZGVzY3J9PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHRcdDxkaXYgY2xhc3M9XCJnb29kX190cmFuc2FjdGlvblwiPlxyXG5cdFx0XHRcdFx0XHQ8YnV0dG9uIGNsYXNzPVwiZ29vZF9fYnV0dG9uXCI+0JTQvtCx0LDQstC40YLRjCDQsiDQutC+0YDQt9C40L3RgzwvYnV0dG9uPlxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzPVwiZ29vZF9fYmFza2V0LWZlZWRiYWNrIGpzLWdvb2QtaW4tYmFza2V0XCI+PC9kaXY+XHJcblx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHQ8L2Rpdj5gXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBhZGRHb29kVG9Db250YWluZXIoZGF0YSkge1xyXG5cdFx0Z29vZERhdGEgPSBkYXRhXHJcblx0XHRsZXQgZ29vZEl0ZW1zID0gZGF0YS5tYXAoaXRlbSA9PiByZXR1cm5Hb29kSXRlbShpdGVtKSlcclxuXHRcdGdvb2RJdGVtcyA9IGdvb2RJdGVtcy5qb2luKCcnKVxyXG5cdFx0YWRkVG9Db250YWluZXIoJy5qcy1nb29kJywgZ29vZEl0ZW1zKVxyXG5cdH1cclxuXHRyZXR1cm4ge1xyXG5cdFx0bG9hZEdvb2RUb1BhZ2U6ICgpID0+IHtcclxuXHRcdFx0Z2V0KCdqcy9nb29kcy5qc29uJylcclxuXHRcdFx0XHQudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIEpTT04ucGFyc2UocmVzcG9uc2UpXHJcblx0XHRcdFx0fSlcclxuXHRcdFx0XHQudGhlbihmdW5jdGlvbihkYXRhKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gc29ydGluZyhkYXRhKVxyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGFkZFBhZ2luZyhkYXRhKVxyXG5cdFx0XHRcdH0pXHJcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24oZGF0YSkge1xyXG5cdFx0XHRcdFx0YWRkR29vZFRvQ29udGFpbmVyKGRhdGEpXHJcblx0XHRcdFx0XHRjb3VudEdvb2RJbkJhc2tldCgpXHJcblx0XHRcdFx0fSlcclxuXHRcdFx0XHQuY2F0Y2goKVxyXG5cdFx0fSxcclxuXHRcdHNldEF2YWxpYWJsZTogdmFsdWUgPT4ge1xyXG5cdFx0XHRhdmFsaWFibGUgPSB2YWx1ZVxyXG5cdFx0XHRzZXRBY3RpdmVQYWdlKDApXHJcblx0XHRcdGxvYWRHb29kVG9QYWdlKClcclxuXHRcdH0sXHJcblx0XHRzZXRTb3J0aW5nOiB2YWx1ZSA9PiB7XHJcblx0XHRcdGlmIChzb3J0aW5nVmFsdWUgIT0gdmFsdWUpIHtcclxuXHRcdFx0XHRzb3J0aW5nVmFsdWUgPSB2YWx1ZVxyXG5cdFx0XHRcdGxvYWRHb29kVG9QYWdlKClcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHJldHVybkdvb2REYXRhOiBpZCA9PiB7XHJcblx0XHRcdHJldHVybiBnb29kRGF0YS5maW5kKGl0ZW0gPT4gaXRlbS5pZCA9PSBpZClcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8v0L/QsNCz0LjQvdCw0YbQuNGPXHJcbmZ1bmN0aW9uIHBhZ2luZygpIHtcclxuXHRjb25zdCBpdGVtSW5QYWdlID0gMTUgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0Y3Qu9C10LzQtdC90YLQvtCyINC90LAg0YHRgtGA0LDQvdC40YbQtVxyXG5cdHZhciBhY3RpdmVQYWdlID0gMCAvLyDQsNC60YLQuNCy0L3QsNGPINGB0YLRgNCw0L3QuNGG0LBcclxuXHJcblx0ZnVuY3Rpb24gcmV0dXJuUGFnaW5nQnV0dG9uKGkpIHtcclxuXHRcdHJldHVybiBgPGJ1dHRvbiBcclxuXHRcdFx0Y2xhc3M9XCJwYWdpbmF0aW9uX19pdGVtIGpzLXBhZ2luYXRpb24tYnV0dG9uICR7aSA9PSBhY3RpdmVQYWdlID8gJ2FjdGl2ZScgOiAnJ31cIiBcclxuXHRcdFx0aWQ9XCIke2kgKyAxfVwiPlxyXG5cdFx0XHRcdCR7aSArIDF9XHJcblx0XHRcdDwvYnV0dG9uPmBcclxuXHR9XHJcblx0ZnVuY3Rpb24gcmV0dXJuUGFnaW5nRG90cygpIHtcclxuXHRcdHJldHVybiBgPHNwYW4gY2xhc3M9J3BhZ2luYXRpb25fX2RvdHMnPi4uLjwvc3Bhbj5gXHJcblx0fVxyXG5cdGZ1bmN0aW9uIHJldHVybkFueVBhZ2luZ0J1dHRvbnMoZnJzdCwgbGFzdCkge1xyXG5cdFx0bGV0IHBhZ2luZ0J1dHRvbnMgPSAnJ1xyXG5cdFx0Zm9yIChsZXQgaSA9IGZyc3Q7IGkgPCBsYXN0OyBpKyspIHtcclxuXHRcdFx0cGFnaW5nQnV0dG9ucyArPSByZXR1cm5QYWdpbmdCdXR0b24oaSlcclxuXHRcdH1cclxuXHRcdHJldHVybiBwYWdpbmdCdXR0b25zXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiByZXR1cm5QYWdpbmdCdXR0b25zKGRhdGEpIHtcclxuXHRcdHZhciBpdGVtID0gZGF0YSwgLy8g0LzQsNGB0YHQuNCyINGC0L7QstCw0YDQvtCyXHJcblx0XHRcdGFtb3VudEl0ZW0gPSBpdGVtLmxlbmd0aCwgLy8g0LrQvtC70LjRh9C10YHRgtCy0L4g0YLQvtCy0LDRgNC+0LIg0LLRgdC10LPQvlxyXG5cdFx0XHRhbW91bnRCdXR0b24gPSBNYXRoLmNlaWwoYW1vdW50SXRlbSAvIGl0ZW1JblBhZ2UpLCAvLyDQutC+0LvQuNGH0LXRgdGC0LLQviDRgdGC0YDQsNC90LjRhlxyXG5cdFx0XHRwYWdpbmdCdXR0b25zID0gJycgLy8g0YDQsNC30LzQtdGC0LrQsCDQutC90L7Qv9C+0Log0L/QsNCz0LjQvdCw0YbQuNC4XHJcblxyXG5cdFx0aWYgKGFtb3VudEJ1dHRvbiA+IDYpIHtcclxuXHRcdFx0aWYgKGFjdGl2ZVBhZ2UgPCAyIHx8IGFjdGl2ZVBhZ2UgPiBhbW91bnRCdXR0b24gLSAzKSB7XHJcblx0XHRcdFx0cGFnaW5nQnV0dG9ucyArPSByZXR1cm5BbnlQYWdpbmdCdXR0b25zKDAsIDMpXHJcblx0XHRcdFx0cGFnaW5nQnV0dG9ucyArPSByZXR1cm5QYWdpbmdEb3RzKClcclxuXHRcdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVybkFueVBhZ2luZ0J1dHRvbnMoYW1vdW50QnV0dG9uIC0gMywgYW1vdW50QnV0dG9uKVxyXG5cdFx0XHR9IGVsc2UgaWYgKGFjdGl2ZVBhZ2UgPT0gMikge1xyXG5cdFx0XHRcdHBhZ2luZ0J1dHRvbnMgKz0gcmV0dXJuQW55UGFnaW5nQnV0dG9ucygwLCA0KVxyXG5cdFx0XHRcdHBhZ2luZ0J1dHRvbnMgKz0gcmV0dXJuUGFnaW5nRG90cygpXHJcblx0XHRcdFx0cGFnaW5nQnV0dG9ucyArPSByZXR1cm5BbnlQYWdpbmdCdXR0b25zKGFtb3VudEJ1dHRvbiAtIDEsIGFtb3VudEJ1dHRvbilcclxuXHRcdFx0fSBlbHNlIGlmIChhY3RpdmVQYWdlID09IGFtb3VudEJ1dHRvbiAtIDMpIHtcclxuXHRcdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVybkFueVBhZ2luZ0J1dHRvbnMoMCwgMSlcclxuXHRcdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVyblBhZ2luZ0RvdHMoKVxyXG5cdFx0XHRcdHBhZ2luZ0J1dHRvbnMgKz0gcmV0dXJuQW55UGFnaW5nQnV0dG9ucyhhbW91bnRCdXR0b24gLSA0LCBhbW91bnRCdXR0b24pXHJcblx0XHRcdH0gZWxzZSBpZiAoYWN0aXZlUGFnZSA+IDIgJiYgYWN0aXZlUGFnZSA8IGFtb3VudEJ1dHRvbiAtIDMpIHtcclxuXHRcdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVybkFueVBhZ2luZ0J1dHRvbnMoMCwgMSlcclxuXHRcdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVyblBhZ2luZ0RvdHMoKVxyXG5cdFx0XHRcdHBhZ2luZ0J1dHRvbnMgKz0gcmV0dXJuQW55UGFnaW5nQnV0dG9ucyhhY3RpdmVQYWdlIC0gMSwgYWN0aXZlUGFnZSArIDIpXHJcblx0XHRcdFx0cGFnaW5nQnV0dG9ucyArPSByZXR1cm5QYWdpbmdEb3RzKClcclxuXHRcdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVybkFueVBhZ2luZ0J1dHRvbnMoYW1vdW50QnV0dG9uIC0gMSwgYW1vdW50QnV0dG9uKVxyXG5cdFx0XHR9XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRwYWdpbmdCdXR0b25zICs9IHJldHVybkFueVBhZ2luZ0J1dHRvbnMoMCwgYW1vdW50QnV0dG9uKVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHBhZ2luZ0J1dHRvbnNcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJldHVybkl0ZW1JbkFjdGl2ZVBhZ2UoZGF0YSkge1xyXG5cdFx0Y29uc3QgZmlyc3RJdGVtID0gYWN0aXZlUGFnZSAqIGl0ZW1JblBhZ2UsXHJcblx0XHRcdGxhc3RJdGVtID0gZmlyc3RJdGVtICsgaXRlbUluUGFnZVxyXG5cdFx0cmV0dXJuIGRhdGEuc2xpY2UoZmlyc3RJdGVtLCBsYXN0SXRlbSlcclxuXHR9XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRzZXRBY3RpdmVQYWdlOiBpID0+IHtcclxuXHRcdFx0YWN0aXZlUGFnZSA9IGlcclxuXHRcdFx0bG9hZEdvb2RUb1BhZ2UoKVxyXG5cdFx0fSxcclxuXHRcdGFkZFBhZ2luZzogZGF0YSA9PiB7XHJcblx0XHRcdGFkZFRvQ29udGFpbmVyKCcuanMtcGFnaW5hdGlvbicsIHJldHVyblBhZ2luZ0J1dHRvbnMoZGF0YSkpXHJcblx0XHRcdHJldHVybiByZXR1cm5JdGVtSW5BY3RpdmVQYWdlKGRhdGEpXHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4vL9C60L7RgNC30LjQvdCwXHJcbmZ1bmN0aW9uIGJhc2tldFNldHRpbmcoKSB7XHJcblx0dmFyIGdvb2RJbkJhc2tldCA9IFtdXHJcblxyXG5cdGZ1bmN0aW9uIHJldHVybkJhc2tldEdvb2RJdGVtKGRhdGEpIHtcclxuXHRcdGxldCB7IGlkLCBpbWFnZSwgdGl0bGUsIGNvdW50IH0gPSBkYXRhXHJcblx0XHRyZXR1cm4gYDxkaXYgY2xhc3M9XCJiYXNrZXRfX2dvb2QtaXRlbVwiIGJhc2tldC1nb29kLWlkPVwiJHtpZH1cIj5cclxuXHRcdFx0PGJ1dHRvbiBjbGFzcz1cImJhc2tldF9fZ29vZC1yZW1vdmUganMtcmVtb3ZlLWdvb2RcIj4mIzEyODkzODs8L2J1dHRvbj5cclxuXHRcdFx0PGRpdiBjbGFzcz1cImJhc2tldF9fZ29vZC1pbWFnZVwiPjxpbWcgc3JjPVwiJHtpbWFnZX1cIiAvPjwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLW5hbWVcIj4ke3RpdGxlfTwvZGl2PlxyXG5cdFx0XHQ8ZGl2IGNsYXNzPVwiYmFza2V0X19nb29kLWFtb3V0XCI+JHtjb3VudH08L2Rpdj5cclxuXHRcdDwvZGl2PmBcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGFkZEdvb2RUb0NvbnRhaW5lcigpIHtcclxuXHRcdGxldCBnb29kQXJyYXkgPSBnb29kSW5CYXNrZXQubWFwKGVsZW1lbnQgPT4gcmV0dXJuQmFza2V0R29vZEl0ZW0oZWxlbWVudCkpXHJcblx0XHRnb29kQXJyYXkgPSBnb29kQXJyYXkuam9pbignJylcclxuXHRcdGFkZFRvQ29udGFpbmVyKCcuanMtYmFza2V0LWdvb2QnLCBnb29kQXJyYXkpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBmaW5kR29vZEFuZFJlbW92ZShpZCwgaSA9IDApIHtcclxuXHRcdHJldHVybiBpIDwgZ29vZEluQmFza2V0Lmxlbmd0aCB8fCBpZCAhPT0gZ29vZEluQmFza2V0W2ldLmlkID8gZ29vZEluQmFza2V0LnNwbGljZShpLCAxKSA6IGZpbmRHb29kQW5kUmVtb3ZlKGkrKylcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGNvdW50VG90YWwoKSB7XHJcblx0XHRsZXQgdG90YWxDb3N0ID0gZ29vZEluQmFza2V0LnJlZHVjZShmdW5jdGlvbihzdW0sIGl0ZW0pIHtcclxuXHRcdFx0cmV0dXJuIHN1bSArIGl0ZW0uY291bnQgKiBpdGVtLnByaWNlXHJcblx0XHR9LCAwKVxyXG5cdFx0YWRkVG9Db250YWluZXIoJy5qcy1jb3VudC1yZXN1bHQnLCB0b3RhbENvc3QpXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzYXZlVG9Mb2NhbFN0b3JhZ2UoKSB7XHJcblx0XHRsb2NhbFN0b3JhZ2UuZ29vZEluQmFza2V0ID0gSlNPTi5zdHJpbmdpZnkoZ29vZEluQmFza2V0KVxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVsb2FkQmFza2V0KCkge1xyXG5cdFx0c2F2ZVRvTG9jYWxTdG9yYWdlKClcclxuXHRcdGFkZEdvb2RUb0NvbnRhaW5lcigpXHJcblx0XHRjb3VudFRvdGFsKClcclxuXHRcdGNvdW50R29vZEluQmFza2V0KClcclxuXHR9XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRnZXRMb2NhbFNvcmFnZTogKCkgPT4ge1xyXG5cdFx0XHRpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dvb2RJbkJhc2tldCcpICE9IG51bGwpXHJcblx0XHRcdFx0Z29vZEluQmFza2V0ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ29vZEluQmFza2V0JykpXHJcblx0XHRcdHJlbG9hZEJhc2tldCgpXHJcblx0XHR9LFxyXG5cdFx0Y291bnRHb29kSW5CYXNrZXQ6ICgpID0+IHtcclxuXHRcdFx0bGV0IGFtb3VudEl0ZW0gPSBnb29kSW5CYXNrZXQucmVkdWNlKGZ1bmN0aW9uKHN1bSwgaXRlbSkge1xyXG5cdFx0XHRcdHJldHVybiBzdW0gKyBpdGVtLmNvdW50XHJcblx0XHRcdH0sIDApXHJcblx0XHRcdGFkZFRvQW55Q29udGFpbmVycygnLmpzLWdvb2QtaW4tYmFza2V0JywgYNCi0L7QstCw0YDQvtCyINCyINC60L7RgNC30LjQvdC1ICAke2Ftb3VudEl0ZW19YClcclxuXHRcdH0sXHJcblx0XHRhZGRHb29kVG9CYXNrZXQ6IGRhdGEgPT4ge1xyXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGdvb2RJbkJhc2tldC5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdGlmIChkYXRhLmlkID09IGdvb2RJbkJhc2tldFtpXS5pZCkge1xyXG5cdFx0XHRcdFx0Z29vZEluQmFza2V0W2ldLmNvdW50KytcclxuXHRcdFx0XHRcdHJlbG9hZEJhc2tldCgpXHJcblx0XHRcdFx0XHRyZXR1cm5cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZGF0YS5jb3VudCA9IDFcclxuXHRcdFx0Z29vZEluQmFza2V0LnB1c2goZGF0YSlcclxuXHRcdFx0cmVsb2FkQmFza2V0KClcclxuXHRcdH0sXHJcblx0XHRyZW1vdmVHb29kRnJvbUJhc2tldDogZGF0YSA9PiB7XHJcblx0XHRcdGZpbmRHb29kQW5kUmVtb3ZlKGRhdGEpXHJcblx0XHRcdHJlbG9hZEJhc2tldCgpXHJcblx0XHR9XHJcblx0fVxyXG59XHJcbiJdfQ==
